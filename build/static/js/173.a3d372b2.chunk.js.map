{"version":3,"file":"static/js/173.a3d372b2.chunk.js","mappings":"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","sources":["SomaLux/Books/Admin/universityPrefillApi.js","SomaLux/Books/Admin/pages/Upload.jsx"],"sourcesContent":["import { supabase } from '../supabaseClient';\nimport { API_URL } from '../../../config';\n\n// API Configuration\nconst USE_BACKEND_PROXY = true; // Set to false to use direct API calls\n\n/**\n * Search for university names for autocomplete\n */\nexport async function searchUniversityNames(query, limit = 10) {\n  try {\n    // Check cache first\n    let { data, error } = await supabase\n      .rpc('search_university_names', { p_query: query, p_limit: limit });\n\n    if (error) throw error;\n    if (data?.length) return data;\n\n    // Try Wikipedia/Wikidata search as primary method (more reliable, no API key needed)\n    const wikiResults = await searchWikipediaUniversities(query, limit);\n    if (wikiResults.length > 0) {\n      // Cache results\n      await Promise.all(wikiResults.map(uni => \n        cacheUniversityPrefillData(uni.name, uni, 'wikipedia')\n      ));\n      return wikiResults;\n    }\n\n    // Try backend proxy for Google Knowledge Graph (if enabled)\n    if (USE_BACKEND_PROXY) {\n      try {\n        const response = await fetch(`${API_URL}/api/university/search?query=${encodeURIComponent(query)}&limit=${limit}`);\n        \n        if (response.ok) {\n          const data = await response.json();\n          const universities = data.universities || [];\n          \n          // Cache results\n          if (universities.length > 0) {\n            await Promise.all(universities.map(uni => \n              cacheUniversityPrefillData(uni.name, uni, 'google_proxy')\n            ));\n          }\n          \n          return universities;\n        }\n      } catch (proxyError) {\n        console.warn('Backend proxy unavailable:', proxyError.message);\n      }\n    }\n\n    return [];\n  } catch (error) {\n    console.error('Error searching university names:', error);\n    return [];\n  }\n}\n\n/**\n * Search for universities using Wikipedia API (more reliable, no API key needed)\n */\nasync function searchWikipediaUniversities(query, limit = 10) {\n  try {\n    const searchUrl = `https://en.wikipedia.org/w/api.php?action=opensearch&search=${encodeURIComponent(query + ' university')}&limit=${limit}&namespace=0&format=json&origin=*`;\n    const response = await fetch(searchUrl);\n    \n    if (!response.ok) return [];\n    \n    const data = await response.json();\n    // data[0] = query, data[1] = titles, data[2] = descriptions, data[3] = urls\n    const titles = data[1] || [];\n    const descriptions = data[2] || [];\n    const urls = data[3] || [];\n    \n    return titles\n      .filter(title => title.toLowerCase().includes('university') || title.toLowerCase().includes('college'))\n      .map((title, index) => ({\n        name: title,\n        description: descriptions[index] || '',\n        website_url: urls[index] || '',\n      }));\n  } catch (error) {\n    console.error('Error searching Wikipedia:', error);\n    return [];\n  }\n}\n\n/**\n * Get prefill data for a university by name from cache\n */\nexport async function getUniversityPrefillData(universityName) {\n  try {\n    const { data, error } = await supabase\n      .rpc('get_university_prefill_data', {\n        p_university_name: universityName,\n      });\n\n    if (error) throw error;\n    return data;\n  } catch (error) {\n    console.error('Error fetching prefill data:', error);\n    return null;\n  }\n}\n\n/**\n * Fetch university data from Google Knowledge Graph (via backend proxy)\n */\nexport async function fetchUniversityDataFromGoogle(universityName) {\n  if (USE_BACKEND_PROXY) {\n    try {\n      const response = await fetch(`${API_URL}/api/university/details?name=${encodeURIComponent(universityName)}`);\n      \n      if (response.ok) {\n        const data = await response.json();\n        return {\n          name: data.university.name || universityName,\n          description: data.university.description || '',\n          website_url: data.university.website_url || '',\n          location: data.university.location || '',\n          established: null,\n          student_count: null,\n          cover_images: data.university.image ? [data.university.image] : [],\n        };\n      }\n    } catch (error) {\n      console.error('Error fetching from Google via proxy:', error);\n    }\n  }\n  \n  return null;\n}\n\n/**\n * Fetch university summary from Wikipedia REST API\n */\nexport async function fetchUniversityDataFromWikipedia(universityName) {\n  try {\n    const url = `https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(universityName)}`;\n    const res = await fetch(url);\n    if (!res.ok) return null;\n    const json = await res.json();\n\n    return {\n      name: json.title || universityName,\n      description: json.extract || '',\n      website_url: '',\n      location: '',\n      established: null,\n      student_count: null,\n      cover_images: json.thumbnail?.source ? [json.thumbnail.source] : [],\n    };\n  } catch (e) {\n    console.error('Error fetching from Wikipedia REST:', e);\n    return null;\n  }\n}\n\n/**\n * Fetch university data from Wikidata\n */\nexport async function fetchUniversityDataFromWikidata(universityName) {\n  try {\n    const sparqlQuery = `\n      SELECT ?item ?itemLabel ?locationLabel ?established ?studentCount ?website\n      WHERE {\n        ?item wdt:P31/wdt:P279* wd:Q3918;\n              rdfs:label ?itemLabel.\n        OPTIONAL { ?item wdt:P131 ?location. }\n        OPTIONAL { ?item wdt:P571 ?established. }\n        OPTIONAL { ?item wdt:P2196 ?studentCount. }\n        OPTIONAL { ?item wdt:P856 ?website. }\n        FILTER(CONTAINS(LCASE(?itemLabel), LCASE(\"${universityName}\")))\n        FILTER(LANG(?itemLabel) = \"en\")\n        SERVICE wikibase:label { bd:serviceParam wikibase:language \"en\". }\n      }\n      LIMIT 1\n    `;\n    const url = `https://query.wikidata.org/sparql?query=${encodeURIComponent(sparqlQuery)}&format=json`;\n    const response = await fetch(url);\n    if (!response.ok) return null;\n\n    const data = await response.json();\n    const binding = data.results.bindings[0];\n\n    if (!binding) return null;\n\n    return {\n      name: binding.itemLabel.value,\n      description: '',\n      website_url: binding.website?.value || '',\n      location: binding.locationLabel?.value || '',\n      established: binding.established?.value ? new Date(binding.established.value).getFullYear() : null,\n      student_count: binding.studentCount?.value || null,\n      cover_images: [],\n    };\n  } catch (error) {\n    console.error('Error fetching from Wikidata:', error);\n    return null;\n  }\n}\n\n/**\n * Fetch Wikimedia Commons images for a university\n */\nexport async function fetchWikimediaImages(universityName) {\n  try {\n    const title = (universityName || '').trim().replace(/\\s+/g, '_');\n    if (!title) return [];\n\n    const listUrl = `https://commons.wikimedia.org/w/api.php?action=query&format=json&origin=*&prop=images&titles=${encodeURIComponent(title)}`;\n    const listRes = await fetch(listUrl);\n    if (!listRes.ok) return [];\n    const listJson = await listRes.json();\n\n    const pages = listJson?.query?.pages ? Object.values(listJson.query.pages) : [];\n    const images = pages[0]?.images || [];\n    if (!images.length) return [];\n\n    const fileTitles = images\n      .map((img) => img?.title)\n      .filter(Boolean)\n      .slice(0, 50)\n      .join('|');\n\n    if (!fileTitles) return [];\n\n    const infoUrl = `https://commons.wikimedia.org/w/api.php?action=query&format=json&origin=*&prop=imageinfo&iiprop=url&titles=${encodeURIComponent(fileTitles)}`;\n    const infoRes = await fetch(infoUrl);\n    if (!infoRes.ok) return [];\n    const infoJson = await infoRes.json();\n\n    const filePages = infoJson?.query?.pages ? Object.values(infoJson.query.pages) : [];\n    const urls = filePages\n      .map((p) => p?.imageinfo?.[0]?.url)\n      .filter((u) => typeof u === 'string' && /\\.(jpg|jpeg|png|webp)$/i.test(u));\n\n    const prioritized = urls.sort((a, b) => {\n      const deprioritize = (s) => /logo|seal|coat_of_arms|emblem/i.test(s) ? 1 : 0;\n      return deprioritize(a) - deprioritize(b);\n    });\n\n    return prioritized.slice(0, 5);\n  } catch (e) {\n    console.error('Error fetching Wikimedia images:', e);\n    return [];\n  }\n}\n\n/**\n * Fetch images from Unsplash (via backend proxy if enabled)\n */\nexport async function fetchUnsplashImages(universityName) {\n  if (USE_BACKEND_PROXY) {\n    try {\n      const response = await fetch(`${API_URL}/api/university/images?query=${encodeURIComponent(universityName)}`);\n      \n      if (response.ok) {\n        const data = await response.json();\n        return data.images?.map(img => img.url) || [];\n      }\n    } catch (error) {\n      console.error('Error fetching Unsplash images via proxy:', error);\n    }\n  }\n  \n  return [];\n}\n\n/**\n * Download image from URL and convert to File object\n */\nexport async function downloadImageAsFile(imageUrl, fileName) {\n  try {\n    const response = await fetch(imageUrl);\n    if (!response.ok) throw new Error('Failed to download image');\n\n    const blob = await response.blob();\n    const file = new File([blob], fileName, { type: blob.type });\n    return file;\n  } catch (error) {\n    console.error('Error downloading image:', error);\n    return null;\n  }\n}\n\n/**\n * Cache university prefill data\n */\nexport async function cacheUniversityPrefillData(universityName, data, source = 'manual') {\n  try {\n    const { error } = await supabase\n      .from('university_prefill_cache')\n      .upsert({\n        university_name: universityName,\n        data: data,\n        source: source,\n        updated_at: new Date().toISOString(),\n      });\n\n    if (error) throw error;\n    return true;\n  } catch (error) {\n    console.error('Error caching prefill data:', error);\n    return false;\n  }\n}\n\n/**\n * Upload multiple images for a university\n */\nexport async function uploadUniversityImages(universityId, imageFiles) {\n  try {\n    const uploadedImages = [];\n    const bucket = 'university-covers';\n\n    for (let i = 0; i < imageFiles.length; i++) {\n      const file = imageFiles[i];\n      const fileExt = file.name.split('.').pop();\n      const fileName = `${universityId}/image_${i + 1}_${Date.now()}.${fileExt}`;\n\n      const { error: uploadError } = await supabase.storage\n        .from(bucket)\n        .upload(fileName, file, {\n          cacheControl: '3600',\n          upsert: false,\n        });\n\n      if (uploadError) {\n        console.error('Error uploading image:', uploadError);\n        continue;\n      }\n\n      const { data: urlData } = supabase.storage\n        .from(bucket)\n        .getPublicUrl(fileName);\n\n      uploadedImages.push({\n        url: urlData.publicUrl,\n        fileName: fileName,\n      });\n    }\n\n    return uploadedImages;\n  } catch (error) {\n    console.error('Error uploading multiple images:', error);\n    throw error;\n  }\n}\n\n/**\n * Add image record to university_images table\n */\nexport async function addUniversityImage(universityId, imageUrl, caption = null, isPrimary = false, displayOrder = 0) {\n  try {\n    const { data, error } = await supabase\n      .rpc('add_university_image', {\n        p_university_id: universityId,\n        p_image_url: imageUrl,\n        p_caption: caption,\n        p_is_primary: isPrimary,\n        p_display_order: displayOrder,\n      });\n\n    if (error) throw error;\n    return data;\n  } catch (error) {\n    console.error('Error adding university image:', error);\n    throw error;\n  }\n}\n\n/**\n * Get all images for a university\n */\nexport async function getUniversityImages(universityId) {\n  try {\n    const { data, error } = await supabase\n      .from('university_images')\n      .select('*')\n      .eq('university_id', universityId)\n      .order('is_primary', { ascending: false })\n      .order('display_order', { ascending: true });\n\n    if (error) throw error;\n    return data || [];\n  } catch (error) {\n    console.error('Error fetching university images:', error);\n    throw error;\n  }\n}\n\n/**\n * Set image as primary\n */\nexport async function setPrimaryUniversityImage(imageId) {\n  try {\n    const { error } = await supabase\n      .rpc('set_primary_university_image', {\n        p_image_id: imageId,\n      });\n\n    if (error) throw error;\n    return true;\n  } catch (error) {\n    console.error('Error setting primary image:', error);\n    return false;\n  }\n}\n\n/**\n * Delete university image\n */\nexport async function deleteUniversityImage(imageId, imageUrl) {\n  try {\n    const urlParts = imageUrl.split('/');\n    const bucket = 'university-covers';\n    const filePath = urlParts.slice(urlParts.indexOf(bucket) + 1).join('/');\n\n    const { error: storageError } = await supabase.storage\n      .from(bucket)\n      .remove([filePath]);\n\n    if (storageError) {\n      console.error('Error deleting from storage:', storageError);\n    }\n\n    const { error: dbError } = await supabase\n      .from('university_images')\n      .delete()\n      .eq('id', imageId);\n\n    if (dbError) throw dbError;\n    return true;\n  } catch (error) {\n    console.error('Error deleting university image:', error);\n    throw error;\n  }\n}\n\n/**\n * Main auto-fill function triggered on tab/input\n */\nexport async function autoFillUniversityData(universityName) {\n  try {\n    // Check cache first\n    let data = await getUniversityPrefillData(universityName);\n    if (data) return data;\n\n    // Prefer Wikipedia + Wikidata for accuracy (no API keys needed)\n    const wikiSummary = await fetchUniversityDataFromWikipedia(universityName);\n    const wikidata = await fetchUniversityDataFromWikidata(universityName);\n\n    if (wikiSummary || wikidata) {\n      const merged = {\n        name: (wikiSummary?.name || wikidata?.name || universityName) ?? universityName,\n        description: wikiSummary?.description || '',\n        website_url: wikidata?.website_url || '',\n        location: wikidata?.location || '',\n        established: wikidata?.established ?? null,\n        student_count: wikidata?.student_count ?? null,\n        cover_images: wikiSummary?.cover_images || [],\n      };\n      data = merged;\n    }\n\n    // Try Google as last resort (via proxy if enabled)\n    if (!data) {\n      data = await fetchUniversityDataFromGoogle(universityName);\n    }\n\n    // Fetch images\n    if (data && (!data.cover_images || data.cover_images.length === 0)) {\n      const commons = await fetchWikimediaImages(data.name || universityName);\n      if (commons.length) {\n        data.cover_images = commons;\n      } else {\n        const unsplash = await fetchUnsplashImages(data.name || universityName);\n        data.cover_images = unsplash;\n      }\n    }\n\n    // Cache the result\n    if (data) {\n      await cacheUniversityPrefillData(universityName, data, 'wikipedia_wikidata');\n    }\n\n    return (\n      data || {\n        name: universityName,\n        description: '',\n        website_url: '',\n        location: '',\n        established: null,\n        student_count: null,\n        cover_images: [],\n      }\n    );\n  } catch (error) {\n    console.error('Error auto-filling university data:', error);\n    return {\n      name: universityName,\n      description: '',\n      website_url: '',\n      location: '',\n      established: null,\n      student_count: null,\n      cover_images: [],\n    };\n  }\n}\n\n/**\n * Get all cached universities for dropdown/autocomplete\n */\nexport async function getAllCachedUniversities() {\n  try {\n    const { data, error } = await supabase\n      .from('university_prefill_cache')\n      .select('university_name')\n      .order('university_name');\n\n    if (error) throw error;\n    return data?.map(u => u.university_name) || [];\n  } catch (error) {\n    console.error('Error fetching cached universities:', error);\n    return [];\n  }\n}\n\n/**\n * Debounce utility\n */\nfunction debounce(func, wait) {\n  let timeout;\n  return (...args) => {\n    clearTimeout(timeout);\n    timeout = setTimeout(() => func(...args), wait);\n  };\n}\n\n/**\n * Frontend integration for auto-fill\n */\nexport function setupAutoFill(inputElement, resultContainer) {\n  inputElement.addEventListener(\n    'input',\n    debounce(async () => {\n      const query = inputElement.value.trim();\n      if (query.length < 3) return;\n\n      const suggestions = await searchUniversityNames(query);\n      console.log('Suggestions:', suggestions);\n      \n      const datalist = document.createElement('datalist');\n      datalist.id = 'university-suggestions';\n      suggestions.forEach(s => {\n        const option = document.createElement('option');\n        option.value = s.name;\n        datalist.appendChild(option);\n      });\n      inputElement.setAttribute('list', 'university-suggestions');\n      inputElement.parentNode.appendChild(datalist);\n    }, 300)\n  );\n\n  inputElement.addEventListener('keydown', async (event) => {\n    if (event.key === 'Tab') {\n      event.preventDefault();\n      const universityName = inputElement.value.trim();\n      if (!universityName) return;\n\n      const data = await autoFillUniversityData(universityName);\n      if (data) {\n        resultContainer.innerHTML = `\n          <h3>${data.name}</h3>\n          <p>${data.description || 'No description available'}</p>\n          <a href=\"${data.website_url || '#'}\" target=\"_blank\">Website</a>\n          <p>Location: ${data.location || 'N/A'}</p>\n          <p>Established: ${data.established || 'N/A'}</p>\n          <p>Students: ${data.student_count || 'N/A'}</p>\n          <div>\n            ${data.cover_images\n              .map(img => `<img src=\"${img}\" alt=\"${data.name} campus\" width=\"200\" style=\"margin-right: 10px;\" />`)\n              .join('')}\n          </div>\n        `;\n      }\n    }\n  });\n}","import React, { useEffect, useState, useCallback, useRef } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { createBookSubmission, createBook, fetchCategories } from '../api';\r\nimport { createUniversitySubmission } from '../campusApi';\r\nimport { createPastPaper, createPastPaperSubmission, getUniversitiesForDropdown, getFacultiesByUniversity, getUnitNamesByUniversityAndFaculty, getYearsByUniversityFacultyAndUnitName, checkDuplicatePastPaper } from '../pastPapersApi';\r\nimport { \r\n  autoFillUniversityData, \r\n  searchUniversityNames,\r\n  uploadUniversityImages,\r\n  addUniversityImage,\r\n  downloadImageAsFile,\r\n  fetchWikimediaImages,\r\n  fetchUnsplashImages\r\n} from '../universityPrefillApi';\r\nimport { FiUpload, FiFile, FiImage, FiBook, FiMapPin, FiFileText, FiSearch, FiX, FiLoader } from 'react-icons/fi';\r\nimport { useAdminUI } from '../AdminUIContext';\r\nimport * as pdfjsLib from 'pdfjs-dist';\r\n\r\n// Simple debounce hook\r\nfunction useDebounce(callback, delay) {\r\n  const timeoutRef = useRef(null);\r\n  return useCallback((...args) => {\r\n    if (timeoutRef.current) {\r\n      clearTimeout(timeoutRef.current);\r\n    }\r\n    timeoutRef.current = setTimeout(() => callback(...args), delay);\r\n  }, [callback, delay]);\r\n}\r\n\r\n// Add styles for drag and drop effect and tabs\r\nconst dropzoneStyles = `\r\n  .dropzone {\r\n    border: 2px dashed #374151;\r\n    border-radius: 8px;\r\n    padding: 20px;\r\n    text-align: center;\r\n    cursor: pointer;\r\n    transition: all 0.3s ease;\r\n  }\r\n  .dropzone:hover {\r\n    border-color: #00a884;\r\n    background: rgba(0, 168, 132, 0.05);\r\n  }\r\n  .dropzone.drag-over {\r\n    border-color: #00a884;\r\n    background: rgba(0, 168, 132, 0.1);\r\n  }\r\n  .upload-tabs {\r\n    display: flex;\r\n    gap: 8px;\r\n    margin-bottom: 20px;\r\n    border-bottom: 2px solid #374151;\r\n  }\r\n  .upload-tab {\r\n    display: flex;\r\n    align-items: center;\r\n    gap: 8px;\r\n    padding: 12px 24px;\r\n    background: transparent;\r\n    border: none;\r\n    color: #8696a0;\r\n    cursor: pointer;\r\n    font-size: 16px;\r\n    font-weight: 500;\r\n    transition: all 0.3s ease;\r\n    border-bottom: 3px solid transparent;\r\n    margin-bottom: -2px;\r\n  }\r\n  .upload-tab:hover {\r\n    color: #e9edef;\r\n    background: rgba(0, 168, 132, 0.05);\r\n  }\r\n  .upload-tab.active {\r\n    color: #00a884;\r\n    border-bottom-color: #00a884;\r\n  }\r\n  @keyframes spin {\r\n    from { transform: rotate(0deg); }\r\n    to { transform: rotate(360deg); }\r\n  }\r\n  .spin {\r\n    animation: spin 1s linear infinite;\r\n  }\r\n`;\r\n\r\nconst Upload = ({ userProfile, initialTab = 'books' }) => {\r\n  // Add style tag to document\r\n  useEffect(() => {\r\n    const styleTag = document.createElement('style');\r\n    styleTag.innerHTML = dropzoneStyles;\r\n    document.head.appendChild(styleTag);\r\n    return () => styleTag.remove();\r\n  }, []);\r\n\r\n  const [activeTab, setActiveTab] = useState(initialTab); // 'books', 'campus', 'pastpapers'\r\n  const navigate = useNavigate();\r\n  const { showToast } = useAdminUI();\r\n\r\n  // Update active tab when initialTab prop changes\r\n  useEffect(() => {\r\n    setActiveTab(initialTab);\r\n  }, [initialTab]);\r\n  \r\n  // Books state\r\n  const [pdf, setPdf] = useState(null);\r\n  const [cover, setCover] = useState(null);\r\n  const [categories, setCategories] = useState([]);\r\n  const [bookForm, setBookForm] = useState({ \r\n    title: '', author: '', description: '', category_id: '', \r\n    year: '', language: '', isbn: '', pages: '', publisher: '' \r\n  });\r\n\r\n  // Campus state\r\n  const [campusImages, setCampusImages] = useState([]);\r\n  const [campusForm, setCampusForm] = useState({ \r\n    name: '', description: '', website_url: '', location: '', \r\n    established: '', student_count: '' \r\n  });\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [searchResults, setSearchResults] = useState([]);\r\n  const [showSearchResults, setShowSearchResults] = useState(false);\r\n  const [isAutoFilling, setIsAutoFilling] = useState(false);\r\n\r\n  // Past Papers state\r\n  const [paperPdf, setPaperPdf] = useState(null);\r\n  const [universities, setUniversities] = useState([]);\r\n  const [faculties, setFaculties] = useState([]);\r\n  const [unitNames, setUnitNames] = useState([]);\r\n  const [years, setYears] = useState([]);\r\n  const [paperForm, setPaperForm] = useState({ \r\n    university_id: '', faculty: '', unit_code: '', \r\n    unit_name: '', year: '', semester: '', exam_type: '' \r\n  });\r\n  \r\n  // Custom value states for Faculty, Unit Name, and Year\r\n  const [useCustomFaculty, setUseCustomFaculty] = useState(false);\r\n  const [customFaculty, setCustomFaculty] = useState('');\r\n  const [useCustomUnitName, setUseCustomUnitName] = useState(false);\r\n  const [customUnitName, setCustomUnitName] = useState('');\r\n  const [useCustomYear, setUseCustomYear] = useState(false);\r\n  const [customYear, setCustomYear] = useState('');\r\n  \r\n  // Success state for past paper upload\r\n  const [lastUploadedPaper, setLastUploadedPaper] = useState(null);\r\n\r\n  const [busy, setBusy] = useState(false);\r\n  const [extractingCover, setExtractingCover] = useState(false);\r\n\r\n  useEffect(() => { \r\n    (async () => { \r\n      try { \r\n        setCategories(await fetchCategories()); \r\n        setUniversities(await getUniversitiesForDropdown());\r\n      } catch {} \r\n    })(); \r\n  }, []);\r\n\r\n  // Auto-extract cover from PDF when PDF is selected\r\n  useEffect(() => {\r\n    if (!pdf) return;\r\n\r\n    const extractCoverFromPDF = async () => {\r\n      setExtractingCover(true);\r\n      try {\r\n        // Set worker if not already set - use local worker file\r\n        if (!pdfjsLib.GlobalWorkerOptions.workerSrc) {\r\n          pdfjsLib.GlobalWorkerOptions.workerSrc = '/pdf.worker.min.mjs';\r\n        }\r\n\r\n        const arrayBuffer = await pdf.arrayBuffer();\r\n        \r\n        // Add a small delay to ensure worker is initialized\r\n        await new Promise(resolve => setTimeout(resolve, 100));\r\n        \r\n        const pdfDoc = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;\r\n        \r\n        if (pdfDoc && pdfDoc.numPages > 0) {\r\n          try {\r\n            const page = await pdfDoc.getPage(1);\r\n            const viewport = page.getViewport({ scale: 2 });\r\n            const canvas = document.createElement('canvas');\r\n            canvas.width = viewport.width;\r\n            canvas.height = viewport.height;\r\n            \r\n            const context = canvas.getContext('2d');\r\n            if (context) {\r\n              await page.render({ canvasContext: context, viewport }).promise;\r\n              \r\n              // Convert canvas to blob and create a file\r\n              canvas.toBlob((blob) => {\r\n                if (blob) {\r\n                  const coverFile = new File([blob], `${pdf.name.replace('.pdf', '')}_cover.png`, { type: 'image/png' });\r\n                  setCover(coverFile);\r\n                  showToast({ type: 'success', message: 'Cover image extracted from PDF!' });\r\n                }\r\n              }, 'image/png', 0.95);\r\n            }\r\n          } catch (pageError) {\r\n            console.warn('Could not render PDF page:', pageError);\r\n            showToast({ type: 'info', message: 'Could not auto-extract cover. You can upload one manually.' });\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.error('Error extracting cover from PDF:', error);\r\n        // Don't show error toast - this is optional, user can upload manual cover\r\n        showToast({ type: 'info', message: 'Could not auto-extract cover. You can upload one manually.' });\r\n      } finally {\r\n        setExtractingCover(false);\r\n      }\r\n    };\r\n\r\n    extractCoverFromPDF();\r\n  }, [pdf, showToast]);\r\n\r\n  const onBookChange = (k) => (e) => setBookForm((f) => ({ ...f, [k]: e.target.value }));\r\n  const onCampusChange = (k) => (e) => {\r\n    setCampusForm((f) => ({ ...f, [k]: e.target.value }));\r\n    // If changing name, trigger search\r\n    if (k === 'name') {\r\n      setSearchQuery(e.target.value);\r\n      debouncedSearch(e.target.value);\r\n    }\r\n  };\r\n\r\n  // Debounced search for universities\r\n  const handleSearchUniversities = async (query) => {\r\n    if (query.length < 2) {\r\n      setSearchResults([]);\r\n      setShowSearchResults(false);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const results = await searchUniversityNames(query);\r\n      setSearchResults(results);\r\n      setShowSearchResults(results.length > 0);\r\n    } catch (error) {\r\n      console.error('Error searching:', error);\r\n    }\r\n  };\r\n  const debouncedSearch = useDebounce(handleSearchUniversities, 300);\r\n\r\n  // Auto-fill university data\r\n  const handleAutoFill = async (universityName) => {\r\n    setIsAutoFilling(true);\r\n    setShowSearchResults(false);\r\n\r\n    try {\r\n      const data = await autoFillUniversityData(universityName || campusForm.name);\r\n      \r\n      if (data) {\r\n        setCampusForm({\r\n          name: data.name || '',\r\n          description: data.description || '',\r\n          website_url: data.website_url || '',\r\n          location: data.location || '',\r\n          established: data.established?.toString() || '',\r\n          student_count: data.student_count?.toString() || ''\r\n        });\r\n        \r\n        // Download images if available\r\n        if (data.cover_images && data.cover_images.length > 0) {\r\n          const downloadedImages = [];\r\n          \r\n          for (let i = 0; i < Math.min(data.cover_images.length, 5); i++) {\r\n            const imageUrl = data.cover_images[i];\r\n            const fileName = `${data.name.replace(/\\s+/g, '_')}_image_${i + 1}.jpg`;\r\n            \r\n            try {\r\n              const imageFile = await downloadImageAsFile(imageUrl, fileName);\r\n              if (imageFile) {\r\n                downloadedImages.push(imageFile);\r\n              }\r\n            } catch (err) {\r\n              console.error('Error downloading image:', err);\r\n            }\r\n          }\r\n          \r\n          if (downloadedImages.length > 0) {\r\n            setCampusImages(downloadedImages);\r\n            showToast({ type: 'success', message: `Auto-filled data for ${data.name} with ${downloadedImages.length} image(s)!` });\r\n          } else {\r\n            showToast({ type: 'info', message: `Auto-filled data for ${data.name}! But images could not be downloaded, please upload manually.` });\r\n          }\r\n        } else {\r\n          // Prefer Wikimedia Commons fallback, then Unsplash\r\n          let urls = await fetchWikimediaImages(data.name);\r\n          if (!urls.length) {\r\n            urls = await fetchUnsplashImages(data.name);\r\n          }\r\n\r\n          if (urls.length > 0) {\r\n            const downloadedImages = [];\r\n            for (let i = 0; i < urls.length; i++) {\r\n              try {\r\n                const fileName = `${data.name.replace(/\\s+/g, '_')}_auto_${i + 1}.jpg`;\r\n                const file = await downloadImageAsFile(urls[i], fileName);\r\n                if (file) downloadedImages.push(file);\r\n              } catch (err) {\r\n                console.error('Auto image download error:', err);\r\n              }\r\n            }\r\n\r\n            if (downloadedImages.length > 0) {\r\n              setCampusImages(downloadedImages);\r\n              showToast({ type: 'success', message: `Auto-filled data for ${data.name} with ${downloadedImages.length} image(s)!` });\r\n            } else {\r\n              showToast({ type: 'info', message: `Auto-filled data for ${data.name}, but images couldn't be downloaded.` });\r\n            }\r\n          } else {\r\n            showToast({ type: 'info', message: `Auto-filled data for ${data.name}, but no images were found automatically.` });\r\n          }\r\n        }\r\n      } else {\r\n        showToast({ type: 'info', message: 'No data found for this university. Please enter details manually.' });\r\n      }\r\n    } catch (error) {\r\n      console.error('Error auto-filling:', error);\r\n      showToast({ type: 'error', message: 'Failed to auto-fill data. Please try again.' });\r\n    } finally {\r\n      setIsAutoFilling(false);\r\n    }\r\n  };\r\n  const onPaperChange = (k) => async (e) => {\r\n    const value = e.target.value;\r\n    setPaperForm((f) => ({ ...f, [k]: value }));\r\n    \r\n    // When university changes, fetch faculties for that university\r\n    if (k === 'university_id' && value) {\r\n      try {\r\n        const facultiesData = await getFacultiesByUniversity(value);\r\n        setFaculties(facultiesData);\r\n        // Reset faculty, unit name, and year selection when university changes\r\n        setPaperForm((f) => ({ ...f, faculty: '', unit_name: '', year: '' }));\r\n        setUnitNames([]);\r\n        setYears([]);\r\n      } catch (error) {\r\n        console.error('Error fetching faculties:', error);\r\n        setFaculties([]);\r\n      }\r\n    }\r\n    \r\n    // When faculty changes, fetch unit names for that faculty and university\r\n    if (k === 'faculty' && value && paperForm.university_id) {\r\n      try {\r\n        const unitNamesData = await getUnitNamesByUniversityAndFaculty(paperForm.university_id, value);\r\n        setUnitNames(unitNamesData);\r\n        // Reset unit name and year selection when faculty changes\r\n        setPaperForm((f) => ({ ...f, unit_name: '', year: '' }));\r\n        setYears([]);\r\n      } catch (error) {\r\n        console.error('Error fetching unit names:', error);\r\n        setUnitNames([]);\r\n      }\r\n    }\r\n    \r\n    // When unit name changes, fetch years for that unit, faculty, and university\r\n    if (k === 'unit_name' && value && paperForm.university_id && paperForm.faculty) {\r\n      try {\r\n        const yearsData = await getYearsByUniversityFacultyAndUnitName(paperForm.university_id, paperForm.faculty, value);\r\n        setYears(yearsData);\r\n        // Reset year selection when unit name changes\r\n        setPaperForm((f) => ({ ...f, year: '' }));\r\n      } catch (error) {\r\n        console.error('Error fetching years:', error);\r\n        setYears([]);\r\n      }\r\n    }\r\n  };\r\n\r\n  const submitBook = async () => {\r\n    if (!pdf) { showToast({ type: 'error', message: 'Please choose a PDF file.' }); return; }\r\n    setBusy(true);\r\n    try {\r\n      const metadata = {\r\n        title: bookForm.title || (pdf?.name?.replace(/\\.[^/.]+$/, '') || ''),\r\n        author: bookForm.author || 'Unknown',\r\n        description: bookForm.description || '',\r\n        category_id: bookForm.category_id || null,\r\n        year: bookForm.year ? Number(bookForm.year) : null,\r\n        language: bookForm.language || '',\r\n        isbn: bookForm.isbn || '',\r\n        pages: bookForm.pages ? Number(bookForm.pages) : 0,\r\n        publisher: bookForm.publisher || '',\r\n        uploaded_by: userProfile?.id || null\r\n      };\r\n      \r\n      // Check if user is admin or editor - if so, directly upload; otherwise submit for approval\r\n      const isAdmin = userProfile?.role === 'admin' || userProfile?.role === 'editor';\r\n      \r\n      if (isAdmin) {\r\n        await createBook({ metadata, pdfFile: pdf, coverFile: cover });\r\n        showToast({ type: 'success', message: 'Book uploaded successfully!' });\r\n      } else {\r\n        await createBookSubmission({ metadata, pdfFile: pdf, coverFile: cover });\r\n        showToast({ type: 'success', message: 'Book submitted for approval. Admin will review it shortly.' });\r\n      }\r\n      \r\n      // Reset form\r\n      setPdf(null);\r\n      setCover(null);\r\n      setBookForm({ title: '', author: '', description: '', category_id: '', year: '', language: '', isbn: '', pages: '', publisher: '' });\r\n      navigate('/user/upload');\r\n    } catch (e) {\r\n      console.error('Book upload failed:', e);\r\n      showToast({ type: 'error', message: e?.message || 'Upload failed.' });\r\n    } finally { setBusy(false); }\r\n  };\r\n\r\n  const submitCampus = async () => {\r\n    if (!campusForm.name) { showToast({ type: 'error', message: 'Please enter university name.' }); return; }\r\n    setBusy(true);\r\n    try {\r\n      const metadata = {\r\n        name: campusForm.name,\r\n        description: campusForm.description || '',\r\n        website_url: campusForm.website_url || '',\r\n        location: campusForm.location || '',\r\n        established: campusForm.established ? Number(campusForm.established) : null,\r\n        student_count: campusForm.student_count ? Number(campusForm.student_count) : 0\r\n      };\r\n      \r\n      // Create university submission (use first image as cover)\r\n      const primaryImage = campusImages[0] || null;\r\n      const result = await createUniversitySubmission({ metadata, coverFile: primaryImage });\r\n      const universityId = result.id;\r\n      \r\n      // Note: Additional images would be uploaded after approval\r\n      // For now, only primary image is saved with submission\r\n      \r\n      showToast({ type: 'success', message: `University submitted for approval with ${campusImages.length} image(s)!` });\r\n      // Reset form\r\n      setCampusForm({ name: '', description: '', website_url: '', location: '', established: '', student_count: '' });\r\n      setCampusImages([]);\r\n      navigate('/user/upload');\r\n    } catch (e) {\r\n      console.error('University upload failed:', e);\r\n      showToast({ type: 'error', message: e?.message || 'Upload failed.' });\r\n    } finally { setBusy(false); }\r\n  };\r\n\r\n  const submitPastPaper = async () => {\r\n    if (!paperPdf) { showToast({ type: 'error', message: 'Please choose a PDF file.' }); return; }\r\n    if (!paperForm.university_id) { showToast({ type: 'error', message: 'Please select a university.' }); return; }\r\n    \r\n    // Validate faculty - either from dropdown or custom input\r\n    const faculty = useCustomFaculty ? customFaculty : paperForm.faculty;\r\n    if (!faculty) { showToast({ type: 'error', message: 'Please enter faculty.' }); return; }\r\n    \r\n    if (!paperForm.unit_code) { showToast({ type: 'error', message: 'Please enter unit code.' }); return; }\r\n    \r\n    // Validate unit name - either from dropdown or custom input\r\n    const unitName = useCustomUnitName ? customUnitName : paperForm.unit_name;\r\n    if (!unitName) { showToast({ type: 'error', message: 'Please enter unit name.' }); return; }\r\n    \r\n    // Validate year - either from dropdown or custom input\r\n    const year = useCustomYear ? customYear : paperForm.year;\r\n    if (!year) { showToast({ type: 'error', message: 'Please enter year.' }); return; }\r\n    \r\n    setBusy(true);\r\n    try {\r\n      // Check for duplicate paper before uploading\r\n      const duplicateCheck = await checkDuplicatePastPaper({\r\n        universityId: paperForm.university_id,\r\n        faculty: faculty,\r\n        unitCode: paperForm.unit_code,\r\n        unitName: unitName,\r\n        year: year\r\n      });\r\n\r\n      if (duplicateCheck.exists) {\r\n        showToast({ \r\n          type: 'warning', \r\n          message: `This past paper (${paperForm.unit_code} - ${unitName} for ${year}) already exists in the system.` \r\n        });\r\n        setBusy(false);\r\n        return;\r\n      }\r\n\r\n      // Show instant success feedback\r\n      showToast({ type: 'success', message: 'Past paper submitted! Processing...' });\r\n      \r\n      const metadata = {\r\n        title: `${paperForm.unit_code} - ${unitName}`,\r\n        university_id: paperForm.university_id || null,\r\n        faculty: faculty,\r\n        unit_code: paperForm.unit_code,\r\n        unit_name: unitName,\r\n        year: year ? Number(year) : null,\r\n        semester: paperForm.semester || '',\r\n        exam_type: paperForm.exam_type || 'Main',\r\n        uploaded_by: userProfile?.id || null\r\n      };\r\n      \r\n      console.log(' Submitting past paper with metadata:', JSON.stringify(metadata, null, 2));\r\n      console.log(' Current form state:', JSON.stringify(paperForm, null, 2));\r\n      \r\n      // Reset form for next upload\r\n      setPaperForm({ university_id: '', faculty: '', unit_code: '', unit_name: '', year: '', semester: '', exam_type: '' });\r\n      setCustomFaculty('');\r\n      setCustomUnitName('');\r\n      setCustomYear('');\r\n      setUseCustomFaculty(false);\r\n      setUseCustomUnitName(false);\r\n      setUseCustomYear(false);\r\n      setPaperPdf(null);\r\n      setFaculties([]);\r\n      setUnitNames([]);\r\n      setYears([]);\r\n      \r\n      // Determine if admin or user - admins get instant display, users get approval workflow\r\n      const isAdmin = userProfile?.role === 'admin' || userProfile?.role === 'editor';\r\n      const uploadFunction = isAdmin ? createPastPaper : createPastPaperSubmission;\r\n      \r\n      // Fire upload in background without waiting\r\n      uploadFunction({ metadata, pdfFile: paperPdf }).catch((e) => {\r\n        console.error('Past paper upload failed:', e);\r\n        showToast({ type: 'error', message: e?.message || 'Upload failed.' });\r\n      });\r\n    } catch (e) {\r\n      console.error('Upload validation failed:', e);\r\n      showToast({ type: 'error', message: e?.message || 'Upload validation failed.' });\r\n    } finally { setBusy(false); }\r\n  };\r\n\r\n  // Render dropzone component\r\n  const renderDropzone = (file, setFile, accept, fileType, icon) => (\r\n    <div\r\n      className=\"dropzone\"\r\n      onDragOver={(e) => {\r\n        e.preventDefault();\r\n        e.currentTarget.classList.add('drag-over');\r\n      }}\r\n      onDragLeave={(e) => {\r\n        e.preventDefault();\r\n        e.currentTarget.classList.remove('drag-over');\r\n      }}\r\n      onDrop={(e) => {\r\n        e.preventDefault();\r\n        e.currentTarget.classList.remove('drag-over');\r\n        const droppedFile = e.dataTransfer.files[0];\r\n        if (droppedFile && droppedFile.type.match(accept)) {\r\n          setFile(droppedFile);\r\n        }\r\n      }}\r\n      onClick={() => document.getElementById(`${fileType}-input`).click()}\r\n      style={{\r\n        border: '2px dashed #374151',\r\n        borderRadius: '8px',\r\n        padding: '20px',\r\n        textAlign: 'center',\r\n        cursor: 'pointer',\r\n        background: file ? 'rgba(0, 168, 132, 0.1)' : 'transparent',\r\n        transition: 'all 0.3s ease'\r\n      }}\r\n    >\r\n      <input\r\n        id={`${fileType}-input`}\r\n        type=\"file\"\r\n        accept={accept}\r\n        onChange={(e) => setFile(e.target.files?.[0] || null)}\r\n        style={{ display: 'none' }}\r\n      />\r\n      {file ? (\r\n        <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '10px', color: '#00a884' }}>\r\n          {icon}\r\n          <span>{file.name}</span>\r\n        </div>\r\n      ) : (\r\n        <div>\r\n          <FiUpload size={20} style={{ marginBottom: '4px', color: '#8696a0' }} />\r\n          <div style={{ color: '#e9edef' }}>Drag and drop or click to browse</div>\r\n          <div style={{ color: '#8696a0', fontSize: '0.85em', marginTop: '2px' }}>\r\n            {accept === 'application/pdf' ? 'PDF files only' : 'Image files (JPG, PNG, GIF)'}\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <div className=\"panel\">\r\n      <div className=\"panel-title\">Upload Content</div>\r\n      \r\n      {/* Tabs */}\r\n      <div className=\"upload-tabs\">\r\n        <button \r\n          className={`upload-tab ${activeTab === 'books' ? 'active' : ''}`}\r\n          onClick={() => setActiveTab('books')}\r\n        >\r\n          <FiBook size={20} />\r\n          Books\r\n        </button>\r\n        <button \r\n          className={`upload-tab ${activeTab === 'campus' ? 'active' : ''}`}\r\n          onClick={() => setActiveTab('campus')}\r\n        >\r\n          <FiMapPin size={20} />\r\n          Campus\r\n        </button>\r\n        <button \r\n          className={`upload-tab ${activeTab === 'pastpapers' ? 'active' : ''}`}\r\n          onClick={() => setActiveTab('pastpapers')}\r\n        >\r\n          <FiFileText size={20} />\r\n          Past Papers\r\n        </button>\r\n      </div>\r\n\r\n      {/* Books Tab */}\r\n      {activeTab === 'books' && (\r\n        <div className=\"grid-2\">\r\n          <div className=\"panel\">\r\n            <label className=\"label\">PDF File</label>\r\n            {renderDropzone(pdf, setPdf, 'application/pdf', 'pdf', <FiFile size={24} />)}\r\n            \r\n            <label className=\"label\" style={{ marginTop: 20 }}>\r\n              Cover Image (optional)\r\n              {extractingCover && <span style={{ marginLeft: '8px', color: '#00a884', fontSize: '0.9em' }}>(Extracting...)</span>}\r\n            </label>\r\n            {renderDropzone(cover, setCover, 'image/*', 'cover', <FiImage size={24} />)}\r\n          </div>\r\n          <div className=\"panel\">\r\n            <label className=\"label\">Title</label>\r\n            <input className=\"input\" placeholder=\"Book title\" value={bookForm.title} onChange={onBookChange('title')} />\r\n            <label className=\"label\" style={{ marginTop: 10 }}>Author</label>\r\n            <input className=\"input\" placeholder=\"Author\" value={bookForm.author} onChange={onBookChange('author')} />\r\n            <label className=\"label\" style={{ marginTop: 10 }}>Description</label>\r\n            <textarea className=\"input\" rows={5} placeholder=\"Short description\" value={bookForm.description} onChange={onBookChange('description')} />\r\n\r\n            <div className=\"grid-2\" style={{ marginTop: 10 }}>\r\n              <div>\r\n                <label className=\"label\">Category</label>\r\n                <select className=\"select\" value={bookForm.category_id} onChange={onBookChange('category_id')}>\r\n                  <option value=\"\">Uncategorized</option>\r\n                  {categories.map(c => <option key={c.id} value={c.id}>{c.name}</option>)}\r\n                </select>\r\n              </div>\r\n              <div>\r\n                <label className=\"label\">Year</label>\r\n                <input className=\"input\" placeholder=\"Year\" value={bookForm.year} onChange={onBookChange('year')} />\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"grid-2\" style={{ marginTop: 10 }}>\r\n              <div>\r\n                <label className=\"label\">Language</label>\r\n                <input className=\"input\" placeholder=\"English\" value={bookForm.language} onChange={onBookChange('language')} />\r\n              </div>\r\n              <div>\r\n                <label className=\"label\">ISBN</label>\r\n                <input className=\"input\" placeholder=\"978-0-123456-78-9\" value={bookForm.isbn} onChange={onBookChange('isbn')} />\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"grid-2\" style={{ marginTop: 10 }}>\r\n              <div>\r\n                <label className=\"label\">Pages</label>\r\n                <input className=\"input\" type=\"number\" placeholder=\"Number of pages\" value={bookForm.pages} onChange={onBookChange('pages')} />\r\n              </div>\r\n              <div>\r\n                <label className=\"label\">Publisher</label>\r\n                <input className=\"input\" placeholder=\"Publisher name\" value={bookForm.publisher} onChange={onBookChange('publisher')} />\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"actions\" style={{ marginTop: 12 }}>\r\n              <button className=\"btn primary\" disabled={busy} onClick={submitBook}>{busy ? 'Uploading...' : 'Upload Book'}</button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Campus Tab */}\r\n      {activeTab === 'campus' && (\r\n        <div className=\"grid-2\">\r\n          <div className=\"panel\">\r\n            <label className=\"label\">University Cover Images (Multiple)</label>\r\n            <input \r\n              type=\"file\"\r\n              accept=\"image/*\"\r\n              multiple\r\n              onChange={(e) => setCampusImages(Array.from(e.target.files))}\r\n              style={{ marginBottom: '10px' }}\r\n              className=\"input\"\r\n            />\r\n            {campusImages.length > 0 && (\r\n            <div style={{ marginTop: '10px', color: '#00a884' }}>\r\n               {campusImages.length} image(s) selected\r\n              <button \r\n                onClick={() => setCampusImages([])}\r\n                style={{ marginLeft: '10px', color: '#dc2626', background: 'none', border: 'none', cursor: 'pointer' }}\r\n              >\r\n                <FiX /> Clear\r\n              </button>\r\n            </div>\r\n          )}\r\n            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '4px', marginTop: '6px' }}>\r\n            {campusImages.map((img, idx) => (\r\n              <div key={idx} style={{ position: 'relative', border: '2px solid #374151', borderRadius: '8px', overflow: 'hidden' }}>\r\n                <img src={URL.createObjectURL(img)} alt={`Preview ${idx + 1}`} style={{ width: '100%', height: '120px', objectFit: 'cover' }} />\r\n                {/* Remove (X) button */}\r\n                <button\r\n                  aria-label=\"Remove image\"\r\n                  title=\"Remove\"\r\n                  onClick={() => setCampusImages((prev) => prev.filter((_, i) => i !== idx))}\r\n                  style={{\r\n                    position: 'absolute',\r\n                    top: '6px',\r\n                    left: '6px',\r\n                    width: '20px',\r\n                    height: '20px',\r\n                    padding: '2px',\r\n                    borderRadius: '6px',\r\n                    fontWeight: 'bold',\r\n                    border: 'none',\r\n                    cursor: 'pointer',\r\n                    background: '#a08f8f96',\r\n                    color: '#111010ff',\r\n                    display: 'flex',\r\n                    alignItems: 'center',\r\n                    justifyContent: 'center',\r\n                    boxShadow: '0 2px 6px rgba(0,0,0,0.4)'\r\n                  }}\r\n                >X\r\n                  {/* <FiX size={36} /> */}\r\n                </button>\r\n                <div style={{ position: 'absolute', top: '4px', right: '4px', background: 'rgba(0,0,0,0.7)', padding: '4px 8px', borderRadius: '4px', color: 'white', fontSize: '12px' }}>\r\n                  {idx === 0 ? 'Primary' : `#${idx + 1}`}\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n          </div>\r\n          <div className=\"panel\">\r\n            <label className=\"label\">University Name *</label>\r\n            <div style={{ position: 'relative' }}>\r\n              <input \r\n                className=\"input\" \r\n                placeholder=\"e.g., University of Nairobi\" \r\n                value={campusForm.name} \r\n                onChange={onCampusChange('name')}\r\n                style={{ paddingRight: '80px' }}\r\n              />\r\n              <button \r\n                onClick={() => handleAutoFill()}\r\n                disabled={!campusForm.name || isAutoFilling}\r\n                style={{\r\n                  position: 'absolute',\r\n                  right: '8px',\r\n                  top: '50%',\r\n                  transform: 'translateY(-50%)',\r\n                  background: '#00a884',\r\n                  color: 'white',\r\n                  border: 'none',\r\n                  padding: '6px 12px',\r\n                  borderRadius: '4px',\r\n                  cursor: campusForm.name && !isAutoFilling ? 'pointer' : 'not-allowed',\r\n                  fontSize: '12px',\r\n                  opacity: campusForm.name && !isAutoFilling ? 1 : 0.5,\r\n                  display: 'flex',\r\n                  alignItems: 'center',\r\n                  gap: '4px'\r\n                }}\r\n              >\r\n                {isAutoFilling ? <><FiLoader className=\"spin\" /> Loading</> : <><FiSearch /> Auto-Fill</>}\r\n              </button>\r\n              \r\n              {/* Search Results Dropdown */}\r\n              {showSearchResults && searchResults.length > 0 && (\r\n                <div style={{\r\n                  position: 'absolute',\r\n                  top: '100%',\r\n                  left: 0,\r\n                  right: 0,\r\n                  background: '#202c33',\r\n                  border: '1px solid #374151',\r\n                  borderRadius: '8px',\r\n                  marginTop: '4px',\r\n                  maxHeight: '200px',\r\n                  overflowY: 'auto',\r\n                  zIndex: 1000,\r\n                  boxShadow: '0 4px 6px rgba(0,0,0,0.3)'\r\n                }}>\r\n                  {searchResults.map((result, idx) => (\r\n                    <div\r\n                      key={idx}\r\n                      onClick={() => handleAutoFill(result.university_name)}\r\n                      style={{\r\n                        padding: '10px',\r\n                        cursor: 'pointer',\r\n                        borderBottom: idx < searchResults.length - 1 ? '1px solid #374151' : 'none',\r\n                        transition: 'background 0.2s'\r\n                      }}\r\n                      onMouseEnter={(e) => e.target.style.background = 'rgba(0, 168, 132, 0.1)'}\r\n                      onMouseLeave={(e) => e.target.style.background = 'transparent'}\r\n                    >\r\n                      {result.university_name}\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </div>\r\n            \r\n            <label className=\"label\" style={{ marginTop: 10 }}>Description</label>\r\n            <textarea className=\"input\" rows={4} placeholder=\"Brief description about the university\" value={campusForm.description} onChange={onCampusChange('description')} />\r\n\r\n            <div className=\"grid-2\" style={{ marginTop: 10 }}>\r\n              <div>\r\n                <label className=\"label\">Location</label>\r\n                <input className=\"input\" placeholder=\"e.g., Nairobi\" value={campusForm.location} onChange={onCampusChange('location')} />\r\n              </div>\r\n              <div>\r\n                <label className=\"label\">Website URL</label>\r\n                <input className=\"input\" placeholder=\"https://...\" value={campusForm.website_url} onChange={onCampusChange('website_url')} />\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"grid-2\" style={{ marginTop: 10 }}>\r\n              <div>\r\n                <label className=\"label\">Established Year</label>\r\n                <input className=\"input\" type=\"number\" placeholder=\"e.g., 1956\" value={campusForm.established} onChange={onCampusChange('established')} />\r\n              </div>\r\n              <div>\r\n                <label className=\"label\">Student Count</label>\r\n                <input className=\"input\" type=\"number\" placeholder=\"e.g., 84000\" value={campusForm.student_count} onChange={onCampusChange('student_count')} />\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"actions\" style={{ marginTop: 12 }}>\r\n              <button className=\"btn primary\" disabled={busy} onClick={submitCampus}>{busy ? 'Adding...' : 'Add University'}</button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Past Papers Tab */}\r\n      {activeTab === 'pastpapers' && (\r\n        <div className=\"grid-2\">\r\n          <div className=\"panel\">\r\n            <label className=\"label\">Past Paper PDF *</label>\r\n            {renderDropzone(paperPdf, setPaperPdf, 'application/pdf', 'paper-pdf', <FiFile size={24} />)}\r\n          </div>\r\n          <div className=\"panel\">\r\n            <label className=\"label\">University *</label>\r\n            <select className=\"select\" value={paperForm.university_id} onChange={onPaperChange('university_id')}>\r\n              <option value=\"\">Select University</option>\r\n              {universities.map(u => <option key={u.id} value={u.id}>{u.name}</option>)}\r\n            </select>\r\n\r\n            <label className=\"label\" style={{ marginTop: 10 }}>Faculty *</label>\r\n            {!useCustomFaculty ? (\r\n              <select className=\"select\" value={paperForm.faculty} onChange={onPaperChange('faculty')} disabled={!paperForm.university_id || faculties.length === 0}>\r\n                <option value=\"\">\r\n                  {!paperForm.university_id ? 'Select a university first' : faculties.length === 0 ? 'No faculties available' : 'Select Faculty'}\r\n                </option>\r\n                {faculties.map(f => <option key={f} value={f}>{f}</option>)}\r\n              </select>\r\n            ) : (\r\n              <input \r\n                className=\"input\" \r\n                placeholder=\"e.g., Engineering, Business, Arts\" \r\n                value={customFaculty} \r\n                onChange={(e) => setCustomFaculty(e.target.value)}\r\n                style={{\r\n                  backgroundColor: '#1f2c33',\r\n                  color: '#ffffff',\r\n                  border: '1px solid #333',\r\n                  borderRadius: '8px',\r\n                  padding: '10px 12px',\r\n                  width: '100%',\r\n                  outline: 'none',\r\n                  transition: 'border-color 0.2s ease'\r\n                }}\r\n                onFocus={(e) => e.target.style.borderColor = '#00a884'}\r\n                onBlur={(e) => e.target.style.borderColor = '#333'}\r\n              />\r\n            )}\r\n            <div style={{ display: 'flex', alignItems: 'center', gap: '6px', marginTop: '6px' }}>\r\n              <input \r\n                type=\"checkbox\" \r\n                id=\"custom-faculty-toggle\"\r\n                checked={useCustomFaculty}\r\n                onChange={(e) => setUseCustomFaculty(e.target.checked)}\r\n                style={{ \r\n                  cursor: 'pointer',\r\n                  width: '16px',\r\n                  height: '16px',\r\n                  accentColor: '#00a884'\r\n                }}\r\n              />\r\n              <label htmlFor=\"custom-faculty-toggle\" style={{ color: '#8696a0', fontSize: '12px', cursor: 'pointer', userSelect: 'none' }}>\r\n                Add\r\n              </label>\r\n            </div>\r\n\r\n            <div className=\"grid-2\" style={{ marginTop: 10 }}>\r\n              <div>\r\n                <label className=\"label\">Unit Name *</label>\r\n                {!useCustomUnitName ? (\r\n                  <select className=\"select\" value={paperForm.unit_name} onChange={onPaperChange('unit_name')} disabled={!paperForm.faculty && !useCustomFaculty || unitNames.length === 0}>\r\n                    <option value=\"\">\r\n                      {(!paperForm.faculty && !useCustomFaculty) ? 'Select a faculty first' : unitNames.length === 0 ? 'No units available' : 'Select Unit Name'}\r\n                    </option>\r\n                    {unitNames.map(u => <option key={u} value={u}>{u}</option>)}\r\n                  </select>\r\n                ) : (\r\n                  <input \r\n                    className=\"input\" \r\n                    placeholder=\"e.g., Introduction to Programming\" \r\n                    value={customUnitName} \r\n                    onChange={(e) => setCustomUnitName(e.target.value)}\r\n                    style={{\r\n                      backgroundColor: '#1f2c33',\r\n                      color: '#ffffff',\r\n                      border: '1px solid #333',\r\n                      borderRadius: '8px',\r\n                      padding: '10px 12px',\r\n                      width: '100%',\r\n                      outline: 'none',\r\n                      transition: 'border-color 0.2s ease'\r\n                    }}\r\n                    onFocus={(e) => e.target.style.borderColor = '#00a884'}\r\n                    onBlur={(e) => e.target.style.borderColor = '#333'}\r\n                  />\r\n                )}\r\n                <div style={{ display: 'flex', alignItems: 'center', gap: '6px', marginTop: '6px' }}>\r\n                  <input \r\n                    type=\"checkbox\" \r\n                    id=\"custom-unit-toggle\"\r\n                    checked={useCustomUnitName}\r\n                    onChange={(e) => setUseCustomUnitName(e.target.checked)}\r\n                    style={{ \r\n                      cursor: 'pointer',\r\n                      width: '16px',\r\n                      height: '16px',\r\n                      accentColor: '#00a884'\r\n                    }}\r\n                  />\r\n                  <label htmlFor=\"custom-unit-toggle\" style={{ color: '#8696a0', fontSize: '12px', cursor: 'pointer', userSelect: 'none' }}>\r\n                    Add\r\n                  </label>\r\n                </div>\r\n              </div>\r\n              <div>\r\n                <label className=\"label\">Unit Code *</label>\r\n                <input \r\n                  className=\"input\" \r\n                  placeholder=\"e.g., CS101\" \r\n                  value={paperForm.unit_code} \r\n                  onChange={onPaperChange('unit_code')}\r\n                  style={{\r\n                    backgroundColor: '#1f2c33',\r\n                    color: '#ffffff',\r\n                    border: '1px solid #333',\r\n                    borderRadius: '8px',\r\n                    padding: '10px 12px',\r\n                    width: '100%',\r\n                    outline: 'none',\r\n                    transition: 'border-color 0.2s ease'\r\n                  }}\r\n                  onFocus={(e) => e.target.style.borderColor = '#00a884'}\r\n                  onBlur={(e) => e.target.style.borderColor = '#333'}\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"grid-2\" style={{ marginTop: 10 }}>\r\n              <div>\r\n                <label className=\"label\">Year *</label>\r\n                {!useCustomYear ? (\r\n                  <select className=\"select\" value={paperForm.year} onChange={onPaperChange('year')} disabled={!paperForm.unit_name && !useCustomUnitName || years.length === 0}>\r\n                    <option value=\"\">\r\n                      {(!paperForm.unit_name && !useCustomUnitName) ? 'Select a unit first' : years.length === 0 ? 'No years available' : 'Select Year'}\r\n                    </option>\r\n                    {years.map(y => <option key={y} value={y}>{y}</option>)}\r\n                  </select>\r\n                ) : (\r\n                  <input \r\n                    className=\"input\" \r\n                    type=\"number\" \r\n                    placeholder=\"e.g., 2023\" \r\n                    value={customYear} \r\n                    onChange={(e) => setCustomYear(e.target.value)}\r\n                    style={{\r\n                      backgroundColor: '#1f2c33',\r\n                      color: '#ffffff',\r\n                      border: '1px solid #333',\r\n                      borderRadius: '8px',\r\n                      padding: '10px 12px',\r\n                      width: '100%',\r\n                      outline: 'none',\r\n                      transition: 'border-color 0.2s ease'\r\n                    }}\r\n                    onFocus={(e) => e.target.style.borderColor = '#00a884'}\r\n                    onBlur={(e) => e.target.style.borderColor = '#333'}\r\n                  />\r\n                )}\r\n                <div style={{ display: 'flex', alignItems: 'center', gap: '6px', marginTop: '6px' }}>\r\n                  <input \r\n                    type=\"checkbox\" \r\n                    id=\"custom-year-toggle\"\r\n                    checked={useCustomYear}\r\n                    onChange={(e) => setUseCustomYear(e.target.checked)}\r\n                    style={{ \r\n                      cursor: 'pointer',\r\n                      width: '16px',\r\n                      height: '16px',\r\n                      accentColor: '#00a884'\r\n                    }}\r\n                  />\r\n                  <label htmlFor=\"custom-year-toggle\" style={{ color: '#8696a0', fontSize: '12px', cursor: 'pointer', userSelect: 'none' }}>\r\n                    Add\r\n                  </label>\r\n                </div>\r\n              </div>\r\n              <div>\r\n                <label className=\"label\">Semester</label>\r\n                <select className=\"select\" value={paperForm.semester} onChange={onPaperChange('semester')}>\r\n                  <option value=\"\">Select Semester</option>\r\n                  <option value=\"1\">Semester 1</option>\r\n                  <option value=\"2\">Semester 2</option>\r\n                  <option value=\"3\">Semester 3</option>\r\n                </select>\r\n              </div>\r\n            </div>\r\n\r\n            <label className=\"label\" style={{ marginTop: 10 }}>Exam Type</label>\r\n            <select className=\"select\" value={paperForm.exam_type} onChange={onPaperChange('exam_type')}>\r\n              <option value=\"Main\">Main Exam</option>\r\n              <option value=\"Supplementary\">Supplementary</option>\r\n              <option value=\"CAT\">CAT</option>\r\n              <option value=\"Mock\">Mock Exam</option>\r\n            </select>\r\n\r\n            <div className=\"actions\" style={{ marginTop: 12 }}>\r\n              <button className=\"btn primary\" disabled={busy} onClick={submitPastPaper}>{busy ? 'Uploading...' : 'Upload Past Paper'}</button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Upload;"],"names":["USE_BACKEND_PROXY","async","searchUniversityNames","query","limit","arguments","length","undefined","data","error","supabase","rpc","p_query","p_limit","wikiResults","searchUrl","concat","encodeURIComponent","response","fetch","ok","json","titles","descriptions","urls","filter","title","toLowerCase","includes","map","index","name","description","website_url","console","searchWikipediaUniversities","Promise","all","uni","cacheUniversityPrefillData","API_URL","universities","proxyError","warn","message","fetchWikimediaImages","universityName","_listJson$query","_pages$","_infoJson$query","trim","replace","listUrl","listRes","listJson","images","pages","Object","values","fileTitles","img","Boolean","slice","join","infoUrl","infoRes","infoJson","p","_p$imageinfo","_p$imageinfo$","imageinfo","url","u","test","sort","a","b","deprioritize","s","e","fetchUnsplashImages","_data$images","downloadImageAsFile","imageUrl","fileName","Error","blob","File","type","source","from","upsert","university_name","updated_at","Date","toISOString","autoFillUniversityData","p_university_name","getUniversityPrefillData","wikiSummary","_json$thumbnail","res","extract","location","established","student_count","cover_images","thumbnail","fetchUniversityDataFromWikipedia","wikidata","_binding$website","_binding$locationLabe","_binding$established","_binding$studentCount","sparqlQuery","binding","results","bindings","itemLabel","value","website","locationLabel","getFullYear","studentCount","fetchUniversityDataFromWikidata","_ref","_wikidata$established","_wikidata$student_cou","university","image","fetchUniversityDataFromGoogle","commons","unsplash","userProfile","initialTab","useEffect","styleTag","document","createElement","innerHTML","head","appendChild","remove","activeTab","setActiveTab","useState","navigate","useNavigate","showToast","useAdminUI","pdf","setPdf","cover","setCover","categories","setCategories","bookForm","setBookForm","author","category_id","year","language","isbn","publisher","campusImages","setCampusImages","campusForm","setCampusForm","searchQuery","setSearchQuery","searchResults","setSearchResults","showSearchResults","setShowSearchResults","isAutoFilling","setIsAutoFilling","paperPdf","setPaperPdf","setUniversities","faculties","setFaculties","unitNames","setUnitNames","years","setYears","paperForm","setPaperForm","university_id","faculty","unit_code","unit_name","semester","exam_type","useCustomFaculty","setUseCustomFaculty","customFaculty","setCustomFaculty","useCustomUnitName","setUseCustomUnitName","customUnitName","setCustomUnitName","useCustomYear","setUseCustomYear","customYear","setCustomYear","lastUploadedPaper","setLastUploadedPaper","busy","setBusy","extractingCover","setExtractingCover","fetchCategories","getUniversitiesForDropdown","_unused","pdfjsLib","workerSrc","arrayBuffer","resolve","setTimeout","pdfDoc","promise","numPages","page","getPage","viewport","getViewport","scale","canvas","width","height","context","getContext","render","canvasContext","toBlob","coverFile","pageError","extractCoverFromPDF","onBookChange","k","f","_objectSpread","target","onCampusChange","debouncedSearch","callback","delay","timeoutRef","useRef","useCallback","_len","args","Array","_key","current","clearTimeout","useDebounce","handleAutoFill","_data$established","_data$student_count","toString","downloadedImages","i","Math","min","imageFile","push","err","file","onPaperChange","facultiesData","getFacultiesByUniversity","unitNamesData","getUnitNamesByUniversityAndFaculty","yearsData","getYearsByUniversityFacultyAndUnitName","renderDropzone","setFile","accept","fileType","icon","_jsxs","className","onDragOver","preventDefault","currentTarget","classList","add","onDragLeave","onDrop","droppedFile","dataTransfer","files","match","onClick","getElementById","click","style","border","borderRadius","padding","textAlign","cursor","background","transition","children","_jsx","id","onChange","_e$target$files","display","alignItems","justifyContent","gap","color","FiUpload","size","marginBottom","fontSize","marginTop","FiBook","FiMapPin","FiFileText","FiFile","marginLeft","FiImage","placeholder","rows","c","disabled","_pdf$name","metadata","Number","uploaded_by","role","createBook","pdfFile","createBookSubmission","multiple","FiX","gridTemplateColumns","idx","position","overflow","src","URL","createObjectURL","alt","objectFit","prev","_","top","left","fontWeight","boxShadow","right","paddingRight","transform","opacity","_Fragment","FiLoader","FiSearch","maxHeight","overflowY","zIndex","result","borderBottom","onMouseEnter","onMouseLeave","primaryImage","createUniversitySubmission","backgroundColor","outline","onFocus","borderColor","onBlur","checked","accentColor","htmlFor","userSelect","y","unitName","checkDuplicatePastPaper","universityId","unitCode","exists","log","JSON","stringify","isAdmin","createPastPaper","createPastPaperSubmission","catch"],"ignoreList":[],"sourceRoot":""}