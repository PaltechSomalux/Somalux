"use strict";(self.webpackChunkcampuslife=self.webpackChunkcampuslife||[]).push([[131],{2131:(e,o,i)=>{i.r(o),i.d(o,{default:()=>p});var s=i(9379),n=i(5043),t=i(5200),d=i(9101),l=i(579);const a=e=>{let{items:o,loading:i,type:s,busy:n,onSelect:d,onApprove:a,onReject:r}=e;return i?(0,l.jsx)("div",{style:{padding:12,color:"#8696a0",fontSize:12},children:"Loading\u2026"}):0===o.length?(0,l.jsx)("div",{style:{padding:12,color:"#8696a0",fontSize:12},children:"No submissions."}):(0,l.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:6},children:o.map(e=>{return(0,l.jsx)("div",{style:{background:"#0b141a",border:"1px solid #1f2c33",borderRadius:4,padding:8,cursor:"pointer"},onClick:()=>d(e),children:(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:6},children:[(0,l.jsxs)("div",{style:{minWidth:0},children:[(0,l.jsx)("div",{style:{color:"#e9edef",fontWeight:600,fontSize:12},children:e.title||"Untitled"}),"books"===s?(0,l.jsxs)("div",{style:{color:"#8696a0",fontSize:11},children:[e.author||"Unknown"," ",e.isbn?"\u2022 ISBN: ".concat(e.isbn):""]}):(0,l.jsxs)("div",{style:{color:"#8696a0",fontSize:11},children:[e.faculty||"Unknown faculty"," ",e.unit_code?"\u2022 ".concat(e.unit_code):""," ",e.unit_name?"\u2022 ".concat(e.unit_name):""]}),(0,l.jsxs)("div",{style:{color:"#8696a0",fontSize:10,marginTop:3},children:[(o=e.created_at,o?new Date(o).toLocaleString():"\u2014")," \u2022 ",e.status,e.uploader_email?(0,l.jsxs)(l.Fragment,{children:[" \u2022 Uploaded by ",e.uploader_name||e.uploader_email]}):e.uploaded_by?(0,l.jsxs)(l.Fragment,{children:[" \u2022 Uploaded by ",String(e.uploaded_by)]}):null]})]}),(0,l.jsx)("div",{style:{display:"flex",gap:4},children:"pending"===e.status?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("button",{className:"btn",disabled:!!n[e.id],onClick:o=>{o.stopPropagation(),a(e.id)},style:{display:"flex",alignItems:"center",gap:4,background:"#00a884",color:"#fff",fontSize:11,padding:"4px 8px"},children:[(0,l.jsx)(t.YrT,{})," Approve"]}),(0,l.jsxs)("button",{className:"btn",disabled:!!n[e.id],onClick:o=>{o.stopPropagation(),r(e.id)},style:{display:"flex",alignItems:"center",gap:4,background:"#ea4335",color:"#fff",fontSize:11,padding:"4px 8px"},children:[(0,l.jsx)(t.yGN,{})," Reject"]})]}):(0,l.jsxs)("div",{style:{color:"#8696a0",display:"flex",alignItems:"center",gap:4,fontSize:11},children:[(0,l.jsx)(t.Ohp,{})," Reviewed"]})})]})},e.id);var o})})},r=e=>{let{submission:o,type:i,busy:s,onClose:n,onApprove:d,onReject:a}=e;const r=e=>e?new Date(e).toLocaleString():"\u2014";return(0,l.jsx)("div",{className:"profile-signout-overlay",onClick:n,style:{zIndex:60},children:(0,l.jsxs)("div",{className:"profile-signout-modal",onClick:e=>e.stopPropagation(),style:{maxWidth:760,width:"96%",maxHeight:"90vh",display:"flex",flexDirection:"column",background:"#111b21"},children:[(0,l.jsxs)("div",{className:"profile-signout-header",style:{borderBottom:"1px solid #1f2c33",padding:"8px 12px"},children:[(0,l.jsxs)("h2",{style:{display:"flex",alignItems:"center",gap:4,fontSize:"13px",margin:0},children:[(0,l.jsx)(t.zd,{})," Review ","books"===i?"Book":"Past Paper"," Submission"]}),(0,l.jsx)("button",{className:"profile-signout-close",onClick:n,children:"\xd7"})]}),(0,l.jsxs)("div",{className:"profile-signout-body",style:{padding:8,display:"flex",flexDirection:"column",gap:8,overflowY:"auto"},children:[(0,l.jsxs)("div",{style:{padding:6,background:"rgba(0, 168, 132, 0.1)",border:"1px solid rgba(0, 168, 132, 0.3)",borderRadius:4},children:[(0,l.jsx)("div",{style:{color:"#00a884",fontSize:10,fontWeight:600,marginBottom:2},children:"UPLOADER"}),(0,l.jsx)("div",{style:{color:"#e9edef",fontSize:12,fontWeight:500},children:o.uploader_name||o.uploader_email||(o.uploaded_by?String(o.uploaded_by):"Unknown")}),o.uploader_email&&o.uploader_email!==o.uploader_name&&(0,l.jsx)("div",{style:{color:"#8696a0",fontSize:10},children:o.uploader_email}),!o.uploader_email&&o.uploaded_by&&String(o.uploaded_by).includes("@")&&(0,l.jsx)("div",{style:{color:"#8696a0",fontSize:10},children:String(o.uploaded_by)})]}),"books"===i?(0,l.jsxs)(l.Fragment,{children:[o.cover_url&&(0,l.jsx)("div",{style:{flex:"0 0 120px",alignSelf:"center"},children:(0,l.jsx)("img",{src:o.cover_url,alt:o.title||"Cover",style:{width:"100%",borderRadius:4,objectFit:"cover",boxShadow:"0 2px 6px rgba(0,0,0,0.3)"}})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{style:{color:"#e9edef",marginBottom:2,fontSize:13,fontWeight:600},children:o.title||"Untitled"}),(0,l.jsxs)("div",{style:{color:"#8696a0",marginBottom:8,fontSize:11},children:[(0,l.jsx)("strong",{children:o.author||"Unknown author"}),o.isbn&&(0,l.jsxs)(l.Fragment,{children:[" \u2022 ISBN: ",o.isbn]})]}),o.description&&(0,l.jsxs)("div",{style:{color:"#cbd5f5",fontSize:11,marginBottom:8,lineHeight:1.4,padding:"6px 0",borderTop:"1px solid #1f2c33",borderBottom:"1px solid #1f2c33"},children:[(0,l.jsx)("strong",{style:{color:"#e9edef"},children:"Description:"}),(0,l.jsx)("br",{}),o.description]}),(0,l.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(120px, 1fr))",gap:6,marginBottom:8},children:[o.author&&(0,l.jsxs)("div",{style:{padding:6,background:"#0b141a",borderRadius:4,border:"1px solid #1f2c33"},children:[(0,l.jsx)("div",{style:{color:"#8696a0",fontSize:10},children:"AUTHOR"}),(0,l.jsx)("div",{style:{color:"#e9edef",fontSize:11,fontWeight:500},children:o.author})]}),o.year&&(0,l.jsxs)("div",{style:{padding:6,background:"#0b141a",borderRadius:4,border:"1px solid #1f2c33"},children:[(0,l.jsx)("div",{style:{color:"#8696a0",fontSize:10},children:"YEAR"}),(0,l.jsx)("div",{style:{color:"#e9edef",fontSize:11,fontWeight:500},children:o.year})]}),o.publisher&&(0,l.jsxs)("div",{style:{padding:6,background:"#0b141a",borderRadius:4,border:"1px solid #1f2c33"},children:[(0,l.jsx)("div",{style:{color:"#8696a0",fontSize:10},children:"PUBLISHER"}),(0,l.jsx)("div",{style:{color:"#e9edef",fontSize:11,fontWeight:500},children:o.publisher})]}),o.pages&&(0,l.jsxs)("div",{style:{padding:6,background:"#0b141a",borderRadius:4,border:"1px solid #1f2c33"},children:[(0,l.jsx)("div",{style:{color:"#8696a0",fontSize:10},children:"PAGES"}),(0,l.jsx)("div",{style:{color:"#e9edef",fontSize:11,fontWeight:500},children:o.pages})]}),o.language&&(0,l.jsxs)("div",{style:{padding:6,background:"#0b141a",borderRadius:4,border:"1px solid #1f2c33"},children:[(0,l.jsx)("div",{style:{color:"#8696a0",fontSize:10},children:"LANGUAGE"}),(0,l.jsx)("div",{style:{color:"#e9edef",fontSize:11,fontWeight:500},children:o.language})]}),o.isbn&&(0,l.jsxs)("div",{style:{padding:6,background:"#0b141a",borderRadius:4,border:"1px solid #1f2c33"},children:[(0,l.jsx)("div",{style:{color:"#8696a0",fontSize:10},children:"ISBN"}),(0,l.jsx)("div",{style:{color:"#e9edef",fontSize:11,fontWeight:500,wordBreak:"break-all"},children:o.isbn})]})]}),(0,l.jsxs)("div",{style:{marginTop:12,padding:10,background:"#0b141a",borderRadius:6,border:"1px solid #1f2c33"},children:[(0,l.jsx)("div",{style:{color:"#8696a0",fontSize:11,marginBottom:4},children:"SUBMISSION INFO"}),(0,l.jsxs)("div",{style:{color:"#e9edef",fontSize:12},children:[(0,l.jsxs)("div",{children:["Uploaded: ",r(o.created_at)]}),(0,l.jsxs)("div",{children:["Status: ",(0,l.jsx)("span",{style:{color:"pending"===o.status?"#fbbf24":"approved"===o.status?"#00a884":"#ea4335",fontWeight:600},children:o.status.toUpperCase()})]}),o.rejection_reason&&(0,l.jsxs)("div",{style:{color:"#ea4335",marginTop:4},children:["Rejection Reason: ",o.rejection_reason]})]})]})]})]}):(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)("div",{children:[(0,l.jsxs)("h3",{style:{color:"#e9edef",marginBottom:4,fontSize:16,fontWeight:600},children:[o.unit_code?"".concat(o.unit_code," \u2014 "):"",o.unit_name||"Untitled"]}),(0,l.jsxs)("div",{style:{color:"#8696a0",marginBottom:12,fontSize:13},children:[(0,l.jsx)("strong",{children:o.faculty||"Unknown faculty"}),o.year&&(0,l.jsxs)(l.Fragment,{children:[" \u2022 ",o.year]}),o.semester&&(0,l.jsxs)(l.Fragment,{children:[" \u2022 Sem ",o.semester]}),o.exam_type&&(0,l.jsxs)(l.Fragment,{children:[" \u2022 ",o.exam_type]})]}),(0,l.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(120px, 1fr))",gap:6,marginBottom:8},children:[o.unit_code&&(0,l.jsxs)("div",{style:{padding:6,background:"#0b141a",borderRadius:4,border:"1px solid #1f2c33"},children:[(0,l.jsx)("div",{style:{color:"#8696a0",fontSize:10},children:"UNIT CODE"}),(0,l.jsx)("div",{style:{color:"#e9edef",fontSize:11,fontWeight:500},children:o.unit_code})]}),o.faculty&&(0,l.jsxs)("div",{style:{padding:6,background:"#0b141a",borderRadius:4,border:"1px solid #1f2c33"},children:[(0,l.jsx)("div",{style:{color:"#8696a0",fontSize:10},children:"FACULTY"}),(0,l.jsx)("div",{style:{color:"#e9edef",fontSize:11,fontWeight:500},children:o.faculty})]}),o.year&&(0,l.jsxs)("div",{style:{padding:6,background:"#0b141a",borderRadius:4,border:"1px solid #1f2c33"},children:[(0,l.jsx)("div",{style:{color:"#8696a0",fontSize:10},children:"YEAR"}),(0,l.jsx)("div",{style:{color:"#e9edef",fontSize:11,fontWeight:500},children:o.year})]}),o.semester&&(0,l.jsxs)("div",{style:{padding:6,background:"#0b141a",borderRadius:4,border:"1px solid #1f2c33"},children:[(0,l.jsx)("div",{style:{color:"#8696a0",fontSize:10},children:"SEMESTER"}),(0,l.jsxs)("div",{style:{color:"#e9edef",fontSize:11,fontWeight:500},children:["Sem ",o.semester]})]}),o.exam_type&&(0,l.jsxs)("div",{style:{padding:6,background:"#0b141a",borderRadius:4,border:"1px solid #1f2c33"},children:[(0,l.jsx)("div",{style:{color:"#8696a0",fontSize:10},children:"EXAM TYPE"}),(0,l.jsx)("div",{style:{color:"#e9edef",fontSize:11,fontWeight:500},children:o.exam_type})]})]}),(0,l.jsxs)("div",{style:{marginTop:6,padding:6,background:"#0b141a",borderRadius:4,border:"1px solid #1f2c33"},children:[(0,l.jsx)("div",{style:{color:"#8696a0",fontSize:10,marginBottom:2},children:"SUBMISSION INFO"}),(0,l.jsxs)("div",{style:{color:"#e9edef",fontSize:11},children:[(0,l.jsxs)("div",{children:["Uploaded: ",r(o.created_at)]}),(0,l.jsxs)("div",{children:["Status: ",(0,l.jsx)("span",{style:{color:"pending"===o.status?"#fbbf24":"approved"===o.status?"#00a884":"#ea4335",fontWeight:600},children:o.status.toUpperCase()})]}),o.rejection_reason&&(0,l.jsxs)("div",{style:{color:"#ea4335",marginTop:2},children:["Rejection Reason: ",o.rejection_reason]})]})]})]})})]}),(0,l.jsx)("div",{className:"profile-signout-footer",style:{borderTop:"1px solid #1f2c33",padding:6,display:"flex",justifyContent:"flex-end",gap:4},children:"pending"===o.status?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("button",{className:"btn",disabled:!!s[o.id],onClick:()=>d(o.id),style:{display:"flex",alignItems:"center",gap:4,background:"#00a884",color:"#fff",fontSize:11,padding:"4px 8px"},children:[(0,l.jsx)(t.YrT,{})," Approve"]}),(0,l.jsxs)("button",{className:"btn",disabled:!!s[o.id],onClick:()=>a(o.id),style:{display:"flex",alignItems:"center",gap:4,background:"#ea4335",color:"#fff",fontSize:11,padding:"4px 8px"},children:[(0,l.jsx)(t.yGN,{})," Reject"]})]}):(0,l.jsxs)("div",{style:{color:"#8696a0",display:"flex",alignItems:"center",gap:4,fontSize:11},children:[(0,l.jsx)(t.Ohp,{})," Already reviewed"]})})]})})},c="http://localhost:5000",p=e=>{let{userProfile:o}=e;const[i,p]=(0,n.useState)([]),[f,u]=(0,n.useState)(!1),[g,x]=(0,n.useState)(null),[b,h]=(0,n.useState)("pending"),[y,m]=(0,n.useState)({}),[v,j]=(0,n.useState)("books"),[S,k]=(0,n.useState)({booksPending:0,pastPapersPending:0}),[z,R]=(0,n.useState)(null),{confirm:_,prompt:w,showToast:P}=(0,d.v)(),I=(0,n.useMemo)(()=>({"Content-Type":"application/json","x-actor-email":(null===o||void 0===o?void 0:o.email)||"admin","x-actor-id":(null===o||void 0===o?void 0:o.id)||(null===o||void 0===o?void 0:o.user_id)||""}),[null===o||void 0===o?void 0:o.email,null===o||void 0===o?void 0:o.id,null===o||void 0===o?void 0:o.user_id]),A=async()=>{u(!0),x(null);try{const e="".concat(c,"/api/elib/submissions?status=").concat(encodeURIComponent(b),"&type=").concat(encodeURIComponent(v)),o=await fetch(e),i=await o.json();if(!o.ok)throw new Error((null===i||void 0===i?void 0:i.error)||"Failed to load submissions");p(Array.isArray(i.submissions)?i.submissions:[])}catch(e){x(e.message||"Failed to load submissions")}finally{u(!1)}},C=async()=>{try{const e=await fetch("".concat(c,"/api/elib/submissions/summary")),o=await e.json();if(!e.ok)throw new Error((null===o||void 0===o?void 0:o.error)||"Failed to load summary");k({booksPending:o.booksPending||0,pastPapersPending:o.pastPapersPending||0})}catch(e){}};(0,n.useEffect)(()=>{A()},[b,v]),(0,n.useEffect)(()=>{C()},[]);const N=async e=>{console.log("Approve called with id:",e,"type of id:",typeof e);const o=i.find(o=>o.id===e)||z;console.log("Found item:",o);const n="books"===v?(null===o||void 0===o?void 0:o.title)||"this book":(null===o||void 0===o?void 0:o.unit_code)||(null===o||void 0===o?void 0:o.unit_name)||"this past paper",t=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;if(!t.test(e))return console.error("Invalid submission ID format:",e),null!==z&&void 0!==z&&z.id&&t.test(z.id)?(console.log("Recursing with selected.id:",z.id),N(z.id)):void P({type:"error",message:"Invalid submission ID format. Please refresh and try again."});if(await _({title:"Approve ".concat("books"===v?"Book":"Past Paper","?"),message:"Are you sure you want to approve ".concat(n,"? It will become visible to users and count towards the uploader's contributions."),confirmLabel:"Approve",cancelLabel:"Cancel",variant:"default"})){m(o=>(0,s.A)((0,s.A)({},o),{},{[e]:!0}));try{const o=await fetch("".concat(c,"/api/elib/submissions/").concat(e,"/approve?type=").concat(encodeURIComponent(v)),{method:"POST",headers:I}),i=await o.json();if(!o.ok)throw new Error((null===i||void 0===i?void 0:i.error)||"Approve failed");p(o=>o.filter(o=>o.id!==e)),C(),R(null),P({type:"success",message:"".concat("books"===v?"Book":"Past paper"," approved successfully.")})}catch(d){console.error("Approve submission failed:",d),P({type:"error",message:d.message||"Approve failed."})}finally{m(o=>(0,s.A)((0,s.A)({},o),{},{[e]:!1}))}}},B=async e=>{console.log("Reject called with id:",e,"type of id:",typeof e);const o=i.find(o=>o.id===e)||z;console.log("Found item:",o);const n="books"===v?(null===o||void 0===o?void 0:o.title)||"this book":(null===o||void 0===o?void 0:o.unit_code)||(null===o||void 0===o?void 0:o.unit_name)||"this past paper",t=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;if(!t.test(e))return console.error("Invalid submission ID format:",e),null!==z&&void 0!==z&&z.id&&t.test(z.id)?(console.log("Recursing with selected.id:",z.id),B(z.id)):void P({type:"error",message:"Invalid submission ID format. Please refresh and try again."});const d=await w({title:"Reject ".concat("books"===v?"Book":"Past Paper","?"),message:"Optionally provide a reason for rejecting ".concat(n,". This may be shared with the uploader."),label:"Rejection reason",defaultValue:"",multiline:!0,confirmLabel:"Reject",cancelLabel:"Cancel",variant:"danger"});if(null!==d){m(o=>(0,s.A)((0,s.A)({},o),{},{[e]:!0}));try{const o=await fetch("".concat(c,"/api/elib/submissions/").concat(e,"/reject?type=").concat(encodeURIComponent(v)),{method:"POST",headers:I,body:JSON.stringify({reason:d||""})}),i=await o.json();if(!o.ok)throw new Error((null===i||void 0===i?void 0:i.error)||"Reject failed");p(o=>o.filter(o=>o.id!==e)),C(),R(null),P({type:"success",message:"".concat("books"===v?"Book":"Past paper"," rejected.")})}catch(l){console.error("Reject submission failed:",l),P({type:"error",message:l.message||"Reject failed."})}finally{m(o=>(0,s.A)((0,s.A)({},o),{},{[e]:!1}))}}};return(0,l.jsxs)("div",{className:"panel",children:[(0,l.jsx)("div",{className:"panel-title",children:"Submissions"}),(0,l.jsx)("div",{style:{color:"#8696a0",fontSize:12,marginBottom:8},children:"Review and approve or reject user-contributed books and past papers."}),(0,l.jsxs)("div",{className:"panel",style:{marginBottom:8,display:"flex",alignItems:"center",gap:6,flexWrap:"wrap"},children:[(0,l.jsxs)("div",{style:{display:"flex",gap:4},children:[(0,l.jsxs)("button",{className:"btn",style:{display:"flex",alignItems:"center",gap:4,background:"books"===v?"#00a884":"transparent",color:"books"===v?"#fff":"#e9edef",borderColor:"books"===v?"#00a884":"#374151"},onClick:()=>j("books"),children:[(0,l.jsx)(t.H9b,{})," Books",S.booksPending>0&&(0,l.jsx)("span",{className:"notification-badge",style:{marginLeft:4},children:S.booksPending>99?"99+":S.booksPending})]}),(0,l.jsxs)("button",{className:"btn",style:{display:"flex",alignItems:"center",gap:4,background:"past_papers"===v?"#00a884":"transparent",color:"past_papers"===v?"#fff":"#e9edef",borderColor:"past_papers"===v?"#00a884":"#374151"},onClick:()=>j("past_papers"),children:[(0,l.jsx)(t.jH2,{})," Past Papers",S.pastPapersPending>0&&(0,l.jsx)("span",{className:"notification-badge",style:{marginLeft:4},children:S.pastPapersPending>99?"99+":S.pastPapersPending})]})]}),(0,l.jsxs)("select",{className:"input",value:b,onChange:e=>h(e.target.value),style:{maxWidth:200},children:[(0,l.jsx)("option",{value:"pending",children:"Pending"}),(0,l.jsx)("option",{value:"approved",children:"Approved"}),(0,l.jsx)("option",{value:"rejected",children:"Rejected"}),(0,l.jsx)("option",{value:"all",children:"All"})]}),(0,l.jsxs)("button",{className:"btn",onClick:A,style:{display:"flex",alignItems:"center",gap:4},children:[(0,l.jsx)(t.jTZ,{})," Refresh"]})]}),g&&(0,l.jsx)("div",{style:{marginBottom:8,padding:6,borderRadius:4,border:"1px solid rgba(234,67,53,.35)",color:"#ffab91",background:"rgba(234,67,53,.08)",fontSize:12},children:g}),(0,l.jsx)(a,{items:i,loading:f,type:v,busy:y,onSelect:R,onApprove:N,onReject:B}),z&&(0,l.jsx)(r,{submission:z,type:v,busy:y,onClose:()=>R(null),onApprove:N,onReject:B})]})}}}]);
//# sourceMappingURL=131.28062942.chunk.js.map