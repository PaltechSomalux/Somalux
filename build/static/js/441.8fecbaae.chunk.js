"use strict";(self.webpackChunkcampuslife=self.webpackChunkcampuslife||[]).push([[441],{5822:(e,t,s)=>{s.r(t),s.d(t,{default:()=>p});var o=s(9379),n=s(5043),a=s(4218),r=s(3515),i=s(5200),l=s(579);const d=e=>{let{rows:t}=e;const[s,o]=(0,n.useState)("month"),{kpiActive:a,kpiSignedOut:r,totalActiveNow:i,totalUsers:d,totalSignedOut:c,chartData:u,rangeLabel:p}=(0,n.useMemo)(()=>{const e=new Date;let o;o="week"===s?new Date(e.getTime()-6048e5):"year"===s?new Date(e.getFullYear()-1,e.getMonth(),e.getDate()):new Date(e.getTime()-2592e6);const n=t.length;let a=0,r=0,i=0,l=0;t.forEach(t=>{const s=t.created_at?new Date(t.created_at):null,n=t.last_active_at?new Date(t.last_active_at):s,d=t.deactivated_at?new Date(t.deactivated_at):null,c=!!(n&&e.getTime()-n.getTime()<=3e5),u=!!d&&d<=e;if(c&&(a+=1),u&&(r+=1),!u){const t=n||s;t&&t>=o&&t<=e&&(i+=1)}else u&&d&&d>=o&&d<=e&&(l+=1)});return{kpiActive:i,kpiSignedOut:l,totalActiveNow:a,totalUsers:n,totalSignedOut:r,chartData:[],rangeLabel:"week"===s?"Last 7 days":"year"===s?"Last 12 months":"Last 30 days"}},[t,s]);return(0,l.jsxs)("div",{style:{marginBottom:8},children:[(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:8,flexWrap:"wrap"},children:[(0,l.jsx)("div",{style:{display:"flex",gap:4,flexWrap:"wrap"},children:["week","month","year"].map(e=>(0,l.jsx)("button",{className:"btn",style:{padding:"4px 12px",borderRadius:999,background:s===e?"#005c4b":"#202c33",color:"#e9edef",border:"none",fontSize:12,textTransform:"capitalize"},onClick:()=>o(e),children:e},e))}),(0,l.jsx)("div",{style:{color:"#8696a0",fontSize:12},children:p})]}),(0,l.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(140px, 1fr))",gap:6,marginTop:8},children:[(0,l.jsxs)("div",{style:{background:"#111b21",borderRadius:6,padding:8,border:"1px solid #202c33"},children:[(0,l.jsxs)("div",{style:{fontSize:11,color:"#8696a0",marginBottom:2},children:["Active users (",p,")"]}),(0,l.jsx)("div",{style:{fontSize:22,fontWeight:600,color:"#e9edef"},children:a})]}),(0,l.jsxs)("div",{style:{background:"#111b21",borderRadius:6,padding:8,border:"1px solid #202c33"},children:[(0,l.jsxs)("div",{style:{fontSize:11,color:"#8696a0",marginBottom:2},children:["Signed-out users (",p,")"]}),(0,l.jsx)("div",{style:{fontSize:22,fontWeight:600,color:"#e9edef"},children:r})]}),(0,l.jsxs)("div",{style:{background:"#111b21",borderRadius:12,padding:12,border:"1px solid #202c33"},children:[(0,l.jsx)("div",{style:{fontSize:12,color:"#8696a0",marginBottom:4},children:"Total active now"}),(0,l.jsx)("div",{style:{fontSize:22,fontWeight:600,color:"#e9edef"},children:i}),(0,l.jsxs)("div",{style:{fontSize:11,color:"#8696a0",marginTop:2},children:["of ",d," users"]})]}),(0,l.jsxs)("div",{style:{background:"#111b21",borderRadius:12,padding:12,border:"1px solid #202c33"},children:[(0,l.jsx)("div",{style:{fontSize:12,color:"#8696a0",marginBottom:4},children:"Total signed-out"}),(0,l.jsx)("div",{style:{fontSize:22,fontWeight:600,color:"#e9edef"},children:c})]})]})]})};var c=s(7488);const u=e=>{let{user:t,onClose:s}=e;const[a,i]=(0,n.useState)(null),[d,u]=(0,n.useState)(!1),[p,g]=(0,n.useState)(null);(0,n.useEffect)(()=>{h()},[t.id]);const h=async()=>{i(null),g(null),u(!0);try{const e=t.id,s=new Date,n=new Date(s.getTime()-2592e6).toISOString(),[a,l,d,u,p,g,h,m,x,v,f,y,b]=await Promise.all([c.N.from("book_views").select("id",{count:"exact",head:!0}).eq("user_id",e).gte("viewed_at",n),c.N.from("book_downloads").select("id",{count:"exact",head:!0}).eq("user_id",e).gte("downloaded_at",n),c.N.from("book_likes").select("id",{count:"exact",head:!0}).eq("user_id",e).gte("created_at",n),c.N.from("book_comments").select("id",{count:"exact",head:!0}).eq("user_id",e).gte("created_at",n),c.N.from("books").select("id",{count:"exact",head:!0}).eq("uploaded_by",e).gte("created_at",n),c.N.from("past_papers").select("id",{count:"exact",head:!0}).eq("uploaded_by",e).gte("created_at",n),c.N.from("universities").select("id",{count:"exact",head:!0}).eq("uploaded_by",e).gte("created_at",n),c.N.from("reading_sessions").select("id",{count:"exact",head:!0}).eq("user_id",e).gte("started_at",n),c.N.from("reading_goals").select("id, target_books, current_progress",{count:"exact",head:!1}).eq("user_id",e),c.N.from("user_reading_stats").select("total_books_completed").eq("user_id",e).maybeSingle(),c.N.from("reading_streaks").select("current_streak").eq("user_id",e).maybeSingle(),c.N.from("subscriptions").select("id, status").eq("user_id",e),(0,r.Ds)(e,{days:30})]),_=e=>e&&"number"===typeof e.count?e.count:0,k=_(a),j=_(l),w=_(d),S=_(u),A=_(p),C=_(g),U=_(h),N=_(m);let P=0;x&&!x.error&&Array.isArray(x.data)&&(P=x.data.filter(e=>!!e&&("number"===typeof e.target_books&&e.target_books>0&&(e.current_progress||0)>=e.target_books)).length);const z=v&&!v.error&&v.data&&v.data.total_books_completed||0,R=f&&!f.error&&f.data&&f.data.current_streak||0,L=(y&&!y.error&&Array.isArray(y.data)?y.data:[]).filter(e=>"active"===e.status).length,D=[{key:"views",label:"Reads / views",count:k,pointsPerUnit:1},{key:"downloads",label:"Downloads",count:j,pointsPerUnit:3},{key:"likes",label:"Likes",count:w,pointsPerUnit:2},{key:"comments",label:"Comments",count:S,pointsPerUnit:3},{key:"uploads_books",label:"Books uploaded (approved)",count:A,pointsPerUnit:5},{key:"uploads_past_papers",label:"Past papers uploaded (approved)",count:C,pointsPerUnit:5},{key:"uploads_universities",label:"Universities created",count:U,pointsPerUnit:8},{key:"searches",label:"Searches",count:Array.isArray(b)?b.length:0,pointsPerUnit:.5},{key:"sessions",label:"Reading sessions",count:N,pointsPerUnit:1},{key:"completed_goals",label:"Completed goals",count:P,pointsPerUnit:8},{key:"books_completed",label:"Books completed (lifetime)",count:z,pointsPerUnit:2},{key:"streak_days",label:"Reading streak (days)",count:R,pointsPerUnit:1},{key:"subscriptions",label:"Active subscriptions",count:L,pointsPerUnit:20}].map(e=>(0,o.A)((0,o.A)({},e),{},{totalPoints:e.count*e.pointsPerUnit})),T=D.reduce((e,t)=>e+t.totalPoints,0);let W=null;T>=400?W="legend":T>=250?W="power_reader":T>=150?W="active_reader":T>=60?W="community_star":T>0&&(W="new_reader"),i({metrics:D,totalPoints:T,tierFromPoints:W})}catch(e){console.error("Failed to load tier metrics",e),g("Failed to load tier details")}finally{u(!1)}},m=e=>e?e.replace("new_reader","New Reader").replace("active_reader","Active Reader").replace("power_reader","Power Reader").replace("community_star","Community Star").replace("legend","Legend"):"Not ranked";return(0,l.jsx)("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.65)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999,padding:16},onClick:s,children:(0,l.jsxs)("div",{style:{background:"#111b21",borderRadius:16,maxWidth:520,width:"100%",maxHeight:"90vh",overflowY:"auto",border:"1px solid #202c33",boxShadow:"0 18px 45px rgba(0,0,0,0.6)"},onClick:e=>e.stopPropagation(),children:[(0,l.jsxs)("div",{style:{padding:"14px 18px",borderBottom:"1px solid #202c33",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{style:{fontSize:14,color:"#8696a0"},children:"Tier breakdown"}),(0,l.jsx)("div",{style:{fontSize:18,fontWeight:600,color:"#e9edef"},children:m(t.rankTier)})]}),(0,l.jsx)("button",{className:"btn",style:{padding:"4px 10px",fontSize:12},onClick:s,children:"Close"})]}),(0,l.jsx)("div",{style:{padding:16,display:"grid",gap:12},children:(0,l.jsxs)("div",{style:{background:"#0b141a",borderRadius:12,padding:12,border:"1px solid #202c33",fontSize:13,color:"#cfd8dc"},children:[(0,l.jsx)("div",{style:{fontWeight:600,marginBottom:8},children:"Activity points (last 30 days)"}),d&&(0,l.jsx)("div",{style:{color:"#8696a0"},children:"Loading tier details..."}),p&&!d&&(0,l.jsx)("div",{style:{color:"#f15e6c"},children:p}),a&&!d&&!p&&(0,l.jsxs)("div",{style:{overflowX:"auto"},children:[(0,l.jsxs)("table",{className:"table",style:{fontSize:12},children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{children:"Metric"}),(0,l.jsx)("th",{style:{textAlign:"right"},children:"Count"}),(0,l.jsx)("th",{style:{textAlign:"right"},children:"Points / unit"}),(0,l.jsx)("th",{style:{textAlign:"right"},children:"Total points"})]})}),(0,l.jsxs)("tbody",{children:[a.metrics.map(e=>(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{children:e.label}),(0,l.jsx)("td",{style:{textAlign:"right"},children:e.count}),(0,l.jsx)("td",{style:{textAlign:"right"},children:e.pointsPerUnit}),(0,l.jsx)("td",{style:{textAlign:"right"},children:e.totalPoints.toFixed(1)})]},e.key)),(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{colSpan:3,style:{textAlign:"right",fontWeight:600},children:"Total"}),(0,l.jsx)("td",{style:{textAlign:"right",fontWeight:600},children:a.totalPoints.toFixed(1)})]})]})]}),(0,l.jsx)("div",{style:{marginTop:8,fontSize:12},children:(0,l.jsxs)("div",{children:["Computed tier from points:"," ",(0,l.jsx)("strong",{children:m(a.tierFromPoints)})]})})]})]})})]})})},p=e=>{let{isSuperAdmin:t}=e;const[s,c]=(0,n.useState)([]),[p,g]=(0,n.useState)(!0),[h,m]=(0,n.useState)({}),[x,v]=(0,n.useState)(""),[f,y]=(0,n.useState)(""),[b,_]=(0,n.useState)(""),[k,j]=(0,n.useState)("latest_login"),[w,S]=(0,n.useState)("desc"),[A,C]=(0,n.useState)(1),[U]=(0,n.useState)(15),[N,P]=(0,n.useState)(!1),[z,R]=(0,n.useState)(null),L=(0,a.Zp)(),D=["campuslives254@gmail.com","paltechsomalux@gmail.com"],T=async()=>{g(!0);try{var e,t,s,n,a,i;let g=[],h=[],m=[];try{var l;g=await(0,r.Hz)(),console.log("[Users.load] fetchProfiles success:",(null===(l=g)||void 0===l?void 0:l.length)||0)}catch(p){console.error("[Users.load] fetchProfiles error:",(null===p||void 0===p?void 0:p.message)||p)}try{var d;h=await(0,r.Kl)(),console.log("[Users.load] fetchUserRankingsAdmin success:",(null===(d=h)||void 0===d?void 0:d.length)||0)}catch(p){console.error("[Users.load] fetchUserRankingsAdmin error:",(null===p||void 0===p?void 0:p.message)||p)}try{var u;m=await(0,r.Yj)(),console.log("[Users.load] fetchUploadCountsByUser success:",(null===(u=m)||void 0===u?void 0:u.length)||0)}catch(p){console.error("[Users.load] fetchUploadCountsByUser error:",(null===p||void 0===p?void 0:p.message)||p)}console.groupCollapsed("[Users.load] fetched data"),console.log("profiles (count):",Array.isArray(g)?g.length:g,null===(e=g)||void 0===e||null===(t=e.slice)||void 0===t?void 0:t.call(e,0,3)),console.log("rankings (count):",Array.isArray(h)?h.length:h,null===(s=h)||void 0===s||null===(n=s.slice)||void 0===n?void 0:n.call(s,0,5)),console.log("uploadCounts (count):",Array.isArray(m)?m.length:m,null===(a=m)||void 0===a||null===(i=a.slice)||void 0===i?void 0:i.call(a,0,10)),console.groupEnd();const x=new Map((m||[]).map(e=>[String(e.uploaded_by),{books:e.books||0,pastPapers:e.past_papers||0,universities:e.universities||0,total:"number"===typeof e.total?e.total:(e.books||0)+(e.past_papers||0)+(e.universities||0)}])),v=new Map;(h||[]).forEach(e=>{var t,s,o;[e.user_id,null===(t=e.user)||void 0===t?void 0:t.id,e.profile_id,null===(s=e.profiles)||void 0===s?void 0:s.id,null===(o=e.profiles)||void 0===o?void 0:o.profile_id,e.email,e.user_email].forEach(t=>{void 0!==t&&null!==t&&v.set(String(t),e)})});const f=e=>{const t=(x.get(String(e.id))||{total:0}).total||0,s=e.created_at?new Date(e.created_at):null,o=e.last_active_at?new Date(e.last_active_at):s;let n=0;if(o){const e=(Date.now()-o.getTime())/864e5;e<=7?n=50:e<=30?n=20:e<=90&&(n=5)}const a=10*t+n;let r=null;return a>=200?r="legend":a>=100?r="power_reader":a>=50?r="active_reader":a>=10?r="community_star":a>0&&(r="new_reader"),{score:a,tier:r,fallback:!0}};try{const e=Array.from(v.keys()).slice(0,50);console.groupCollapsed("[Users.load] rankingsMap (sample keys)"),console.log("keys sample:",e),e.slice(0,10).forEach(e=>{console.log("rankingsMap[".concat(e,"] ="),v.get(e))}),console.groupEnd()}catch(p){console.warn("Failed to log rankingsMap sample",p)}const y=e=>{var t,s,o,n,a,r,i;if(!e)return null;const l=function(){for(var t=arguments.length,s=new Array(t),o=0;o<t;o++)s[o]=arguments[o];for(const n of s)if(e&&Object.prototype.hasOwnProperty.call(e,n)){const t=Number(e[n]);if(!Number.isNaN(t))return t}return null},d=l("score","score_30","score_30_days","score30","score_last_30","last_30_score","value"),c=null!==(t=null!==(s=null!==(o=null!==(n=e.tier)&&void 0!==n?n:e.rank_tier)&&void 0!==o?o:e.level)&&void 0!==s?s:e.category)&&void 0!==t?t:null,u=l("rank_position","position","rank","rankPos"),p=!!(null!==(a=null!==(r=null!==(i=e.subscription_bonus_applied)&&void 0!==i?i:e.has_subscription_boost)&&void 0!==r?r:e.subscription_boost)&&void 0!==a?a:e.subscriber_bonus);return{raw:e,score:d,tier:c,position:u,subscription:p}},b=e=>{const t=(Date.now()-(e.last_active_at?new Date(e.last_active_at).getTime():new Date(e.created_at).getTime()))/6e4,s=t<=5,o=e.deactivated_at?"signed_out":s?"online":"offline";let n=null;return n=s?"Online":e.last_active_at||e.created_at?t<1?"now":t<60?"".concat(Math.round(t),"m ago"):t<1440?"".concat(Math.round(t/60),"h ago"):"".concat(Math.round(t/1440),"d ago"):"never",{status:o,lastSeen:n}},_=(g||[]).map(e=>{const t=v.get(String(e.id)),s=e.email?v.get(String(e.email)):null,n=y(t||s||null);let a=null,r=null,i=!1;if(n&&"number"===typeof n.score)a=n.score,r=n.tier||null;else{const t=f(e);t&&"number"===typeof t.score&&(a=t.score,r=t.tier,i=!0)}n||i?i?console.info("[Users.load] applied fallback ranking for",{id:e.id,email:e.email,score:a,tier:r}):console.debug("[Users.load] ranking matched for",{id:e.id,email:e.email,normalized:n}):console.warn("[Users.load] no ranking and no fallback for profile",{id:e.id,email:e.email});const l=x.get(String(e.id))||{total:0,books:0,pastPapers:0,universities:0},d=b(e);return(0,o.A)((0,o.A)({},e),{},{uploadCount:l.total||0,contribBooks:l.books||0,contribPastPapers:l.pastPapers||0,contribUniversities:l.universities||0,ranking:n?n.raw:null,rankTier:r||null,rankScore:"number"===typeof a?a:null,rankPosition:"number"===typeof(null===n||void 0===n?void 0:n.position)?n.position:null,hasSubscriptionBoost:!(null===n||void 0===n||!n.subscription),status:d.status,lastSeen:d.lastSeen})});_.sort((e,t)=>{var s,o;const n="number"===typeof e.rankScore?e.rankScore:-1,a="number"===typeof t.rankScore?t.rankScore:-1;if(n!==a)return a-n;const r={admin:0,editor:1,viewer:2},i=null!==(s=r[e.role])&&void 0!==s?s:3,l=null!==(o=r[t.role])&&void 0!==o?o:3;if(i!==l)return i-l;const d=(e.display_name||e.email||"").toLowerCase(),c=(t.display_name||t.email||"").toLowerCase();return d.localeCompare(c)}),c(_)}catch(h){console.error("[Users.load] Error loading users:",h),c([])}finally{g(!1)}};(0,n.useEffect)(()=>{T()},[]);const W=(0,n.useMemo)(()=>{let e=s.filter(e=>{const t=!x||e.email&&e.email.toLowerCase().includes(x.toLowerCase())||e.display_name&&e.display_name.toLowerCase().includes(x.toLowerCase()),s=!f||e.role===f,o=!b||e.status===b;return t&&s&&o});return"latest_login"===k?e.sort((e,t)=>{const s=e.created_at?new Date(e.created_at).getTime():0,o=(t.created_at?new Date(t.created_at).getTime():0)-s;return"desc"===w?o:-o}):e.sort((e,t)=>{var s,o;const n="number"===typeof e.rankScore?e.rankScore:-1;let a=("number"===typeof t.rankScore?t.rankScore:-1)-n;if(0!==a)return"desc"===w?a:-a;const r={admin:0,editor:1,viewer:2},i=null!==(s=r[e.role])&&void 0!==s?s:3,l=null!==(o=r[t.role])&&void 0!==o?o:3;if(i!==l)return i-l;const d=(e.display_name||e.email||"").toLowerCase(),c=(t.display_name||t.email||"").toLowerCase();return d.localeCompare(c)}),e},[s,x,f,b,k,w]),M=(0,n.useMemo)(()=>{const e=(A-1)*U,t=e+U;return W.slice(e,t)},[W,A,U]),B=(0,n.useMemo)(()=>Math.max(1,Math.ceil(W.length/U)),[W.length,U]);(0,n.useEffect)(()=>{C(1)},[x,f,b,k,w]);return(0,l.jsxs)("div",{className:"panel",children:[(0,l.jsx)("div",{className:"panel-title",children:"Users"}),(0,l.jsx)(d,{rows:s}),(0,l.jsxs)("div",{style:{display:"flex",gap:6,marginBottom:8,flexWrap:"wrap",alignItems:"center"},children:[(0,l.jsxs)("div",{style:{position:"relative",flex:"1 1 250px",minWidth:"200px",maxWidth:"270px"},children:[(0,l.jsx)(i.CKj,{style:{position:"absolute",left:8,top:"50%",transform:"translateY(-50%)",color:"#8696a0",fontSize:"14px"}}),(0,l.jsx)("input",{type:"text",placeholder:"Search by name or email...",value:x,onChange:e=>v(e.target.value),className:"input",style:{paddingLeft:32,width:"100%",backgroundColor:"black",color:"white",fontSize:"13px"}})]}),(0,l.jsxs)("select",{className:"select",value:f?"role:".concat(f):b?"active:".concat(b):"sort:".concat(k,":").concat(w),onChange:e=>{const t=e.target.value;if(t.startsWith("role:"))y(t.substring(5)),_(""),j("ranking"),S("desc");else if(t.startsWith("active:"))_(t.substring(7)),y(""),j("ranking"),S("desc");else if(t.startsWith("sort:")){const e=t.substring(5).split(":");j(e[0]),S(e[1]),y(""),_("")}},style:{minWidth:200,width:"auto"},children:[(0,l.jsx)("option",{value:"role:",children:"All Roles"}),(0,l.jsx)("option",{value:"role:admin",children:"Admin"}),(0,l.jsx)("option",{value:"role:editor",children:"Editor"}),(0,l.jsx)("option",{value:"role:viewer",children:"Viewer"}),(0,l.jsx)("option",{value:"active:",children:"All Status"}),(0,l.jsx)("option",{value:"active:online",children:"Online"}),(0,l.jsx)("option",{value:"active:offline",children:"Offline"}),(0,l.jsx)("option",{value:"active:signed_out",children:"Signed Out"}),(0,l.jsx)("option",{value:"sort:ranking:desc",children:"Ranking (High to Low)"}),(0,l.jsx)("option",{value:"sort:ranking:asc",children:"Ranking (Low to High)"}),(0,l.jsx)("option",{value:"sort:latest_login:desc",children:"Login (Newest)"}),(0,l.jsx)("option",{value:"sort:latest_login:asc",children:"Login (Oldest)"})]})]}),(0,l.jsxs)("table",{className:"table",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{children:"Rank"}),(0,l.jsx)("th",{children:"Name"}),(0,l.jsx)("th",{children:"Email"}),(0,l.jsx)("th",{children:"Last Seen"}),(0,l.jsx)("th",{children:"Role"}),(0,l.jsx)("th",{children:"Scores"}),(0,l.jsx)("th",{children:"Actions"})]})}),(0,l.jsx)("tbody",{children:p?(0,l.jsx)("tr",{children:(0,l.jsx)("td",{colSpan:7,style:{color:"#8696a0",textAlign:"center"},children:"Loading..."})}):0===M.length?(0,l.jsx)("tr",{children:(0,l.jsx)("td",{colSpan:7,style:{color:"#8696a0",textAlign:"center"},children:"No users found"})}):M.map((e,s)=>{const n=(A-1)*U+s+1;return(0,l.jsxs)("tr",{children:[(0,l.jsxs)("td",{style:{fontSize:"13px",fontWeight:"600",color:"#00a884"},children:["#",n]}),(0,l.jsx)("td",{children:(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,l.jsx)("div",{className:"viewer-avatar",children:e.avatar_url?(0,l.jsx)("img",{src:e.avatar_url,alt:e.display_name||e.email||"User avatar",style:{width:"100%",height:"100%",borderRadius:"50%",objectFit:"cover"}}):(e.display_name||e.email||"?").charAt(0).toUpperCase()}),(0,l.jsx)("span",{children:e.display_name||"\u2014"})]})}),(0,l.jsx)("td",{children:e.email}),(0,l.jsx)("td",{children:(0,l.jsx)("span",{style:{fontSize:"12px",fontWeight:"Online"===e.lastSeen?"600":"500",color:"Online"===e.lastSeen?"#00a884":"#8696a0"},children:e.lastSeen||"never"})}),(0,l.jsx)("td",{children:(a=e.email,D.includes(a)?(0,l.jsx)("span",{style:{color:"#ffd700",fontWeight:600},children:"Superadmin"}):(0,l.jsxs)("select",{className:"select",value:e.role,onChange:t=>(async(e,t)=>{m(t=>(0,o.A)((0,o.A)({},t),{},{[e]:!0}));try{console.log("[Users.changeRole] Updating role for user:",e,"to:",t),await(0,r.v_)(e,t),console.log("[Users.changeRole] Role updated successfully"),await T()}catch(s){console.error("[Users.changeRole] Error updating role:",(null===s||void 0===s?void 0:s.message)||s),alert("Failed to update role: ".concat((null===s||void 0===s?void 0:s.message)||"Unknown error"))}finally{m(t=>(0,o.A)((0,o.A)({},t),{},{[e]:!1}))}})(e.id,t.target.value),disabled:!t||!!h[e.id],title:t?void 0:"Only the superadmin can change roles",children:[(0,l.jsx)("option",{value:"viewer",children:"viewer"}),(0,l.jsx)("option",{value:"editor",children:"editor"}),(0,l.jsx)("option",{value:"admin",children:"admin"})]}))}),(0,l.jsx)("td",{children:null!==e.rankScore?(0,l.jsxs)("span",{style:{display:"inline-flex",alignItems:"center",gap:4,padding:"2px 8px",borderRadius:999,fontSize:11,fontWeight:600,background:e.rankScore>=200?"linear-gradient(135deg, #ffd700, #ff6f00)":e.rankScore>=100?"#102a43":e.rankScore>=50?"#0b3a2e":"#111b21",color:e.rankScore>=200?"#111":"#e9edef",cursor:"pointer"},onClick:()=>{var t;(t=e)&&t.id&&(R(t),P(!0))},children:[(0,l.jsx)("span",{children:Math.round(e.rankScore)}),e.hasSubscriptionBoost&&(0,l.jsx)("span",{title:"Includes subscriber activity bonus",style:{fontSize:9,padding:"1px 4px",borderRadius:8,background:"rgba(0,0,0,0.3)"},children:"sub"})]}):(0,l.jsx)("span",{style:{color:"#8696a0",fontSize:11},children:"Not ranked yet"})}),(0,l.jsx)("td",{children:(0,l.jsxs)("div",{className:"actions",children:[(0,l.jsx)("button",{className:"btn",onClick:()=>L("/books/admin/users/".concat(e.id)),children:"Details"}),(()=>{const t=(e.uploadCount||0)>0,s="admin"===e.role||"editor"===e.role;return s||t?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("button",{className:"btn",onClick:()=>L("/books/admin/users/".concat(e.id,"?tab=uploads")),style:{marginLeft:8},children:"View uploads"}),!s&&t&&(0,l.jsx)("span",{style:{marginLeft:6,padding:"2px 6px",borderRadius:8,fontSize:10,background:"#202c33",color:"#8696a0"},children:"had admin/editor access"})]}):null})()]})})]},e.id);var a})})]}),W.length>0&&(0,l.jsxs)("div",{className:"actions",style:{marginTop:10,justifyContent:"space-between"},children:[(0,l.jsx)("button",{className:"btn",disabled:A<=1,onClick:()=>C(e=>Math.max(1,e-1)),children:"Prev"}),(0,l.jsxs)("span",{style:{color:"#cfd8dc"},children:["Page ",A," of ",B," (",W.length," users)"]}),(0,l.jsx)("button",{className:"btn",disabled:A>=B,onClick:()=>C(e=>Math.min(B,e+1)),children:"Next"})]}),N&&z&&(0,l.jsx)(u,{user:z,onClose:()=>P(!1)})]})}}}]);
//# sourceMappingURL=441.8fecbaae.chunk.js.map