"use strict";(self.webpackChunkcampuslife=self.webpackChunkcampuslife||[]).push([[767],{1767:(e,t,a)=>{a.r(t),a.d(t,{default:()=>b});var s=a(5043),l=a(4218),n=a(5200),i=a(9379),o=a(3515),r=a(9101),c=a(579);const d=e=>{let{userProfile:t}=e;const[a,l]=(0,s.useState)(!0),[n,d]=(0,s.useState)([]),[u,h]=(0,s.useState)(0),[p,m]=(0,s.useState)(1),[x]=(0,s.useState)(23),[v,g]=(0,s.useState)(""),[j,y]=(0,s.useState)([]),[b,f]=(0,s.useState)(null),[w,N]=(0,s.useState)({col:"created_at",dir:"desc"}),[k,C]=(0,s.useState)(null),[_,S]=(0,s.useState)({}),[A,F]=(0,s.useState)(null),[z,P]=(0,s.useState)(null),{confirm:L,showToast:B}=(0,r.v)(),E=["campuslives254@gmail.com","paltechsomalux@gmail.com"],T="admin"===(null===t||void 0===t?void 0:t.role)||E.includes(null===t||void 0===t?void 0:t.email),R="editor"===(null===t||void 0===t?void 0:t.role)||E.includes(null===t||void 0===t?void 0:t.email),D=(0,s.useMemo)(()=>Math.max(1,Math.ceil(u/x)),[u,x]),M=async()=>{l(!0);try{const{data:e,count:t}=await(0,o.x1)({page:p,pageSize:x,search:v,categoryId:b,sort:w});d(e),h(t)}finally{l(!1)}};(0,s.useEffect)(()=>{(async()=>{try{y(await(0,o.jE)())}catch(e){}t&&await M()})()},[p,v,b,w.col,w.dir,t]);const I=e=>!!T||!!R,U=()=>{C(null),S({}),F(null),P(null)},W=e=>{N(t=>t.col===e?{col:e,dir:"asc"===t.dir?"desc":"asc"}:{col:e,dir:"asc"})};return(0,c.jsx)("div",{children:(0,c.jsxs)("div",{className:"panel",children:[(0,c.jsx)("div",{className:"panel-title",children:"Books Management"}),!a&&n.length>0&&(0,c.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:"8px",marginBottom:"12px"},children:[(0,c.jsxs)("div",{style:{background:"#1a2332",border:"1px solid #2a3f56",borderRadius:"6px",padding:"8px 12px",color:"#8696a0",fontSize:"0.85rem"},children:[(0,c.jsx)("div",{style:{color:"#00a884",fontSize:"1.2rem",fontWeight:"600"},children:n.reduce((e,t)=>e+(t.downloads||0),0)}),(0,c.jsx)("div",{children:"Total Downloads"})]}),(0,c.jsxs)("div",{style:{background:"#1a2332",border:"1px solid #2a3f56",borderRadius:"6px",padding:"8px 12px",color:"#8696a0",fontSize:"0.85rem"},children:[(0,c.jsx)("div",{style:{color:"#34B7F1",fontSize:"1.2rem",fontWeight:"600"},children:n.reduce((e,t)=>e+(t.views||0),0)}),(0,c.jsx)("div",{children:"Total Views"})]}),(0,c.jsxs)("div",{style:{background:"#1a2332",border:"1px solid #2a3f56",borderRadius:"6px",padding:"8px 12px",color:"#8696a0",fontSize:"0.85rem"},children:[(0,c.jsx)("div",{style:{color:"#FF6B9D",fontSize:"1.2rem",fontWeight:"600"},children:n.reduce((e,t)=>e+(t.comments_count||0),0)}),(0,c.jsx)("div",{children:"Total Comments"})]}),(0,c.jsxs)("div",{style:{background:"#1a2332",border:"1px solid #2a3f56",borderRadius:"6px",padding:"8px 12px",color:"#8696a0",fontSize:"0.85rem"},children:[(0,c.jsx)("div",{style:{color:"#F44336",fontSize:"1.2rem",fontWeight:"600"},children:n.reduce((e,t)=>e+(t.likes_count||0),0)}),(0,c.jsx)("div",{children:"Total Likes"})]}),(0,c.jsxs)("div",{style:{background:"#1a2332",border:"1px solid #2a3f56",borderRadius:"6px",padding:"8px 12px",color:"#8696a0",fontSize:"0.85rem"},children:[(0,c.jsxs)("div",{style:{color:"#FFCC00",fontSize:"1.2rem",fontWeight:"600"},children:[n.length,"/",u]}),(0,c.jsx)("div",{children:"Page Books"})]})]}),(0,c.jsxs)("div",{className:"grid-2",style:{marginBottom:6},children:[(0,c.jsxs)("div",{className:"panel",style:{padding:"6px 8px"},children:[(0,c.jsx)("label",{className:"label",style:{marginBottom:"0.2rem"},children:"Search"}),(0,c.jsx)("input",{className:"input",value:v,onChange:e=>{m(1),g(e.target.value)},placeholder:"Search by title...",style:{fontSize:"0.9rem"}})]}),(0,c.jsxs)("div",{className:"panel",style:{padding:"6px 8px"},children:[(0,c.jsx)("label",{className:"label",style:{marginBottom:"0.2rem"},children:"Category"}),(0,c.jsxs)("select",{className:"select",value:b||"",onChange:e=>{m(1),f(e.target.value||null)},style:{fontSize:"0.9rem"},children:[(0,c.jsx)("option",{value:"",children:"All"}),j.map(e=>(0,c.jsx)("option",{value:e.id,children:e.name},e.id))]})]})]}),(0,c.jsx)("div",{className:"actions",style:{marginBottom:10},children:(0,c.jsx)("button",{className:"btn primary",onClick:()=>window.location.href="/books/admin/upload",children:"Add / Upload New Book"})}),(0,c.jsx)("div",{className:"panel",style:{padding:0,overflowX:"auto",WebkitOverflowScrolling:"touch"},children:(0,c.jsxs)("table",{className:"table",style:{minWidth:"1620px",borderCollapse:"separate",borderSpacing:0},children:[(0,c.jsx)("thead",{children:(0,c.jsxs)("tr",{children:[(0,c.jsx)("th",{style:{width:"60px"},children:"Cover"}),(0,c.jsxs)("th",{style:{width:"300px",cursor:"pointer"},onClick:()=>W("title"),children:["Title ","title"===w.col?"asc"===w.dir?"\u25b2":"\u25bc":""]}),(0,c.jsxs)("th",{style:{width:"200px",cursor:"pointer"},onClick:()=>W("author"),children:["Author ","author"===w.col?"asc"===w.dir?"\u25b2":"\u25bc":""]}),(0,c.jsx)("th",{style:{width:"120px"},children:"Category"}),(0,c.jsxs)("th",{style:{width:"100px",cursor:"pointer"},onClick:()=>W("year"),children:["Year ","year"===w.col?"asc"===w.dir?"\u25b2":"\u25bc":""]}),(0,c.jsx)("th",{style:{width:"100px"},children:"Pages"}),(0,c.jsx)("th",{style:{width:"180px"},children:"Publisher"}),(0,c.jsxs)("th",{style:{width:"100px",cursor:"pointer"},onClick:()=>W("downloads"),children:["Downloads ","downloads"===w.col?"asc"===w.dir?"\u25b2":"\u25bc":""]}),(0,c.jsxs)("th",{style:{width:"80px",cursor:"pointer",background:"rgba(52, 183, 241, 0.1)",borderBottom:"2px solid #34B7F1"},onClick:()=>W("views"),children:["Views ","views"===w.col?"asc"===w.dir?"\u25b2":"\u25bc":""]}),(0,c.jsxs)("th",{style:{width:"80px",cursor:"pointer",background:"rgba(255, 107, 157, 0.1)",borderBottom:"2px solid #FF6B9D"},onClick:()=>W("comments_count"),children:["Comments ","comments_count"===w.col?"asc"===w.dir?"\u25b2":"\u25bc":""]}),(0,c.jsxs)("th",{style:{width:"80px",cursor:"pointer",background:"rgba(244, 67, 54, 0.1)",borderBottom:"2px solid #F44336"},onClick:()=>W("likes_count"),children:["Likes ","likes_count"===w.col?"asc"===w.dir?"\u25b2":"\u25bc":""]}),(0,c.jsx)("th",{style:{width:"100px"},children:"Date Added"}),(0,c.jsx)("th",{style:{width:"200px"},children:"Actions"})]})}),(0,c.jsx)("tbody",{children:a?(0,c.jsx)("tr",{children:(0,c.jsx)("td",{colSpan:13,style:{color:"#8696a0",textAlign:"center"},children:"Loading..."})}):0===n.length?(0,c.jsx)("tr",{children:(0,c.jsx)("td",{colSpan:13,style:{color:"#8696a0",textAlign:"center"},children:"No data"})}):n.map(e=>{var t;return(0,c.jsxs)("tr",{children:[(0,c.jsx)("td",{children:e.cover_url?(0,c.jsx)("img",{src:e.cover_url,alt:"cover",style:{width:36,height:48,objectFit:"cover",borderRadius:4}}):(0,c.jsx)("span",{className:"badge",children:"No cover"})}),(0,c.jsx)("td",{children:k===e.id?(0,c.jsx)("input",{className:"input",value:_.title,onChange:e=>S((0,i.A)((0,i.A)({},_),{},{title:e.target.value}))}):e.title}),(0,c.jsx)("td",{children:k===e.id?(0,c.jsx)("input",{className:"input",value:_.author,onChange:e=>S((0,i.A)((0,i.A)({},_),{},{author:e.target.value}))}):e.author}),(0,c.jsx)("td",{children:k===e.id?(0,c.jsxs)("select",{className:"select",value:_.category_id||"",onChange:e=>S((0,i.A)((0,i.A)({},_),{},{category_id:e.target.value||null})),children:[(0,c.jsx)("option",{value:"",children:"Uncategorized"}),j.map(e=>(0,c.jsx)("option",{value:e.id,children:e.name},e.id))]}):(null===(t=j.find(t=>t.id===e.category_id))||void 0===t?void 0:t.name)||"\u2014"}),(0,c.jsx)("td",{children:k===e.id?(0,c.jsx)("input",{className:"input",value:_.year,onChange:e=>S((0,i.A)((0,i.A)({},_),{},{year:e.target.value}))}):e.year||"\u2014"}),(0,c.jsx)("td",{children:k===e.id?(0,c.jsx)("input",{className:"input",type:"number",placeholder:"Pages",value:_.pages,onChange:e=>S((0,i.A)((0,i.A)({},_),{},{pages:e.target.value}))}):e.pages||"\u2014"}),(0,c.jsx)("td",{children:k===e.id?(0,c.jsx)("input",{className:"input",placeholder:"Publisher",value:_.publisher,onChange:e=>S((0,i.A)((0,i.A)({},_),{},{publisher:e.target.value}))}):e.publisher||"\u2014"}),(0,c.jsx)("td",{children:e.downloads||0}),(0,c.jsx)("td",{style:{fontWeight:"500",color:"#00a884"},children:e.views||0}),(0,c.jsx)("td",{style:{fontWeight:"500",color:"#FF6B9D"},children:e.comments_count||0}),(0,c.jsx)("td",{style:{fontWeight:"500",color:"#F44336"},children:e.likes_count||0}),(0,c.jsx)("td",{children:new Date(e.created_at).toLocaleDateString()}),(0,c.jsx)("td",{children:k===e.id?(0,c.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"10px",minWidth:"180px"},children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"label",children:"Replace PDF"}),(0,c.jsxs)("div",{className:"file-upload-btn",onClick:()=>document.getElementById("pdf-input-".concat(e.id)).click(),style:{border:"1px solid #374151",borderRadius:"6px",padding:"6px 12px",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",background:A?"rgba(0, 168, 132, 0.1)":"transparent",color:A?"#00a884":"#e9edef",transition:"all 0.2s"},children:[(0,c.jsx)("input",{id:"pdf-input-".concat(e.id),type:"file",accept:"application/pdf",onChange:e=>{var t;return F((null===(t=e.target.files)||void 0===t?void 0:t[0])||null)},style:{display:"none"}}),A?(0,c.jsxs)(c.Fragment,{children:["\ud83d\udcc4 ",A.name.slice(0,20),A.name.length>20?"...":""]}):(0,c.jsx)(c.Fragment,{children:"\ud83d\udcc4 Choose PDF"})]})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"label",children:"Replace Cover"}),(0,c.jsxs)("div",{className:"file-upload-btn",onClick:()=>document.getElementById("cover-input-".concat(e.id)).click(),style:{border:"1px solid #374151",borderRadius:"6px",padding:"6px 12px",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",background:z?"rgba(0, 168, 132, 0.1)":"transparent",color:z?"#00a884":"#e9edef",transition:"all 0.2s"},children:[(0,c.jsx)("input",{id:"cover-input-".concat(e.id),type:"file",accept:"image/*",onChange:e=>{var t;return P((null===(t=e.target.files)||void 0===t?void 0:t[0])||null)},style:{display:"none"}}),z?(0,c.jsxs)(c.Fragment,{children:["\ud83d\uddbc\ufe0f ",z.name.slice(0,20),z.name.length>20?"...":""]}):(0,c.jsx)(c.Fragment,{children:"\ud83d\uddbc\ufe0f Choose Image"})]})]}),(0,c.jsxs)("div",{style:{display:"flex",gap:"8px",marginTop:"4px"},children:[(0,c.jsx)("button",{className:"btn primary",onClick:()=>(async e=>{if(!I())return void B({type:"error",message:"You can only edit books you uploaded."});const t=(0,i.A)({},_);try{await(0,o.r3)(e.id,{updates:t,newPdfFile:A,newCoverFile:z,oldFilePath:e.file_path}),U(),await M(),B({type:"success",message:"Book details updated."})}catch(a){console.error("Failed to update book:",a),B({type:"error",message:(null===a||void 0===a?void 0:a.message)||"Failed to update book."})}})(e),children:"Save"}),(0,c.jsx)("button",{className:"btn",onClick:U,children:"Cancel"})]})]}):(0,c.jsxs)("div",{className:"actions",children:[(0,c.jsx)("button",{className:"btn",onClick:()=>(e=>{I()?(C(e.id),S({title:e.title||"",author:e.author||"",year:e.year||"",category_id:e.category_id||null,language:e.language||"",isbn:e.isbn||"",pages:e.pages||"",publisher:e.publisher||""}),F(null),P(null)):B({type:"error",message:"You do not have permission to edit this book."})})(e),disabled:!I(),children:"Edit"}),(0,c.jsx)("button",{className:"btn",onClick:()=>(async e=>{if(!I())return void B({type:"error",message:"You can only delete books you uploaded."});if(await L({title:"Delete book?",message:'Delete "'.concat(e.title,'" and its files? This action cannot be undone.'),confirmLabel:"Delete",cancelLabel:"Cancel",variant:"danger"}))try{await(0,o.HA)({id:e.id,file_path:e.file_path}),await M(),B({type:"success",message:"Book deleted."})}catch(t){console.error("Failed to delete book:",t),B({type:"error",message:(null===t||void 0===t?void 0:t.message)||"Failed to delete book."})}})(e),disabled:!I(),children:"Delete"})]})})]},e.id)})})]})}),(0,c.jsxs)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"12px",marginTop:"24px",marginBottom:"20px"},children:[(0,c.jsx)("button",{onClick:()=>m(e=>Math.max(1,e-1)),disabled:p<=1,style:{padding:"8px 16px",background:p<=1?"#e0e0e0":"linear-gradient(135deg, #00a884 0%, #008060 100%)",color:p<=1?"#999":"#fff",border:"none",borderRadius:"6px",cursor:p<=1?"not-allowed":"pointer",fontSize:"14px",fontWeight:"600",transition:"all 0.2s",opacity:p<=1?.6:1},children:"\u2190 Prev"}),(0,c.jsxs)("span",{style:{color:"#cfd8dc",fontSize:"14px",fontWeight:"500",minWidth:"120px",textAlign:"center"},children:["Page ",p," of ",D]}),(0,c.jsx)("button",{onClick:()=>m(e=>Math.min(D,e+1)),disabled:p>=D,style:{padding:"8px 16px",background:p>=D?"#e0e0e0":"linear-gradient(135deg, #00a884 0%, #008060 100%)",color:p>=D?"#999":"#fff",border:"none",borderRadius:"6px",cursor:p>=D?"not-allowed":"pointer",fontSize:"14px",fontWeight:"600",transition:"all 0.2s",opacity:p>=D?.6:1},children:"Next \u2192"})]})]})})};var u=a(4972),h=(a(1903),a(9738));const p=e=>{let{userProfile:t}=e;const[a,l]=(0,s.useState)(!0),[n,o]=(0,s.useState)([]),[d,p]=(0,s.useState)(0),[m,x]=(0,s.useState)(1),[v]=(0,s.useState)(10),[g,j]=(0,s.useState)(""),[y,b]=(0,s.useState)({col:"created_at",dir:"desc"}),[f,w]=(0,s.useState)(null),[N,k]=(0,s.useState)({}),[C,_]=(0,s.useState)(null),[S,A]=(0,s.useState)({}),{confirm:F,showToast:z}=(0,r.v)(),P=["campuslives254@gmail.com","paltechsomalux@gmail.com"],L="admin"===(null===t||void 0===t?void 0:t.role)||P.includes(null===t||void 0===t?void 0:t.email),B="editor"===(null===t||void 0===t?void 0:t.role)||P.includes(null===t||void 0===t?void 0:t.email),E=(0,s.useMemo)(()=>Math.max(1,Math.ceil(d/v)),[d,v]),T=async()=>{l(!0);try{const{data:e,count:t}=await(0,u.Tm)({page:m,pageSize:v,search:g,sort:y});o(e),p(t);const a={};for(const s of e)a[s.id]=await(0,h.lb)(s.id);A(a)}finally{l(!1)}};(0,s.useEffect)(()=>{t&&T()},[m,g,y.col,y.dir,t]);const R=e=>!!L||!!B,D=()=>{w(null),k({}),_(null)},M=e=>{b(t=>t.col===e?{col:e,dir:"asc"===t.dir?"desc":"asc"}:{col:e,dir:"asc"})};return(0,c.jsx)("div",{children:(0,c.jsxs)("div",{className:"panel",children:[(0,c.jsx)("div",{className:"panel-title",children:"Universities Management"}),!a&&n.length>0&&(0,c.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:"8px",marginBottom:"12px"},children:[(0,c.jsxs)("div",{style:{background:"#1a2332",border:"1px solid #2a3f56",borderRadius:"6px",padding:"8px 12px",color:"#8696a0",fontSize:"0.85rem"},children:[(0,c.jsx)("div",{style:{color:"#34B7F1",fontSize:"1.2rem",fontWeight:"600"},children:n.reduce((e,t)=>e+(t.views||0),0)}),(0,c.jsx)("div",{children:"Total Views"})]}),(0,c.jsxs)("div",{style:{background:"#1a2332",border:"1px solid #2a3f56",borderRadius:"6px",padding:"8px 12px",color:"#8696a0",fontSize:"0.85rem"},children:[(0,c.jsx)("div",{style:{color:"#E74C3C",fontSize:"1.2rem",fontWeight:"600"},children:n.reduce((e,t)=>e+(t.likes_count||0),0)}),(0,c.jsx)("div",{children:"Total Likes"})]}),(0,c.jsxs)("div",{style:{background:"#1a2332",border:"1px solid #2a3f56",borderRadius:"6px",padding:"8px 12px",color:"#8696a0",fontSize:"0.85rem"},children:[(0,c.jsxs)("div",{style:{color:"#FFCC00",fontSize:"1.2rem",fontWeight:"600"},children:[n.length,"/",d]}),(0,c.jsx)("div",{children:"Page Universities"})]})]}),(0,c.jsxs)("div",{className:"panel",style:{marginBottom:6},children:[(0,c.jsx)("label",{className:"label",children:"Search"}),(0,c.jsx)("input",{className:"input",value:g,onChange:e=>{x(1),j(e.target.value)},placeholder:"Search by name or location..."})]}),(0,c.jsx)("div",{className:"actions",style:{marginBottom:6},children:(0,c.jsx)("button",{className:"btn primary",onClick:()=>window.location.href="/books/admin/upload",children:"Add New University"})}),(0,c.jsx)("div",{className:"panel",style:{padding:0,overflowX:"auto"},children:(0,c.jsxs)("table",{className:"table",style:{minWidth:"1200px"},children:[(0,c.jsx)("thead",{children:(0,c.jsxs)("tr",{children:[(0,c.jsx)("th",{style:{width:"60px"},children:"Cover"}),(0,c.jsxs)("th",{style:{width:"250px",cursor:"pointer"},onClick:()=>M("name"),children:["Name ","name"===y.col?"asc"===y.dir?"\u25b2":"\u25bc":""]}),(0,c.jsx)("th",{style:{width:"300px"},children:"Description"}),(0,c.jsx)("th",{style:{width:"150px"},children:"Location"}),(0,c.jsxs)("th",{style:{width:"100px",cursor:"pointer"},onClick:()=>M("established"),children:["Est. ","established"===y.col?"asc"===y.dir?"\u25b2":"\u25bc":""]}),(0,c.jsx)("th",{style:{width:"100px"},children:"Students"}),(0,c.jsxs)("th",{style:{width:"80px",cursor:"pointer",background:"rgba(52, 183, 241, 0.1)",borderBottom:"2px solid #34B7F1"},onClick:()=>M("views_count"),children:["Views ","views_count"===y.col?"asc"===y.dir?"\u25b2":"\u25bc":""]}),(0,c.jsxs)("th",{style:{width:"80px",cursor:"pointer",background:"rgba(231, 76, 60, 0.1)",borderBottom:"2px solid #E74C3C"},onClick:()=>M("likes_count"),children:["Likes ","likes_count"===y.col?"asc"===y.dir?"\u25b2":"\u25bc":""]}),(0,c.jsx)("th",{style:{width:"80px",background:"rgba(102, 187, 106, 0.1)",borderBottom:"2px solid #66BB6A"},children:"Papers"}),(0,c.jsx)("th",{style:{width:"180px"},children:"Actions"})]})}),(0,c.jsx)("tbody",{children:a?(0,c.jsx)("tr",{children:(0,c.jsx)("td",{colSpan:10,style:{textAlign:"center",color:"#8696a0"},children:"Loading..."})}):0===n.length?(0,c.jsx)("tr",{children:(0,c.jsx)("td",{colSpan:10,style:{textAlign:"center",color:"#8696a0"},children:"No data"})}):n.map(e=>{var t,a;return(0,c.jsxs)("tr",{children:[(0,c.jsx)("td",{children:e.cover_image_url?(0,c.jsx)("img",{src:e.cover_image_url,alt:"cover",style:{width:36,height:36,objectFit:"cover",borderRadius:4}}):(0,c.jsx)("span",{className:"badge",children:"No cover"})}),(0,c.jsx)("td",{children:f===e.id?(0,c.jsx)("input",{className:"input",value:N.name,onChange:e=>k((0,i.A)((0,i.A)({},N),{},{name:e.target.value}))}):e.name}),(0,c.jsx)("td",{children:f===e.id?(0,c.jsx)("textarea",{className:"input",rows:2,value:N.description,onChange:e=>k((0,i.A)((0,i.A)({},N),{},{description:e.target.value}))}):(null===(t=e.description)||void 0===t?void 0:t.slice(0,100))||"\u2014"}),(0,c.jsx)("td",{children:f===e.id?(0,c.jsx)("input",{className:"input",value:N.location,onChange:e=>k((0,i.A)((0,i.A)({},N),{},{location:e.target.value}))}):e.location||"\u2014"}),(0,c.jsx)("td",{children:f===e.id?(0,c.jsx)("input",{className:"input",type:"number",value:N.established,onChange:e=>k((0,i.A)((0,i.A)({},N),{},{established:e.target.value}))}):e.established||"\u2014"}),(0,c.jsx)("td",{children:(null===(a=e.student_count)||void 0===a?void 0:a.toLocaleString())||"\u2014"}),(0,c.jsx)("td",{style:{fontWeight:"500",color:"#00a884"},children:e.views||0}),(0,c.jsx)("td",{style:{fontWeight:"500",color:"#E74C3C"},children:e.likes_count||0}),(0,c.jsx)("td",{style:{fontWeight:"500",color:"#66BB6A"},children:S[e.id]||0}),(0,c.jsx)("td",{children:f===e.id?(0,c.jsxs)("div",{style:{display:"flex",gap:"4px",flexDirection:"column"},children:[(0,c.jsx)("button",{className:"btn primary",onClick:()=>(async e=>{if(!R())return void z({type:"error",message:"You do not have permission to edit this university."});const t=(0,i.A)({},N);""===t.established||void 0===t.established?t.established=null:t.established=Number(t.established),""===t.student_count||void 0===t.student_count?t.student_count=null:t.student_count=Number(t.student_count);try{await(0,u.qw)(e.id,{updates:t,newCoverFile:C}),D(),await T(),z({type:"success",message:"University updated successfully."})}catch(a){console.error("Failed to update university:",a),z({type:"error",message:(null===a||void 0===a?void 0:a.message)||"Failed to update university."})}})(e),children:"Save"}),(0,c.jsx)("button",{className:"btn",onClick:D,children:"Cancel"})]}):(0,c.jsxs)("div",{className:"actions",children:[(0,c.jsx)("button",{className:"btn",onClick:()=>(e=>{R()?(w(e.id),k({name:e.name||"",description:e.description||"",website_url:e.website_url||"",location:e.location||"",established:e.established||"",student_count:e.student_count||""}),_(null)):z({type:"error",message:"You do not have permission to edit this university."})})(e),disabled:!R(),children:"Edit"}),(0,c.jsx)("button",{className:"btn",onClick:()=>(async e=>{if(!R())return void z({type:"error",message:"You can only delete universities you uploaded."});if(await F({title:"Delete university?",message:'Delete "'.concat(e.name,'" and its related data? This action cannot be undone.'),confirmLabel:"Delete",cancelLabel:"Cancel",variant:"danger"}))try{await(0,u.wy)({id:e.id,cover_image_url:e.cover_image_url}),await T(),z({type:"success",message:"University deleted."})}catch(t){console.error("Failed to delete university:",t),z({type:"error",message:(null===t||void 0===t?void 0:t.message)||"Failed to delete university."})}})(e),disabled:!R(),children:"Delete"})]})})]},e.id)})})]})}),(0,c.jsxs)("div",{className:"actions",style:{marginTop:6},children:[(0,c.jsx)("button",{className:"btn",disabled:m<=1,onClick:()=>x(e=>Math.max(1,e-1)),children:"Prev"}),(0,c.jsxs)("span",{style:{color:"#cfd8dc"},children:["Page ",m," of ",E]}),(0,c.jsx)("button",{className:"btn",disabled:m>=E,onClick:()=>x(e=>Math.min(E,e+1)),children:"Next"})]})]})})},m=e=>{if(!e)return"\u2014";try{return new Date(e).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0,timeZoneName:"short"})}catch(t){return e}},x=e=>{let{userProfile:t}=e;const[a,l]=(0,s.useState)(!0),[n,o]=(0,s.useState)([]),[d,u]=(0,s.useState)(0),[p,x]=(0,s.useState)(1),[v]=(0,s.useState)(10),[g,j]=(0,s.useState)(""),[y,b]=(0,s.useState)([]),[f,w]=(0,s.useState)(null),[N,k]=(0,s.useState)({col:"created_at",dir:"desc"}),[C,_]=(0,s.useState)(null),[S,A]=(0,s.useState)(new Set),[F,z]=(0,s.useState)(new Set),[P,L]=(0,s.useState)({}),[B,E]=(0,s.useState)(null),[T,R]=(0,s.useState)(!1),[D,M]=(0,s.useState)(""),[I,U]=(0,s.useState)(!1),[W,O]=(0,s.useState)(!1),{confirm:Y,showToast:q}=(0,r.v)(),H="admin"===(null===t||void 0===t?void 0:t.role),V="editor"===(null===t||void 0===t?void 0:t.role),K=(0,s.useMemo)(()=>Math.max(1,Math.ceil(d/v)),[d,v]),X=async()=>{l(!0);try{const{data:e,count:t}=await(0,h.Up)({page:p,pageSize:v,search:g,faculty:f,sort:N});o(e),u(t)}finally{l(!1)}};(0,s.useEffect)(()=>{(async()=>{try{b(await(0,h.Re)())}catch(e){}})()},[]),(0,s.useEffect)(()=>{t&&X()},[p,g,f,N.col,N.dir,t]);const G=e=>!!H||!!V,Q=()=>{_(null),L({}),E(null),R(!1),M("")},Z=()=>{U(!1),L({}),R(!1),M(""),A(new Set),O(!1)},$=e=>k(t=>t.col===e?{col:e,dir:"asc"===t.dir?"desc":"asc"}:{col:e,dir:"asc"});return(0,c.jsx)("div",{children:(0,c.jsxs)("div",{className:"panel",children:[(0,c.jsx)("div",{className:"panel-title",children:"Past Papers Management"}),!a&&n.length>0&&(0,c.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:"8px",marginBottom:"12px"},children:[(0,c.jsxs)("div",{style:{background:"#1a2332",border:"1px solid #2a3f56",borderRadius:"6px",padding:"8px 12px",color:"#8696a0",fontSize:"0.85rem"},children:[(0,c.jsx)("div",{style:{color:"#00a884",fontSize:"1.2rem",fontWeight:"600"},children:n.reduce((e,t)=>e+(t.downloads_count||0),0)}),(0,c.jsx)("div",{children:"Total Downloads"})]}),(0,c.jsxs)("div",{style:{background:"#1a2332",border:"1px solid #2a3f56",borderRadius:"6px",padding:"8px 12px",color:"#8696a0",fontSize:"0.85rem"},children:[(0,c.jsx)("div",{style:{color:"#34B7F1",fontSize:"1.2rem",fontWeight:"600"},children:n.reduce((e,t)=>e+(t.views_count||0),0)}),(0,c.jsx)("div",{children:"Total Views"})]}),(0,c.jsxs)("div",{style:{background:"#1a2332",border:"1px solid #2a3f56",borderRadius:"6px",padding:"8px 12px",color:"#8696a0",fontSize:"0.85rem"},children:[(0,c.jsxs)("div",{style:{color:"#FFCC00",fontSize:"1.2rem",fontWeight:"600"},children:[n.length,"/",d]}),(0,c.jsx)("div",{children:"Page Papers"})]})]}),(0,c.jsxs)("div",{className:"grid-2",style:{marginBottom:6},children:[(0,c.jsxs)("div",{className:"panel",children:[(0,c.jsx)("label",{className:"label",children:"Search"}),(0,c.jsx)("input",{className:"input",value:g,onChange:e=>{x(1),j(e.target.value.trim())},placeholder:"e.g., MENT 130 or Introduction to..."})]}),(0,c.jsxs)("div",{className:"panel",children:[(0,c.jsx)("label",{className:"label",children:"Faculty"}),(0,c.jsxs)("select",{className:"select",value:f||"",onChange:e=>{x(1),w(e.target.value||null)},children:[(0,c.jsx)("option",{value:"",children:"All Faculties"}),(0,c.jsx)("option",{value:"Unknown",children:"Unknown"}),y.map(e=>(0,c.jsx)("option",{value:e,children:e},e))]})]})]}),(0,c.jsxs)("div",{className:"actions",style:{marginBottom:6},children:[(0,c.jsx)("button",{className:"btn primary",onClick:()=>window.location.href="/books/admin/upload",children:"Add New Past Paper"}),!W&&(0,c.jsx)("button",{className:"btn",onClick:()=>O(!0),style:{background:"#00a884",color:"#e9edef"},children:"\ud83d\udccb Bulk Edit"}),W&&!I&&(0,c.jsx)("button",{className:"btn",onClick:()=>{O(!1),A(new Set)},style:{background:"#2a3f56",color:"#e9edef"},children:"\u2715 Cancel Selection"})]}),I&&(0,c.jsxs)("div",{style:{background:"#1a2332",border:"1px solid #2a3f56",borderRadius:"6px",padding:"12px",marginBottom:"12px"},children:[(0,c.jsxs)("div",{style:{marginBottom:"12px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,c.jsxs)("h3",{style:{margin:0,color:"#00a884"},children:["Edit ",S.size," Past Paper",1!==S.size?"s":""]}),(0,c.jsx)("button",{className:"btn",onClick:Z,style:{background:"#2a3f56",color:"#e9edef"},children:"Cancel"})]}),(0,c.jsxs)("div",{className:"grid-2",style:{gap:"12px",marginBottom:"12px"},children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"label",style:{fontSize:"13px"},children:"Unit Name"}),(0,c.jsx)("input",{className:"input",placeholder:"Leave blank to skip",value:P.unit_name||"",onChange:e=>L((0,i.A)((0,i.A)({},P),{},{unit_name:e.target.value}))})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"label",style:{fontSize:"13px"},children:"Unit Code"}),(0,c.jsx)("input",{className:"input",placeholder:"Leave blank to skip",value:P.unit_code||"",onChange:e=>L((0,i.A)((0,i.A)({},P),{},{unit_code:e.target.value}))})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"label",style:{fontSize:"13px"},children:"Faculty"}),T?(0,c.jsx)("input",{className:"input",placeholder:"e.g., Engineering",value:D,onChange:e=>M(e.target.value)}):(0,c.jsxs)("select",{className:"select",value:P.faculty||"",onChange:e=>L((0,i.A)((0,i.A)({},P),{},{faculty:e.target.value})),children:[(0,c.jsx)("option",{value:"",children:"Leave blank to skip"}),y&&y.length>0?y.map(e=>(0,c.jsx)("option",{value:e,children:e},e)):(0,c.jsx)("option",{value:"",children:"No faculties available"})]}),(0,c.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"4px",marginTop:"4px",fontSize:"12px"},children:[(0,c.jsx)("input",{type:"checkbox",id:"custom-faculty-multi",checked:T,onChange:e=>{R(e.target.checked),e.target.checked||M("")},style:{width:"14px",height:"14px",cursor:"pointer"}}),(0,c.jsx)("label",{htmlFor:"custom-faculty-multi",style:{color:"#8696a0",cursor:"pointer"},children:"Add custom faculty"})]})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"label",style:{fontSize:"13px"},children:"Year"}),(0,c.jsx)("input",{className:"input",type:"number",placeholder:"Leave blank to skip",value:P.year||"",onChange:e=>L((0,i.A)((0,i.A)({},P),{},{year:e.target.value}))})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"label",style:{fontSize:"13px"},children:"Semester"}),(0,c.jsxs)("select",{className:"select",value:P.semester||"",onChange:e=>L((0,i.A)((0,i.A)({},P),{},{semester:e.target.value})),children:[(0,c.jsx)("option",{value:"",children:"Leave blank to skip"}),(0,c.jsx)("option",{value:"1",children:"1"}),(0,c.jsx)("option",{value:"2",children:"2"}),(0,c.jsx)("option",{value:"3",children:"3"})]})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"label",style:{fontSize:"13px"},children:"Exam Type"}),(0,c.jsxs)("select",{className:"select",value:P.exam_type||"",onChange:e=>L((0,i.A)((0,i.A)({},P),{},{exam_type:e.target.value})),children:[(0,c.jsx)("option",{value:"",children:"Leave blank to skip"}),(0,c.jsx)("option",{value:"Main",children:"Main"}),(0,c.jsx)("option",{value:"Supplementary",children:"Supplementary"}),(0,c.jsx)("option",{value:"CAT",children:"CAT"}),(0,c.jsx)("option",{value:"Mock",children:"Mock"})]})]})]}),(0,c.jsxs)("div",{style:{display:"flex",gap:"8px",justifyContent:"flex-end"},children:[(0,c.jsxs)("button",{className:"btn primary",onClick:async()=>{if(0===S.size)return void q({type:"error",message:"No past papers selected."});const e={};if(P.faculty&&(e.faculty=P.faculty||(T?D:P.faculty)),P.unit_code&&(e.unit_code=P.unit_code),P.unit_name&&(e.unit_name=P.unit_name),P.year&&(e.year=P.year),P.semester&&(e.semester=P.semester),P.exam_type&&(e.exam_type=P.exam_type),0!==Object.keys(e).length)try{const t=T?D:P.faculty;if(e.faculty&&!t)return void q({type:"error",message:"Please select or enter a faculty."});const a=Array.from(S).map(e=>{const t=n.find(t=>t.id===e);return{id:e,cached:t}}),s=a.filter(e=>!e.cached).map(e=>e.id);let r=new Map;if(s.length>0){const{data:e}=await(0,h.Up)({page:1,pageSize:1e4,search:g,faculty:f,sort:N});r=new Map(e.map(e=>[e.id,e]))}const c=[],d=5;for(const{id:l,cached:n}of a){const a=n||r.get(l);a?(c.push((0,h.MK)(l,{updates:(0,i.A)((0,i.A)({},e),{},{faculty:e.faculty||t}),newPdfFile:null,oldFilePath:a.file_path})),c.length>=d&&(await Promise.all(c),c.length=0)):console.warn("Paper with ID ".concat(l," not found"))}c.length>0&&await Promise.all(c),Z(),l(!0);const{data:m,count:x}=await(0,h.Up)({page:p,pageSize:v,search:g,faculty:f,sort:N});o(m),u(x),l(!1),q({type:"success",message:"".concat(S.size," past paper(s) updated successfully.")})}catch(t){console.error("Failed to update past papers:",(null===t||void 0===t?void 0:t.message)||t),q({type:"error",message:(null===t||void 0===t?void 0:t.message)||"Failed to update past papers."})}else q({type:"error",message:"Please enter at least one field to update."})},style:{background:"#00a884"},children:["Save Changes to All ",S.size," Item",1!==S.size?"s":""]}),(0,c.jsx)("button",{className:"btn",onClick:Z,style:{background:"#2a3f56",color:"#e9edef"},children:"Cancel"})]})]}),S.size>0&&!I&&(0,c.jsxs)("div",{style:{background:"#1a2332",border:"1px solid #2a3f56",borderRadius:"6px",padding:"12px",marginBottom:"12px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,c.jsxs)("span",{style:{color:"#8696a0"},children:[S.size," item",1!==S.size?"s":""," selected"]}),(0,c.jsxs)("div",{style:{display:"flex",gap:"8px",justifyContent:"flex-end"},children:[(0,c.jsxs)("button",{className:"btn primary",onClick:()=>{if(0===S.size)return void q({type:"error",message:"Please select at least one past paper to edit."});const e=Array.from(S).filter(e=>n.some(t=>t.id===e));if(e.length>0){if(!e.every(e=>{n.find(t=>t.id===e);return G()}))return void q({type:"error",message:"You do not have permission to edit some of the selected past papers."})}U(!0),L({faculty:"",unit_code:"",unit_name:"",year:"",semester:"",exam_type:""}),R(!1),M("")},style:{background:"#00a884"},children:["Edit Selected (",S.size,")"]}),(0,c.jsx)("button",{className:"btn",onClick:()=>A(new Set),style:{background:"#2a3f56",color:"#e9edef"},children:"Clear Selection"})]})]}),(0,c.jsx)("div",{className:"panel",style:{padding:0,overflowX:"auto"},children:(0,c.jsxs)("table",{className:"table",style:{minWidth:"1200px"},children:[(0,c.jsx)("thead",{children:(0,c.jsxs)("tr",{children:[W&&(0,c.jsx)("th",{style:{width:"40px"},children:(0,c.jsx)("input",{type:"checkbox",checked:S.size===d&&d>0,onChange:()=>{S.size===d&&d>0?A(new Set):(async()=>{try{const{data:e}=await(0,h.Up)({page:1,pageSize:1e4,search:g,faculty:f,sort:N});return new Set(e.map(e=>e.id))}catch(e){return console.error("Failed to fetch all matching papers:",e),new Set}})().then(e=>{A(e)})},style:{width:"16px",height:"16px",cursor:"pointer"},title:S.size===d&&d>0?"Unselect all":"Select all across all pages"})}),(0,c.jsx)("th",{style:{width:"250px"},children:"Unit Name"}),(0,c.jsxs)("th",{style:{width:"150px",cursor:"pointer"},onClick:()=>$("unit_code"),children:["Unit Code ","unit_code"===N.col?"asc"===N.dir?"\u25b2":"\u25bc":""]}),(0,c.jsx)("th",{style:{width:"150px"},children:"Faculty"}),(0,c.jsxs)("th",{style:{width:"100px",cursor:"pointer"},onClick:()=>$("year"),children:["Year ","year"===N.col?"asc"===N.dir?"\u25b2":"\u25bc":""]}),(0,c.jsx)("th",{style:{width:"100px"},children:"Semester"}),(0,c.jsx)("th",{style:{width:"120px"},children:"Exam Type"}),(0,c.jsxs)("th",{style:{width:"80px",cursor:"pointer",background:"rgba(0, 168, 132, 0.1)",borderBottom:"2px solid #00a884"},onClick:()=>$("views_count"),children:["Views ","views_count"===N.col?"asc"===N.dir?"\u25b2":"\u25bc":""]}),(0,c.jsxs)("th",{style:{width:"100px",cursor:"pointer"},onClick:()=>$("downloads_count"),children:["Downloads ","downloads_count"===N.col?"asc"===N.dir?"\u25b2":"\u25bc":""]}),(0,c.jsxs)("th",{style:{width:"180px",cursor:"pointer"},onClick:()=>$("created_at"),children:["Uploaded ","created_at"===N.col?"asc"===N.dir?"\u25b2":"\u25bc":""]}),(0,c.jsx)("th",{style:{width:"150px"},children:"Uploaded By"}),(0,c.jsx)("th",{style:{width:"200px"},children:"Actions"})]})}),(0,c.jsx)("tbody",{children:a?(0,c.jsx)("tr",{children:(0,c.jsx)("td",{colSpan:W?13:12,style:{textAlign:"center",color:"#8696a0"},children:"Loading..."})}):0===n.length?(0,c.jsx)("tr",{children:(0,c.jsx)("td",{colSpan:W?13:12,style:{textAlign:"center",color:"#8696a0"},children:"No data"})}):n.map(e=>{var t,a,s;return(0,c.jsxs)("tr",{style:{background:S.has(e.id)?"rgba(0, 168, 132, 0.1)":"transparent"},children:[W&&(0,c.jsx)("td",{style:{textAlign:"center"},children:(0,c.jsx)("input",{type:"checkbox",checked:S.has(e.id),onChange:()=>{return t=e.id,void A(e=>{const a=new Set(e);return a.has(t)?a.delete(t):a.add(t),a});var t},disabled:I,style:{width:"16px",height:"16px",cursor:"pointer"}})}),(0,c.jsx)("td",{style:{color:e.unit_name?"#e9edef":"#8696a0"},children:C===e.id?(0,c.jsx)("input",{className:"input",value:P.unit_name,onChange:e=>L((0,i.A)((0,i.A)({},P),{},{unit_name:e.target.value}))}):e.unit_name||"\u2014"}),(0,c.jsx)("td",{style:{color:e.unit_code?"#e9edef":"#8696a0"},children:C===e.id?(0,c.jsx)("input",{className:"input",value:P.unit_code,onChange:e=>L((0,i.A)((0,i.A)({},P),{},{unit_code:e.target.value}))}):e.unit_code||"\u2014"}),(0,c.jsx)("td",{style:{color:e.faculty?"#e9edef":"#8696a0"},children:C===e.id?(0,c.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:[T?(0,c.jsx)("input",{className:"input",placeholder:"e.g., Engineering, Business",value:D,onChange:e=>M(e.target.value)}):(0,c.jsx)(c.Fragment,{children:(0,c.jsxs)("select",{className:"select",value:P.faculty,onChange:e=>L((0,i.A)((0,i.A)({},P),{},{faculty:e.target.value})),style:{marginBottom:"4px"},children:[(0,c.jsx)("option",{value:"",children:"Select Faculty"}),y&&y.length>0?y.map(e=>(0,c.jsx)("option",{value:e,children:e},e)):(0,c.jsx)("option",{value:"",children:"No faculties available"})]})}),(0,c.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"4px",fontSize:"11px"},children:[(0,c.jsx)("input",{type:"checkbox",id:"custom-faculty-".concat(e.id),checked:T,onChange:e=>{R(e.target.checked),e.target.checked||M("")},style:{width:"14px",height:"14px",cursor:"pointer"}}),(0,c.jsx)("label",{htmlFor:"custom-faculty-".concat(e.id),style:{color:"#8696a0",cursor:"pointer",fontSize:"11px"},children:"Add"})]})]}):e.faculty||"\u2014"}),(0,c.jsx)("td",{style:{color:e.year?"#e9edef":"#8696a0"},children:C===e.id?(0,c.jsx)("input",{className:"input",type:"number",value:P.year,onChange:e=>L((0,i.A)((0,i.A)({},P),{},{year:e.target.value}))}):e.year||"\u2014"}),(0,c.jsx)("td",{children:C===e.id?(0,c.jsxs)("select",{className:"select",value:P.semester,onChange:e=>L((0,i.A)((0,i.A)({},P),{},{semester:e.target.value})),children:[(0,c.jsx)("option",{value:"",children:"\u2014"}),(0,c.jsx)("option",{value:"1",children:"1"}),(0,c.jsx)("option",{value:"2",children:"2"}),(0,c.jsx)("option",{value:"3",children:"3"})]}):e.semester||"\u2014"}),(0,c.jsx)("td",{children:C===e.id?(0,c.jsxs)("select",{className:"select",value:P.exam_type,onChange:e=>L((0,i.A)((0,i.A)({},P),{},{exam_type:e.target.value})),children:[(0,c.jsx)("option",{value:"Main",children:"Main"}),(0,c.jsx)("option",{value:"Supplementary",children:"Supplementary"}),(0,c.jsx)("option",{value:"CAT",children:"CAT"}),(0,c.jsx)("option",{value:"Mock",children:"Mock"})]}):e.exam_type||"Main"}),(0,c.jsx)("td",{style:{fontWeight:"500",color:"#00a884"},children:e.views_count||0}),(0,c.jsx)("td",{children:e.downloads_count||0}),(0,c.jsx)("td",{style:{color:"#8696a0",fontSize:"12px"},children:m(e.created_at)}),(0,c.jsx)("td",{style:{color:null!==(t=e.profiles)&&void 0!==t&&t.full_name?"#e9edef":"#8696a0",fontSize:"13px"},children:(null===(a=e.profiles)||void 0===a?void 0:a.full_name)||(null===(s=e.profiles)||void 0===s?void 0:s.email)||"\u2014"}),(0,c.jsx)("td",{children:C===e.id?(0,c.jsxs)("div",{style:{display:"flex",gap:"4px",flexDirection:"column"},children:[(0,c.jsx)("button",{className:"btn primary",onClick:()=>(async e=>{if(!G())return void q({type:"error",message:"You do not have permission to edit this past paper."});const t=T?D:P.faculty;if(!t)return void q({type:"error",message:"Please select or enter a faculty."});const a=(0,i.A)((0,i.A)({},P),{},{faculty:t});try{await(0,h.MK)(e.id,{updates:a,newPdfFile:B,oldFilePath:e.file_path}),Q(),await X(),q({type:"success",message:"Past paper updated."})}catch(s){console.error("Failed to update past paper:",(null===s||void 0===s?void 0:s.message)||s),q({type:"error",message:(null===s||void 0===s?void 0:s.message)||"Failed to update past paper."})}})(e),children:"Save"}),(0,c.jsx)("button",{className:"btn",onClick:Q,children:"Cancel"})]}):(0,c.jsxs)("div",{className:"actions",children:[(0,c.jsx)("button",{className:"btn",onClick:()=>(e=>{G()?(_(e.id),L({faculty:e.faculty||"",unit_code:e.unit_code||"",unit_name:e.unit_name||"",year:e.year||"",semester:e.semester||"",exam_type:e.exam_type||""}),E(null),R(!1),M("")):q({type:"error",message:"You do not have permission to edit this past paper."})})(e),disabled:!G(),children:"Edit"}),(0,c.jsx)("button",{className:"btn",onClick:()=>(async e=>{if(!G())return void q({type:"error",message:"You can only delete past papers you uploaded."});if(await Y({title:"Delete past paper?",message:'Delete "'.concat(e.unit_code," - ").concat(e.unit_name,'"? This action cannot be undone.'),confirmLabel:"Delete",cancelLabel:"Cancel",variant:"danger"}))try{await(0,h.aw)({id:e.id,file_path:e.file_path}),await X(),q({type:"success",message:"Past paper deleted."})}catch(t){console.error("Failed to delete past paper:",t),q({type:"error",message:(null===t||void 0===t?void 0:t.message)||"Failed to delete past paper."})}})(e),disabled:!G(),children:"Delete"})]})})]},e.id)})})]})}),(0,c.jsxs)("div",{className:"actions",style:{marginTop:6},children:[(0,c.jsx)("button",{className:"btn",disabled:p<=1,onClick:()=>x(e=>Math.max(1,e-1)),children:"Prev"}),(0,c.jsxs)("span",{style:{color:"#cfd8dc"},children:["Page ",p," of ",K]}),(0,c.jsx)("button",{className:"btn",disabled:p>=K,onClick:()=>x(e=>Math.min(K,e+1)),children:"Next"})]})]})})};var v=a(6720),g=a(7488);async function j(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;try{const{data:t,error:a}=await g.N.from("author_engagement_stats").select("*").order("engagement_score",{ascending:!1}).limit(e);if(a)throw a;return t||[]}catch(t){return console.error("Error fetching all authors engagement stats:",t),[]}}const y=()=>{const[e,t]=(0,s.useState)(null),[a,l]=(0,s.useState)({}),[i,r]=(0,s.useState)(!0),[d,u]=(0,s.useState)(""),[h,p]=(0,s.useState)("engagement"),[m,x]=(0,s.useState)("monthly");(0,s.useEffect)(()=>{const e=async()=>{try{r(!0);const[e,a]=await Promise.all([(0,o.YK)(),j(100)]);t(e);const s={};a.forEach(e=>{s[e.author_name]=e}),l(s)}catch(e){console.error("Failed to load authors stats:",e)}finally{r(!1)}};e();const a=setInterval(e,3e4);return()=>clearInterval(a)},[]);const g=(0,s.useMemo)(()=>{if(!e||!e.authors)return[];let t=e.authors.filter(e=>e.name.toLowerCase().includes(d.toLowerCase()));return t.sort((e,t)=>{const s=a[e.name]||{},l=a[t.name]||{};switch(h){case"engagement":default:return(l.engagement_score||0)-(s.engagement_score||0);case"books":return t.bookCount-e.bookCount;case"downloads":return t.totalDownloads-e.totalDownloads;case"followers":return(l.followers_count||0)-(s.followers_count||0);case"likes":return(l.likes_count||0)-(s.likes_count||0);case"rating":return parseFloat(t.avgRating||0)-parseFloat(e.avgRating||0);case"name":return e.name.localeCompare(t.name)}}),t},[e,d,h,a]),y=(0,s.useMemo)(()=>{if(!e||!e.authors)return{totalAuthors:0,totalBooks:0,totalDL:0,avgRating:0,totalFollowers:0,totalLikes:0,totalLoves:0,totalComments:0};const t=e.authors.reduce((e,t)=>e+(t.bookCount||0),0),s=e.authors.reduce((e,t)=>e+(t.totalDownloads||0),0),l=e.authors.length>0?(e.authors.reduce((e,t)=>e+(parseFloat(t.avgRating)||0),0)/e.authors.length).toFixed(1):0,n=Object.values(a).reduce((e,t)=>e+(t.followers_count||0),0),i=Object.values(a).reduce((e,t)=>e+(t.likes_count||0),0),o=Object.values(a).reduce((e,t)=>e+(t.loves_count||0),0),r=Object.values(a).reduce((e,t)=>e+(t.comments_count||0),0);return{totalAuthors:e.authors.length,totalBooks:t,totalDL:s,avgRating:l,totalFollowers:n,totalLikes:i,totalLoves:o,totalComments:r}},[e,a]);return i?(0,c.jsx)("div",{className:"authors-page",children:(0,c.jsxs)("div",{className:"authors-loading",children:[(0,c.jsx)("div",{className:"authors-spinner"}),(0,c.jsx)("p",{children:"Loading authors data..."})]})}):(0,c.jsxs)("div",{className:"authors-page",children:[(0,c.jsx)("div",{className:"authors-header",children:(0,c.jsxs)("div",{className:"authors-title-section",children:[(0,c.jsxs)("h1",{className:"authors-title",children:[(0,c.jsx)(n.ARf,{})," Authors Analytics"]}),(0,c.jsx)("p",{className:"authors-subtitle",children:"Comprehensive author performance and engagement metrics"})]})}),(0,c.jsxs)("div",{className:"authors-stats-grid",children:[(0,c.jsxs)("div",{className:"authors-stat-card",children:[(0,c.jsx)("div",{className:"authors-stat-icon authors-stat-icon-1",children:(0,c.jsx)(n.H9b,{})}),(0,c.jsxs)("div",{className:"authors-stat-content",children:[(0,c.jsx)("div",{className:"authors-stat-label",children:"Total Authors"}),(0,c.jsx)("div",{className:"authors-stat-value",children:y.totalAuthors})]})]}),(0,c.jsxs)("div",{className:"authors-stat-card",children:[(0,c.jsx)("div",{className:"authors-stat-icon authors-stat-icon-2",children:(0,c.jsx)(n.H9b,{})}),(0,c.jsxs)("div",{className:"authors-stat-content",children:[(0,c.jsx)("div",{className:"authors-stat-label",children:"Total Books"}),(0,c.jsx)("div",{className:"authors-stat-value",children:y.totalBooks})]})]}),(0,c.jsxs)("div",{className:"authors-stat-card",children:[(0,c.jsx)("div",{className:"authors-stat-icon authors-stat-icon-3",children:(0,c.jsx)(n.a4x,{})}),(0,c.jsxs)("div",{className:"authors-stat-content",children:[(0,c.jsx)("div",{className:"authors-stat-label",children:"Total Downloads"}),(0,c.jsx)("div",{className:"authors-stat-value",children:y.totalDL.toLocaleString()})]})]}),(0,c.jsxs)("div",{className:"authors-stat-card",children:[(0,c.jsx)("div",{className:"authors-stat-icon authors-stat-icon-4",children:(0,c.jsx)(n.usP,{})}),(0,c.jsxs)("div",{className:"authors-stat-content",children:[(0,c.jsx)("div",{className:"authors-stat-label",children:"Avg Rating"}),(0,c.jsxs)("div",{className:"authors-stat-value",children:[y.avgRating,"\u2b50"]})]})]}),(0,c.jsxs)("div",{className:"authors-stat-card",children:[(0,c.jsx)("div",{className:"authors-stat-icon authors-stat-icon-5",children:(0,c.jsx)(n.cfS,{})}),(0,c.jsxs)("div",{className:"authors-stat-content",children:[(0,c.jsx)("div",{className:"authors-stat-label",children:"Total Followers"}),(0,c.jsx)("div",{className:"authors-stat-value",children:y.totalFollowers})]})]}),(0,c.jsxs)("div",{className:"authors-stat-card",children:[(0,c.jsx)("div",{className:"authors-stat-icon authors-stat-icon-6",children:(0,c.jsx)(v.Q81,{})}),(0,c.jsxs)("div",{className:"authors-stat-content",children:[(0,c.jsx)("div",{className:"authors-stat-label",children:"Total Likes"}),(0,c.jsx)("div",{className:"authors-stat-value",children:y.totalLikes})]})]}),(0,c.jsxs)("div",{className:"authors-stat-card",children:[(0,c.jsx)("div",{className:"authors-stat-icon authors-stat-icon-7",children:(0,c.jsx)(n.icx,{})}),(0,c.jsxs)("div",{className:"authors-stat-content",children:[(0,c.jsx)("div",{className:"authors-stat-label",children:"Total Loves"}),(0,c.jsx)("div",{className:"authors-stat-value",children:y.totalLoves})]})]}),(0,c.jsxs)("div",{className:"authors-stat-card",children:[(0,c.jsx)("div",{className:"authors-stat-icon authors-stat-icon-8",children:(0,c.jsx)(n.mEP,{})}),(0,c.jsxs)("div",{className:"authors-stat-content",children:[(0,c.jsx)("div",{className:"authors-stat-label",children:"Total Comments"}),(0,c.jsx)("div",{className:"authors-stat-value",children:y.totalComments})]})]})]}),(0,c.jsxs)("div",{className:"authors-controls",children:[(0,c.jsxs)("div",{className:"authors-control-group",children:[(0,c.jsx)("label",{className:"authors-label",children:"Search Author"}),(0,c.jsxs)("div",{className:"authors-search-wrapper",children:[(0,c.jsx)(n.CKj,{className:"authors-search-icon"}),(0,c.jsx)("input",{type:"text",placeholder:"Search by author name...",value:d,onChange:e=>u(e.target.value),className:"authors-search-input"})]})]}),(0,c.jsxs)("div",{className:"authors-control-group",children:[(0,c.jsx)("label",{className:"authors-label",children:"Sort By"}),(0,c.jsxs)("select",{value:h,onChange:e=>p(e.target.value),className:"authors-select",children:[(0,c.jsx)("option",{value:"engagement",children:"Engagement Score"}),(0,c.jsx)("option",{value:"followers",children:"Followers"}),(0,c.jsx)("option",{value:"likes",children:"Likes"}),(0,c.jsx)("option",{value:"books",children:"Books Count"}),(0,c.jsx)("option",{value:"downloads",children:"Downloads"}),(0,c.jsx)("option",{value:"rating",children:"Rating"}),(0,c.jsx)("option",{value:"name",children:"Name (A-Z)"})]})]})]}),(0,c.jsx)("div",{className:"authors-table-wrapper",children:(0,c.jsxs)("table",{className:"authors-table",children:[(0,c.jsx)("thead",{className:"authors-table-head",children:(0,c.jsxs)("tr",{children:[(0,c.jsx)("th",{className:"authors-table-header authors-rank-col",children:"Rank"}),(0,c.jsx)("th",{className:"authors-table-header authors-name-col",children:"Author Name"}),(0,c.jsx)("th",{className:"authors-table-header authors-num-col",children:"Books"}),(0,c.jsx)("th",{className:"authors-table-header authors-num-col",children:"Downloads"}),(0,c.jsx)("th",{className:"authors-table-header authors-num-col",children:"Followers"}),(0,c.jsx)("th",{className:"authors-table-header authors-num-col",children:"Likes"}),(0,c.jsx)("th",{className:"authors-table-header authors-num-col",children:"Loves"}),(0,c.jsx)("th",{className:"authors-table-header authors-num-col",children:"Rating"}),(0,c.jsx)("th",{className:"authors-table-header authors-num-col",children:"Score"})]})}),(0,c.jsx)("tbody",{className:"authors-table-body",children:g.length>0?g.map((e,t)=>{const s=a[e.name]||{},l=s.engagement_score||0,i=0===t?"\ud83e\udd47":1===t?"\ud83e\udd48":2===t?"\ud83e\udd49":"#".concat(t+1);return(0,c.jsxs)("tr",{className:"authors-table-row",children:[(0,c.jsx)("td",{className:"authors-table-cell authors-rank-col",children:(0,c.jsx)("span",{className:"authors-rank-badge",children:i})}),(0,c.jsx)("td",{className:"authors-table-cell authors-name-col",children:(0,c.jsx)("div",{className:"authors-author-name",children:"Unknown"===e.name?"\ud83d\udc64 Unknown Author":e.name})}),(0,c.jsx)("td",{className:"authors-table-cell authors-num-col",children:(0,c.jsx)("span",{className:"authors-metric-plain authors-books-count",children:e.bookCount})}),(0,c.jsx)("td",{className:"authors-table-cell authors-num-col",children:(0,c.jsx)("span",{className:"authors-metric-plain authors-downloads-count",children:e.totalDownloads})}),(0,c.jsx)("td",{className:"authors-table-cell authors-num-col",children:(0,c.jsx)("span",{className:"authors-metric-plain authors-followers-count",children:s.followers_count||0})}),(0,c.jsx)("td",{className:"authors-table-cell authors-num-col",children:(0,c.jsxs)("span",{className:"authors-metric-plain authors-likes-count",children:[(0,c.jsx)(n.Ydy,{className:"authors-metric-icon"}),s.likes_count||0]})}),(0,c.jsx)("td",{className:"authors-table-cell authors-num-col",children:(0,c.jsxs)("span",{className:"authors-metric-plain authors-loves-count",children:[(0,c.jsx)(n.icx,{className:"authors-metric-icon"}),s.loves_count||0]})}),(0,c.jsx)("td",{className:"authors-table-cell authors-num-col",children:(0,c.jsxs)("span",{className:"authors-rating-plain",children:[s.average_rating>0?s.average_rating.toFixed(1):"\u2014"," \u2b50"]})}),(0,c.jsx)("td",{className:"authors-table-cell authors-num-col",children:(0,c.jsx)("span",{className:"authors-score-plain",children:l.toFixed(2)})})]},e.id)}):(0,c.jsx)("tr",{className:"authors-table-row authors-empty-row",children:(0,c.jsxs)("td",{colSpan:"9",className:"authors-table-cell authors-empty-message",children:['No authors found matching "',d,'"']})})})]})}),(0,c.jsx)("div",{className:"authors-summary",children:(0,c.jsxs)("div",{className:"authors-summary-item",children:[(0,c.jsx)("span",{className:"authors-summary-label",children:"Showing"}),(0,c.jsxs)("span",{className:"authors-summary-value",children:[g.length," of ",y.totalAuthors]}),(0,c.jsx)("span",{className:"authors-summary-label",children:"authors"})]})})]})},b=e=>{let{userProfile:t}=e;const[a]=(0,l.ok)(),[i,o]=(0,s.useState)("books");return(0,s.useEffect)(()=>{const e=a.get("tab");o("pastpapers"===e?"pastpapers":"universities"===e?"universities":"authors"===e?"authors":"books")},[a]),s.useEffect(()=>{const e=document.createElement("style");return e.innerHTML="\n  .content-tabs {\n    display: flex;\n    gap: 4px;\n    margin-bottom: 8px;\n    border-bottom: 1px solid #374151;\n  }\n  .content-tab {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    padding: 6px 12px;\n    background: transparent;\n    border: none;\n    color: #8696a0;\n    cursor: pointer;\n    font-size: 14px;\n    font-weight: 500;\n    transition: all 0.3s ease;\n    border-bottom: 2px solid transparent;\n    margin-bottom: -1px;\n  }\n  .content-tab:hover {\n    color: #e9edef;\n    background: rgba(0, 168, 132, 0.05);\n  }\n  .content-tab.active {\n    color: #00a884;\n    border-bottom-color: #00a884;\n  }\n",document.head.appendChild(e),()=>e.remove()},[]),(0,c.jsxs)("div",{children:[(0,c.jsxs)("div",{className:"content-tabs",children:[(0,c.jsxs)("button",{className:"content-tab ".concat("books"===i?"active":""),onClick:()=>o("books"),children:[(0,c.jsx)(n.H9b,{size:20}),"Books"]}),(0,c.jsxs)("button",{className:"content-tab ".concat("universities"===i?"active":""),onClick:()=>o("universities"),children:[(0,c.jsx)(n.HzC,{size:20}),"Universities"]}),(0,c.jsxs)("button",{className:"content-tab ".concat("pastpapers"===i?"active":""),onClick:()=>o("pastpapers"),children:[(0,c.jsx)(n.jH2,{size:20}),"Past Papers"]}),(0,c.jsxs)("button",{className:"content-tab ".concat("authors"===i?"active":""),onClick:()=>o("authors"),children:[(0,c.jsx)(n.D1A,{size:20}),"Authors"]})]}),"books"===i&&(0,c.jsx)(d,{userProfile:t}),"universities"===i&&(0,c.jsx)(p,{userProfile:t}),"pastpapers"===i&&(0,c.jsx)(x,{userProfile:t}),"authors"===i&&(0,c.jsx)(y,{})]})}},1903:(e,t,a)=>{a.d(t,{Fn:()=>o,M9:()=>c,d$:()=>u,xH:()=>i,zd:()=>r});var s=a(7488),l=a(3488);const n=!0;async function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;try{let{data:i,error:o}=await s.N.rpc("search_university_names",{p_query:e,p_limit:t});if(o)throw o;if(null!==i&&void 0!==i&&i.length)return i;const r=await async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;try{const a="https://en.wikipedia.org/w/api.php?action=opensearch&search=".concat(encodeURIComponent(e+" university"),"&limit=").concat(t,"&namespace=0&format=json&origin=*"),s=await fetch(a);if(!s.ok)return[];const l=await s.json(),n=l[1]||[],i=l[2]||[],o=l[3]||[];return n.filter(e=>e.toLowerCase().includes("university")||e.toLowerCase().includes("college")).map((e,t)=>({name:e,description:i[t]||"",website_url:o[t]||""}))}catch(o){return console.error("Error searching Wikipedia:",o),[]}}(e,t);if(r.length>0)return await Promise.all(r.map(e=>d(e.name,e,"wikipedia"))),r;if(n)try{const a=await fetch("".concat(l.H,"/api/university/search?query=").concat(encodeURIComponent(e),"&limit=").concat(t));if(a.ok){const e=(await a.json()).universities||[];return e.length>0&&await Promise.all(e.map(e=>d(e.name,e,"google_proxy"))),e}}catch(a){console.warn("Backend proxy unavailable:",a.message)}return[]}catch(i){return console.error("Error searching university names:",i),[]}}async function o(e){try{var t,a,s;const l=(e||"").trim().replace(/\s+/g,"_");if(!l)return[];const n="https://commons.wikimedia.org/w/api.php?action=query&format=json&origin=*&prop=images&titles=".concat(encodeURIComponent(l)),i=await fetch(n);if(!i.ok)return[];const o=await i.json(),r=(null===(a=(null!==o&&void 0!==o&&null!==(t=o.query)&&void 0!==t&&t.pages?Object.values(o.query.pages):[])[0])||void 0===a?void 0:a.images)||[];if(!r.length)return[];const c=r.map(e=>null===e||void 0===e?void 0:e.title).filter(Boolean).slice(0,50).join("|");if(!c)return[];const d="https://commons.wikimedia.org/w/api.php?action=query&format=json&origin=*&prop=imageinfo&iiprop=url&titles=".concat(encodeURIComponent(c)),u=await fetch(d);if(!u.ok)return[];const h=await u.json(),p=(null!==h&&void 0!==h&&null!==(s=h.query)&&void 0!==s&&s.pages?Object.values(h.query.pages):[]).map(e=>{var t,a;return null===e||void 0===e||null===(t=e.imageinfo)||void 0===t||null===(a=t[0])||void 0===a?void 0:a.url}).filter(e=>"string"===typeof e&&/\.(jpg|jpeg|png|webp)$/i.test(e));return p.sort((e,t)=>{const a=e=>/logo|seal|coat_of_arms|emblem/i.test(e)?1:0;return a(e)-a(t)}).slice(0,5)}catch(l){return console.error("Error fetching Wikimedia images:",l),[]}}async function r(e){if(n)try{const a=await fetch("".concat(l.H,"/api/university/images?query=").concat(encodeURIComponent(e)));if(a.ok){var t;return(null===(t=(await a.json()).images)||void 0===t?void 0:t.map(e=>e.url))||[]}}catch(a){console.error("Error fetching Unsplash images via proxy:",a)}return[]}async function c(e,t){try{const a=await fetch(e);if(!a.ok)throw new Error("Failed to download image");const s=await a.blob();return new File([s],t,{type:s.type})}catch(a){return console.error("Error downloading image:",a),null}}async function d(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"manual";try{const{error:l}=await s.N.from("university_prefill_cache").upsert({university_name:e,data:t,source:a,updated_at:(new Date).toISOString()});if(l)throw l;return!0}catch(l){return console.error("Error caching prefill data:",l),!1}}async function u(e){try{let c=await async function(e){try{const{data:t,error:a}=await s.N.rpc("get_university_prefill_data",{p_university_name:e});if(a)throw a;return t}catch(t){return console.error("Error fetching prefill data:",t),null}}(e);if(c)return c;const u=await async function(e){try{var t;const a="https://en.wikipedia.org/api/rest_v1/page/summary/".concat(encodeURIComponent(e)),s=await fetch(a);if(!s.ok)return null;const l=await s.json();return{name:l.title||e,description:l.extract||"",website_url:"",location:"",established:null,student_count:null,cover_images:null!==(t=l.thumbnail)&&void 0!==t&&t.source?[l.thumbnail.source]:[]}}catch(a){return console.error("Error fetching from Wikipedia REST:",a),null}}(e),h=await async function(e){try{var t,a,s,l;const n='\n      SELECT ?item ?itemLabel ?locationLabel ?established ?studentCount ?website\n      WHERE {\n        ?item wdt:P31/wdt:P279* wd:Q3918;\n              rdfs:label ?itemLabel.\n        OPTIONAL { ?item wdt:P131 ?location. }\n        OPTIONAL { ?item wdt:P571 ?established. }\n        OPTIONAL { ?item wdt:P2196 ?studentCount. }\n        OPTIONAL { ?item wdt:P856 ?website. }\n        FILTER(CONTAINS(LCASE(?itemLabel), LCASE("'.concat(e,'")))\n        FILTER(LANG(?itemLabel) = "en")\n        SERVICE wikibase:label { bd:serviceParam wikibase:language "en". }\n      }\n      LIMIT 1\n    '),i="https://query.wikidata.org/sparql?query=".concat(encodeURIComponent(n),"&format=json"),o=await fetch(i);if(!o.ok)return null;const r=(await o.json()).results.bindings[0];return r?{name:r.itemLabel.value,description:"",website_url:(null===(t=r.website)||void 0===t?void 0:t.value)||"",location:(null===(a=r.locationLabel)||void 0===a?void 0:a.value)||"",established:null!==(s=r.established)&&void 0!==s&&s.value?new Date(r.established.value).getFullYear():null,student_count:(null===(l=r.studentCount)||void 0===l?void 0:l.value)||null,cover_images:[]}:null}catch(n){return console.error("Error fetching from Wikidata:",n),null}}(e);if(u||h){var t,a,i;c={name:null!==(t=(null===u||void 0===u?void 0:u.name)||(null===h||void 0===h?void 0:h.name)||e)&&void 0!==t?t:e,description:(null===u||void 0===u?void 0:u.description)||"",website_url:(null===h||void 0===h?void 0:h.website_url)||"",location:(null===h||void 0===h?void 0:h.location)||"",established:null!==(a=null===h||void 0===h?void 0:h.established)&&void 0!==a?a:null,student_count:null!==(i=null===h||void 0===h?void 0:h.student_count)&&void 0!==i?i:null,cover_images:(null===u||void 0===u?void 0:u.cover_images)||[]}}if(c||(c=await async function(e){if(n)try{const t=await fetch("".concat(l.H,"/api/university/details?name=").concat(encodeURIComponent(e)));if(t.ok){const a=await t.json();return{name:a.university.name||e,description:a.university.description||"",website_url:a.university.website_url||"",location:a.university.location||"",established:null,student_count:null,cover_images:a.university.image?[a.university.image]:[]}}}catch(t){console.error("Error fetching from Google via proxy:",t)}return null}(e)),c&&(!c.cover_images||0===c.cover_images.length)){const t=await o(c.name||e);if(t.length)c.cover_images=t;else{const t=await r(c.name||e);c.cover_images=t}}return c&&await d(e,c,"wikipedia_wikidata"),c||{name:e,description:"",website_url:"",location:"",established:null,student_count:null,cover_images:[]}}catch(c){return console.error("Error auto-filling university data:",c),{name:e,description:"",website_url:"",location:"",established:null,student_count:null,cover_images:[]}}}}}]);
//# sourceMappingURL=767.af8dba56.chunk.js.map