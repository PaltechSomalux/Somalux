"use strict";(self.webpackChunkcampuslife=self.webpackChunkcampuslife||[]).push([[365],{2365:(e,t,i)=>{i.r(t),i.d(t,{default:()=>d});var s=i(9379),a=i(5043),r=i(3515),o=i(9101),l=i(5200),n=i(7050),c=i(579);const d=e=>{let{userProfile:t}=e;const[i,d]=(0,a.useState)(!0),[u,p]=(0,a.useState)([]),[h,m]=(0,a.useState)(0),[x,b]=(0,a.useState)(1),[g]=(0,a.useState)(15),[j,y]=(0,a.useState)(""),[f,v]=(0,a.useState)(""),[_,C]=(0,a.useState)({}),[S,w]=(0,a.useState)({col:"created_at",dir:"desc"}),{confirm:P,showToast:z}=(0,o.v)(),A="admin"===(null===t||void 0===t?void 0:t.role)||["campuslives254@gmail.com","paltechsomalux@gmail.com"].includes(null===t||void 0===t?void 0:t.email),N=(0,a.useMemo)(()=>Math.max(1,Math.ceil(h/g)),[h,g]);(0,a.useEffect)(()=>{t&&(async()=>{d(!0);try{const[e,t]=await Promise.all([(0,r.WP)(),(0,r.Yj)()]),i=new Map((t||[]).map(e=>[String(e.uploaded_by),{total:"number"===typeof e.total?e.total:(e.books||0)+(e.past_papers||0)+(e.universities||0)}])),a=(e||[]).filter(e=>e&&e.id).map(e=>{const t=i.get(String(e.id))||{total:0};return(0,s.A)((0,s.A)({},e),{},{display_name:e.full_name||e.email,subscription_tier:e.subscription_tier||"basic",subscription_started_at:e.subscription_started_at,subscription_expires_at:e.subscription_expires_at,avatar_url:e.avatar_url,uploadCount:t.total||0})});console.log("[Verify.load] Loaded profiles:",a.length),p(a),m(a.length)}catch(e){console.error("Failed to load profiles:",e),z({type:"error",message:"Failed to load users."})}finally{d(!1)}})()},[t]);const k=(0,a.useMemo)(()=>u.filter(e=>{const t=!j||e.email&&e.email.toLowerCase().includes(j.toLowerCase())||e.display_name&&e.display_name.toLowerCase().includes(j.toLowerCase()),i=!f||e.subscription_tier===f;return t&&i}),[u,j,f]),L=(0,a.useMemo)(()=>{const e=(x-1)*g;return k.slice(e,e+g)},[k,x,g]);return A?i?(0,c.jsx)("div",{style:{padding:20,color:"#8696a0"},children:"Loading..."}):(0,c.jsxs)("div",{style:{padding:12},children:[(0,c.jsxs)("div",{className:"section-header",style:{marginBottom:16},children:[(0,c.jsx)("h2",{style:{color:"#e9edef",fontSize:18,margin:0},children:"Verify Users"}),(0,c.jsx)("p",{style:{color:"#8696a0",fontSize:12,margin:"4px 0 0 0"},children:"Manage user subscription tiers and verification status"})]}),(0,c.jsxs)("div",{style:{display:"flex",gap:8,marginBottom:12,flexWrap:"wrap"},children:[(0,c.jsxs)("div",{style:{flex:1,minWidth:200,position:"relative"},children:[(0,c.jsx)(l.CKj,{style:{position:"absolute",left:8,top:8,color:"#8696a0"}}),(0,c.jsx)("input",{type:"text",placeholder:"Search by name or email...",value:j,onChange:e=>y(e.target.value),className:"input",style:{paddingLeft:32,width:"100%",backgroundColor:"black",color:"white",fontSize:"13px"}})]}),(0,c.jsxs)("select",{className:"select",value:f,onChange:e=>v(e.target.value),style:{minWidth:150,width:"auto"},children:[(0,c.jsx)("option",{value:"",children:"All Tiers"}),(0,c.jsx)("option",{value:"basic",children:"Basic"}),(0,c.jsx)("option",{value:"premium",children:"Premium"}),(0,c.jsx)("option",{value:"premium_pro",children:"Premium Pro"})]})]}),(0,c.jsx)("div",{style:{overflowX:"auto"},children:(0,c.jsxs)("table",{className:"table",children:[(0,c.jsx)("thead",{children:(0,c.jsxs)("tr",{children:[(0,c.jsx)("th",{children:"#"}),(0,c.jsx)("th",{children:"Name"}),(0,c.jsx)("th",{children:"Email"}),(0,c.jsx)("th",{children:"Uploads"}),(0,c.jsx)("th",{children:"Current Tier"}),(0,c.jsx)("th",{children:"Subscription Date"}),(0,c.jsx)("th",{children:"Change Tier To"})]})}),(0,c.jsx)("tbody",{children:0===L.length?(0,c.jsx)("tr",{children:(0,c.jsx)("td",{colSpan:6,style:{textAlign:"center",color:"#8696a0",padding:20},children:"No users found"})}):L.map((e,t)=>{const i=(x-1)*g+t+1,a=(e=>{switch(e){case"premium":return{icon:(0,c.jsx)(l.YrT,{}),color:"#2196F3",label:"Premium",bgColor:"rgba(33, 150, 243, 0.1)"};case"premium_pro":return{icon:(0,c.jsx)(l.TPq,{}),color:"#FFD700",label:"Premium Pro",bgColor:"rgba(255, 215, 0, 0.1)"};default:return{icon:(0,c.jsx)(l.usP,{}),color:"#8696a0",label:"Basic",bgColor:"rgba(134, 150, 160, 0.05)"}}})(e.subscription_tier);return(0,c.jsxs)("tr",{children:[(0,c.jsxs)("td",{style:{fontSize:"13px",fontWeight:"600",color:"#00a884"},children:["#",i]}),(0,c.jsx)("td",{children:(0,c.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,c.jsxs)("div",{style:{position:"relative"},className:"viewer-avatar",children:[e.avatar_url?(0,c.jsx)("img",{src:e.avatar_url,alt:e.display_name||e.email||"User avatar",style:{width:"100%",height:"100%",borderRadius:"50%",objectFit:"cover"},onError:e=>{e.target.style.display="none"}}):(e.display_name||e.email||"?").charAt(0).toUpperCase(),e.uploadCount>0&&(0,c.jsx)("div",{style:{position:"absolute",bottom:-4,right:-4,backgroundColor:"#00a884",color:"white",borderRadius:"50%",width:20,height:20,display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,fontWeight:"bold",border:"2px solid #0a1419"},children:e.uploadCount>99?"99+":e.uploadCount}),("premium"===e.subscription_tier||"premium_pro"===e.subscription_tier)&&(0,c.jsx)("div",{style:{position:"absolute",top:-6,right:-6,zIndex:2},children:(0,c.jsx)(n.A,{tier:e.subscription_tier,size:"sm",showLabel:!1,showTooltip:!0})})]}),(0,c.jsx)("span",{children:e.display_name||"\u2014"})]})}),(0,c.jsx)("td",{style:{fontSize:12,color:"#8696a0"},children:e.email}),(0,c.jsx)("td",{style:{fontSize:12,fontWeight:"600",color:"#00a884"},children:e.uploadCount}),(0,c.jsx)("td",{children:(0,c.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6,padding:"4px 8px",borderRadius:4,backgroundColor:a.bgColor,width:"fit-content"},children:[(0,c.jsx)("span",{style:{color:a.color,fontSize:14},children:a.icon}),(0,c.jsx)("span",{style:{color:a.color,fontSize:12,fontWeight:500},children:a.label})]})}),(0,c.jsx)("td",{style:{fontSize:12,color:"#8696a0"},children:e.subscription_started_at?new Date(e.subscription_started_at).toLocaleDateString():"\u2014"}),(0,c.jsx)("td",{children:(0,c.jsxs)("select",{value:e.subscription_tier,onChange:t=>(async(e,t)=>{C(t=>(0,s.A)((0,s.A)({},t),{},{[e]:!0}));try{const i=await(0,r.pP)(e,t);p(a=>a.map(a=>{var r,o;return a.id===e?(0,s.A)((0,s.A)({},a),{},{subscription_tier:(null===(r=i.data)||void 0===r?void 0:r.subscription_tier)||t,subscription_started_at:(null===(o=i.data)||void 0===o?void 0:o.subscription_started_at)||(new Date).toISOString()}):a})),z({type:"success",message:"User tier updated to ".concat(t)})}catch(i){console.error("Failed to update tier:",i),z({type:"error",message:"Failed to update user tier."})}finally{C(t=>(0,s.A)((0,s.A)({},t),{},{[e]:!1}))}})(e.id,t.target.value),disabled:_[e.id],className:"select",style:{fontSize:12},children:[(0,c.jsx)("option",{value:"basic",children:"Basic"}),(0,c.jsx)("option",{value:"premium",children:"Premium"}),(0,c.jsx)("option",{value:"premium_pro",children:"Premium Pro"})]})})]},e.id)})})]})}),(0,c.jsxs)("div",{className:"actions",style:{marginTop:10,justifyContent:"space-between"},children:[(0,c.jsx)("button",{className:"btn",disabled:x<=1,onClick:()=>b(e=>Math.max(1,e-1)),children:"Prev"}),(0,c.jsxs)("span",{style:{color:"#cfd8dc"},children:["Page ",x," of ",N," (",k.length," users)"]}),(0,c.jsx)("button",{className:"btn",disabled:x>=N,onClick:()=>b(e=>Math.min(N,e+1)),children:"Next"})]})]}):(0,c.jsx)("div",{style:{padding:20,color:"#e9edef"},children:"You don't have permission to access this page."})}}}]);
//# sourceMappingURL=365.8665ed82.chunk.js.map