"use strict";(self.webpackChunkcampuslife=self.webpackChunkcampuslife||[]).push([[173],{1903:(e,a,t)=>{t.d(a,{Fn:()=>r,M9:()=>c,d$:()=>u,xH:()=>l,zd:()=>o});var n=t(7488),i=t(3488);const s=!0;async function l(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;try{let{data:l,error:r}=await n.N.rpc("search_university_names",{p_query:e,p_limit:a});if(r)throw r;if(null!==l&&void 0!==l&&l.length)return l;const o=await async function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;try{const t="https://en.wikipedia.org/w/api.php?action=opensearch&search=".concat(encodeURIComponent(e+" university"),"&limit=").concat(a,"&namespace=0&format=json&origin=*"),n=await fetch(t);if(!n.ok)return[];const i=await n.json(),s=i[1]||[],l=i[2]||[],r=i[3]||[];return s.filter(e=>e.toLowerCase().includes("university")||e.toLowerCase().includes("college")).map((e,a)=>({name:e,description:l[a]||"",website_url:r[a]||""}))}catch(r){return console.error("Error searching Wikipedia:",r),[]}}(e,a);if(o.length>0)return await Promise.all(o.map(e=>d(e.name,e,"wikipedia"))),o;if(s)try{const t=await fetch("".concat(i.H,"/api/university/search?query=").concat(encodeURIComponent(e),"&limit=").concat(a));if(t.ok){const e=(await t.json()).universities||[];return e.length>0&&await Promise.all(e.map(e=>d(e.name,e,"google_proxy"))),e}}catch(t){console.warn("Backend proxy unavailable:",t.message)}return[]}catch(l){return console.error("Error searching university names:",l),[]}}async function r(e){try{var a,t,n;const i=(e||"").trim().replace(/\s+/g,"_");if(!i)return[];const s="https://commons.wikimedia.org/w/api.php?action=query&format=json&origin=*&prop=images&titles=".concat(encodeURIComponent(i)),l=await fetch(s);if(!l.ok)return[];const r=await l.json(),o=(null===(t=(null!==r&&void 0!==r&&null!==(a=r.query)&&void 0!==a&&a.pages?Object.values(r.query.pages):[])[0])||void 0===t?void 0:t.images)||[];if(!o.length)return[];const c=o.map(e=>null===e||void 0===e?void 0:e.title).filter(Boolean).slice(0,50).join("|");if(!c)return[];const d="https://commons.wikimedia.org/w/api.php?action=query&format=json&origin=*&prop=imageinfo&iiprop=url&titles=".concat(encodeURIComponent(c)),u=await fetch(d);if(!u.ok)return[];const p=await u.json(),m=(null!==p&&void 0!==p&&null!==(n=p.query)&&void 0!==n&&n.pages?Object.values(p.query.pages):[]).map(e=>{var a,t;return null===e||void 0===e||null===(a=e.imageinfo)||void 0===a||null===(t=a[0])||void 0===t?void 0:t.url}).filter(e=>"string"===typeof e&&/\.(jpg|jpeg|png|webp)$/i.test(e));return m.sort((e,a)=>{const t=e=>/logo|seal|coat_of_arms|emblem/i.test(e)?1:0;return t(e)-t(a)}).slice(0,5)}catch(i){return console.error("Error fetching Wikimedia images:",i),[]}}async function o(e){if(s)try{const t=await fetch("".concat(i.H,"/api/university/images?query=").concat(encodeURIComponent(e)));if(t.ok){var a;return(null===(a=(await t.json()).images)||void 0===a?void 0:a.map(e=>e.url))||[]}}catch(t){console.error("Error fetching Unsplash images via proxy:",t)}return[]}async function c(e,a){try{const t=await fetch(e);if(!t.ok)throw new Error("Failed to download image");const n=await t.blob();return new File([n],a,{type:n.type})}catch(t){return console.error("Error downloading image:",t),null}}async function d(e,a){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"manual";try{const{error:i}=await n.N.from("university_prefill_cache").upsert({university_name:e,data:a,source:t,updated_at:(new Date).toISOString()});if(i)throw i;return!0}catch(i){return console.error("Error caching prefill data:",i),!1}}async function u(e){try{let c=await async function(e){try{const{data:a,error:t}=await n.N.rpc("get_university_prefill_data",{p_university_name:e});if(t)throw t;return a}catch(a){return console.error("Error fetching prefill data:",a),null}}(e);if(c)return c;const u=await async function(e){try{var a;const t="https://en.wikipedia.org/api/rest_v1/page/summary/".concat(encodeURIComponent(e)),n=await fetch(t);if(!n.ok)return null;const i=await n.json();return{name:i.title||e,description:i.extract||"",website_url:"",location:"",established:null,student_count:null,cover_images:null!==(a=i.thumbnail)&&void 0!==a&&a.source?[i.thumbnail.source]:[]}}catch(t){return console.error("Error fetching from Wikipedia REST:",t),null}}(e),p=await async function(e){try{var a,t,n,i;const s='\n      SELECT ?item ?itemLabel ?locationLabel ?established ?studentCount ?website\n      WHERE {\n        ?item wdt:P31/wdt:P279* wd:Q3918;\n              rdfs:label ?itemLabel.\n        OPTIONAL { ?item wdt:P131 ?location. }\n        OPTIONAL { ?item wdt:P571 ?established. }\n        OPTIONAL { ?item wdt:P2196 ?studentCount. }\n        OPTIONAL { ?item wdt:P856 ?website. }\n        FILTER(CONTAINS(LCASE(?itemLabel), LCASE("'.concat(e,'")))\n        FILTER(LANG(?itemLabel) = "en")\n        SERVICE wikibase:label { bd:serviceParam wikibase:language "en". }\n      }\n      LIMIT 1\n    '),l="https://query.wikidata.org/sparql?query=".concat(encodeURIComponent(s),"&format=json"),r=await fetch(l);if(!r.ok)return null;const o=(await r.json()).results.bindings[0];return o?{name:o.itemLabel.value,description:"",website_url:(null===(a=o.website)||void 0===a?void 0:a.value)||"",location:(null===(t=o.locationLabel)||void 0===t?void 0:t.value)||"",established:null!==(n=o.established)&&void 0!==n&&n.value?new Date(o.established.value).getFullYear():null,student_count:(null===(i=o.studentCount)||void 0===i?void 0:i.value)||null,cover_images:[]}:null}catch(s){return console.error("Error fetching from Wikidata:",s),null}}(e);if(u||p){var a,t,l;c={name:null!==(a=(null===u||void 0===u?void 0:u.name)||(null===p||void 0===p?void 0:p.name)||e)&&void 0!==a?a:e,description:(null===u||void 0===u?void 0:u.description)||"",website_url:(null===p||void 0===p?void 0:p.website_url)||"",location:(null===p||void 0===p?void 0:p.location)||"",established:null!==(t=null===p||void 0===p?void 0:p.established)&&void 0!==t?t:null,student_count:null!==(l=null===p||void 0===p?void 0:p.student_count)&&void 0!==l?l:null,cover_images:(null===u||void 0===u?void 0:u.cover_images)||[]}}if(c||(c=await async function(e){if(s)try{const a=await fetch("".concat(i.H,"/api/university/details?name=").concat(encodeURIComponent(e)));if(a.ok){const t=await a.json();return{name:t.university.name||e,description:t.university.description||"",website_url:t.university.website_url||"",location:t.university.location||"",established:null,student_count:null,cover_images:t.university.image?[t.university.image]:[]}}}catch(a){console.error("Error fetching from Google via proxy:",a)}return null}(e)),c&&(!c.cover_images||0===c.cover_images.length)){const a=await r(c.name||e);if(a.length)c.cover_images=a;else{const a=await o(c.name||e);c.cover_images=a}}return c&&await d(e,c,"wikipedia_wikidata"),c||{name:e,description:"",website_url:"",location:"",established:null,student_count:null,cover_images:[]}}catch(c){return console.error("Error auto-filling university data:",c),{name:e,description:"",website_url:"",location:"",established:null,student_count:null,cover_images:[]}}}},9935:(e,a,t)=>{t.r(a),t.d(a,{default:()=>g});var n=t(9379),i=t(5043),s=t(4218),l=t(3515),r=t(4972),o=t(9738),c=t(1903),d=t(5200),u=t(9101),p=t(7397),m=t(579);const g=e=>{let{userProfile:a,initialTab:t="books"}=e;(0,i.useEffect)(()=>{const e=document.createElement("style");return e.innerHTML="\n  .dropzone {\n    border: 2px dashed #374151;\n    border-radius: 8px;\n    padding: 20px;\n    text-align: center;\n    cursor: pointer;\n    transition: all 0.3s ease;\n  }\n  .dropzone:hover {\n    border-color: #00a884;\n    background: rgba(0, 168, 132, 0.05);\n  }\n  .dropzone.drag-over {\n    border-color: #00a884;\n    background: rgba(0, 168, 132, 0.1);\n  }\n  .upload-tabs {\n    display: flex;\n    gap: 8px;\n    margin-bottom: 20px;\n    border-bottom: 2px solid #374151;\n  }\n  .upload-tab {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 12px 24px;\n    background: transparent;\n    border: none;\n    color: #8696a0;\n    cursor: pointer;\n    font-size: 16px;\n    font-weight: 500;\n    transition: all 0.3s ease;\n    border-bottom: 3px solid transparent;\n    margin-bottom: -2px;\n  }\n  .upload-tab:hover {\n    color: #e9edef;\n    background: rgba(0, 168, 132, 0.05);\n  }\n  .upload-tab.active {\n    color: #00a884;\n    border-bottom-color: #00a884;\n  }\n  @keyframes spin {\n    from { transform: rotate(0deg); }\n    to { transform: rotate(360deg); }\n  }\n  .spin {\n    animation: spin 1s linear infinite;\n  }\n",document.head.appendChild(e),()=>e.remove()},[]);const[g,h]=(0,i.useState)(t),v=(0,s.Zp)(),{showToast:y}=(0,u.v)();(0,i.useEffect)(()=>{h(t)},[t]);const[x,b]=(0,i.useState)(null),[f,j]=(0,i.useState)(null),[w,_]=(0,i.useState)([]),[N,C]=(0,i.useState)({title:"",author:"",description:"",category_id:"",year:"",language:"",isbn:"",pages:"",publisher:""}),[k,S]=(0,i.useState)([]),[P,T]=(0,i.useState)({name:"",description:"",website_url:"",location:"",established:"",student_count:""}),[E,A]=(0,i.useState)(""),[F,U]=(0,i.useState)([]),[I,L]=(0,i.useState)(!1),[R,z]=(0,i.useState)(!1),[B,D]=(0,i.useState)(null),[O,H]=(0,i.useState)([]),[M,q]=(0,i.useState)([]),[Y,W]=(0,i.useState)([]),[G,J]=(0,i.useState)([]),[Q,$]=(0,i.useState)({university_id:"",faculty:"",unit_code:"",unit_name:"",year:"",semester:"",exam_type:""}),[Z,K]=(0,i.useState)(!1),[V,X]=(0,i.useState)(""),[ee,ae]=(0,i.useState)(!1),[te,ne]=(0,i.useState)(""),[ie,se]=(0,i.useState)(!1),[le,re]=(0,i.useState)(""),[oe,ce]=(0,i.useState)(null),[de,ue]=(0,i.useState)(!1),[pe,me]=(0,i.useState)(!1);(0,i.useEffect)(()=>{(async()=>{try{_(await(0,l.jE)()),H(await(0,o.Hk)())}catch(e){}})()},[]),(0,i.useEffect)(()=>{if(!x)return;(async()=>{me(!0);try{p.EA.workerSrc||(p.EA.workerSrc="/pdf.worker.min.mjs");const a=await x.arrayBuffer();await new Promise(e=>setTimeout(e,100));const t=await p.YE({data:a}).promise;if(t&&t.numPages>0)try{const e=await t.getPage(1),a=e.getViewport({scale:2}),n=document.createElement("canvas");n.width=a.width,n.height=a.height;const i=n.getContext("2d");i&&(await e.render({canvasContext:i,viewport:a}).promise,n.toBlob(e=>{if(e){const a=new File([e],"".concat(x.name.replace(".pdf",""),"_cover.png"),{type:"image/png"});j(a),y({type:"success",message:"Cover image extracted from PDF!"})}},"image/png",.95))}catch(e){console.warn("Could not render PDF page:",e),y({type:"info",message:"Could not auto-extract cover. You can upload one manually."})}}catch(a){console.error("Error extracting cover from PDF:",a),y({type:"info",message:"Could not auto-extract cover. You can upload one manually."})}finally{me(!1)}})()},[x,y]);const ge=e=>a=>C(t=>(0,n.A)((0,n.A)({},t),{},{[e]:a.target.value})),he=e=>a=>{T(t=>(0,n.A)((0,n.A)({},t),{},{[e]:a.target.value})),"name"===e&&(A(a.target.value),ve(a.target.value))},ve=function(e,a){const t=(0,i.useRef)(null);return(0,i.useCallback)(function(){for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];t.current&&clearTimeout(t.current),t.current=setTimeout(()=>e(...i),a)},[e,a])}(async e=>{if(e.length<2)return U([]),void L(!1);try{const a=await(0,c.xH)(e);U(a),L(a.length>0)}catch(a){console.error("Error searching:",a)}},300),ye=async e=>{z(!0),L(!1);try{const i=await(0,c.d$)(e||P.name);var a,t;if(i)if(T({name:i.name||"",description:i.description||"",website_url:i.website_url||"",location:i.location||"",established:(null===(a=i.established)||void 0===a?void 0:a.toString())||"",student_count:(null===(t=i.student_count)||void 0===t?void 0:t.toString())||""}),i.cover_images&&i.cover_images.length>0){const e=[];for(let a=0;a<Math.min(i.cover_images.length,5);a++){const t=i.cover_images[a],s="".concat(i.name.replace(/\s+/g,"_"),"_image_").concat(a+1,".jpg");try{const a=await(0,c.M9)(t,s);a&&e.push(a)}catch(n){console.error("Error downloading image:",n)}}e.length>0?(S(e),y({type:"success",message:"Auto-filled data for ".concat(i.name," with ").concat(e.length," image(s)!")})):y({type:"info",message:"Auto-filled data for ".concat(i.name,"! But images could not be downloaded, please upload manually.")})}else{let e=await(0,c.Fn)(i.name);if(e.length||(e=await(0,c.zd)(i.name)),e.length>0){const a=[];for(let t=0;t<e.length;t++)try{const n="".concat(i.name.replace(/\s+/g,"_"),"_auto_").concat(t+1,".jpg"),s=await(0,c.M9)(e[t],n);s&&a.push(s)}catch(n){console.error("Auto image download error:",n)}a.length>0?(S(a),y({type:"success",message:"Auto-filled data for ".concat(i.name," with ").concat(a.length," image(s)!")})):y({type:"info",message:"Auto-filled data for ".concat(i.name,", but images couldn't be downloaded.")})}else y({type:"info",message:"Auto-filled data for ".concat(i.name,", but no images were found automatically.")})}else y({type:"info",message:"No data found for this university. Please enter details manually."})}catch(i){console.error("Error auto-filling:",i),y({type:"error",message:"Failed to auto-fill data. Please try again."})}finally{z(!1)}},xe=e=>async a=>{const t=a.target.value;if($(a=>(0,n.A)((0,n.A)({},a),{},{[e]:t})),"university_id"===e&&t)try{const e=await(0,o.cv)(t);q(e),$(e=>(0,n.A)((0,n.A)({},e),{},{faculty:"",unit_name:"",year:""})),W([]),J([])}catch(i){console.error("Error fetching faculties:",i),q([])}if("faculty"===e&&t&&Q.university_id)try{const e=await(0,o.NY)(Q.university_id,t);W(e),$(e=>(0,n.A)((0,n.A)({},e),{},{unit_name:"",year:""})),J([])}catch(i){console.error("Error fetching unit names:",i),W([])}if("unit_name"===e&&t&&Q.university_id&&Q.faculty)try{const e=await(0,o.gi)(Q.university_id,Q.faculty,t);J(e),$(e=>(0,n.A)((0,n.A)({},e),{},{year:""}))}catch(i){console.error("Error fetching years:",i),J([])}},be=(e,a,t,n,i)=>(0,m.jsxs)("div",{className:"dropzone",onDragOver:e=>{e.preventDefault(),e.currentTarget.classList.add("drag-over")},onDragLeave:e=>{e.preventDefault(),e.currentTarget.classList.remove("drag-over")},onDrop:e=>{e.preventDefault(),e.currentTarget.classList.remove("drag-over");const n=e.dataTransfer.files[0];n&&n.type.match(t)&&a(n)},onClick:()=>document.getElementById("".concat(n,"-input")).click(),style:{border:"2px dashed #374151",borderRadius:"8px",padding:"20px",textAlign:"center",cursor:"pointer",background:e?"rgba(0, 168, 132, 0.1)":"transparent",transition:"all 0.3s ease"},children:[(0,m.jsx)("input",{id:"".concat(n,"-input"),type:"file",accept:t,onChange:e=>{var t;return a((null===(t=e.target.files)||void 0===t?void 0:t[0])||null)},style:{display:"none"}}),e?(0,m.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"10px",color:"#00a884"},children:[i,(0,m.jsx)("span",{children:e.name})]}):(0,m.jsxs)("div",{children:[(0,m.jsx)(d.B88,{size:20,style:{marginBottom:"4px",color:"#8696a0"}}),(0,m.jsx)("div",{style:{color:"#e9edef"},children:"Drag and drop or click to browse"}),(0,m.jsx)("div",{style:{color:"#8696a0",fontSize:"0.85em",marginTop:"2px"},children:"application/pdf"===t?"PDF files only":"Image files (JPG, PNG, GIF)"})]})]});return(0,m.jsxs)("div",{className:"panel",children:[(0,m.jsx)("div",{className:"panel-title",children:"Upload Content"}),(0,m.jsxs)("div",{className:"upload-tabs",children:[(0,m.jsxs)("button",{className:"upload-tab ".concat("books"===g?"active":""),onClick:()=>h("books"),children:[(0,m.jsx)(d.H9b,{size:20}),"Books"]}),(0,m.jsxs)("button",{className:"upload-tab ".concat("campus"===g?"active":""),onClick:()=>h("campus"),children:[(0,m.jsx)(d.HzC,{size:20}),"Campus"]}),(0,m.jsxs)("button",{className:"upload-tab ".concat("pastpapers"===g?"active":""),onClick:()=>h("pastpapers"),children:[(0,m.jsx)(d.jH2,{size:20}),"Past Papers"]})]}),"books"===g&&(0,m.jsxs)("div",{className:"grid-2",children:[(0,m.jsxs)("div",{className:"panel",children:[(0,m.jsx)("label",{className:"label",children:"PDF File"}),be(x,b,"application/pdf","pdf",(0,m.jsx)(d.QuH,{size:24})),(0,m.jsxs)("label",{className:"label",style:{marginTop:20},children:["Cover Image (optional)",pe&&(0,m.jsx)("span",{style:{marginLeft:"8px",color:"#00a884",fontSize:"0.9em"},children:"(Extracting...)"})]}),be(f,j,"image/*","cover",(0,m.jsx)(d.fZZ,{size:24}))]}),(0,m.jsxs)("div",{className:"panel",children:[(0,m.jsx)("label",{className:"label",children:"Title"}),(0,m.jsx)("input",{className:"input",placeholder:"Book title",value:N.title,onChange:ge("title")}),(0,m.jsx)("label",{className:"label",style:{marginTop:10},children:"Author"}),(0,m.jsx)("input",{className:"input",placeholder:"Author",value:N.author,onChange:ge("author")}),(0,m.jsx)("label",{className:"label",style:{marginTop:10},children:"Description"}),(0,m.jsx)("textarea",{className:"input",rows:5,placeholder:"Short description",value:N.description,onChange:ge("description")}),(0,m.jsxs)("div",{className:"grid-2",style:{marginTop:10},children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"label",children:"Category"}),(0,m.jsxs)("select",{className:"select",value:N.category_id,onChange:ge("category_id"),children:[(0,m.jsx)("option",{value:"",children:"Uncategorized"}),w.map(e=>(0,m.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"label",children:"Year"}),(0,m.jsx)("input",{className:"input",placeholder:"Year",value:N.year,onChange:ge("year")})]})]}),(0,m.jsxs)("div",{className:"grid-2",style:{marginTop:10},children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"label",children:"Language"}),(0,m.jsx)("input",{className:"input",placeholder:"English",value:N.language,onChange:ge("language")})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"label",children:"ISBN"}),(0,m.jsx)("input",{className:"input",placeholder:"978-0-123456-78-9",value:N.isbn,onChange:ge("isbn")})]})]}),(0,m.jsxs)("div",{className:"grid-2",style:{marginTop:10},children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"label",children:"Pages"}),(0,m.jsx)("input",{className:"input",type:"number",placeholder:"Number of pages",value:N.pages,onChange:ge("pages")})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"label",children:"Publisher"}),(0,m.jsx)("input",{className:"input",placeholder:"Publisher name",value:N.publisher,onChange:ge("publisher")})]})]}),(0,m.jsx)("div",{className:"actions",style:{marginTop:12},children:(0,m.jsx)("button",{className:"btn primary",disabled:de,onClick:async()=>{if(x){ue(!0);try{var e;const t={title:N.title||(null===x||void 0===x||null===(e=x.name)||void 0===e?void 0:e.replace(/\.[^/.]+$/,""))||"",author:N.author||"Unknown",description:N.description||"",category_id:N.category_id||null,year:N.year?Number(N.year):null,language:N.language||"",isbn:N.isbn||"",pages:N.pages?Number(N.pages):0,publisher:N.publisher||"",uploaded_by:(null===a||void 0===a?void 0:a.id)||null};"admin"===(null===a||void 0===a?void 0:a.role)||"editor"===(null===a||void 0===a?void 0:a.role)?(await(0,l.iC)({metadata:t,pdfFile:x,coverFile:f}),y({type:"success",message:"Book uploaded successfully!"})):(await(0,l.WI)({metadata:t,pdfFile:x,coverFile:f}),y({type:"success",message:"Book submitted for approval. Admin will review it shortly."})),b(null),j(null),C({title:"",author:"",description:"",category_id:"",year:"",language:"",isbn:"",pages:"",publisher:""}),v("/user/upload")}catch(t){console.error("Book upload failed:",t),y({type:"error",message:(null===t||void 0===t?void 0:t.message)||"Upload failed."})}finally{ue(!1)}}else y({type:"error",message:"Please choose a PDF file."})},children:de?"Uploading...":"Upload Book"})})]})]}),"campus"===g&&(0,m.jsxs)("div",{className:"grid-2",children:[(0,m.jsxs)("div",{className:"panel",children:[(0,m.jsx)("label",{className:"label",children:"University Cover Images (Multiple)"}),(0,m.jsx)("input",{type:"file",accept:"image/*",multiple:!0,onChange:e=>S(Array.from(e.target.files)),style:{marginBottom:"10px"},className:"input"}),k.length>0&&(0,m.jsxs)("div",{style:{marginTop:"10px",color:"#00a884"},children:["\u2713 ",k.length," image(s) selected",(0,m.jsxs)("button",{onClick:()=>S([]),style:{marginLeft:"10px",color:"#dc2626",background:"none",border:"none",cursor:"pointer"},children:[(0,m.jsx)(d.yGN,{})," Clear"]})]}),(0,m.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"4px",marginTop:"6px"},children:k.map((e,a)=>(0,m.jsxs)("div",{style:{position:"relative",border:"2px solid #374151",borderRadius:"8px",overflow:"hidden"},children:[(0,m.jsx)("img",{src:URL.createObjectURL(e),alt:"Preview ".concat(a+1),style:{width:"100%",height:"120px",objectFit:"cover"}}),(0,m.jsx)("button",{"aria-label":"Remove image",title:"Remove",onClick:()=>S(e=>e.filter((e,t)=>t!==a)),style:{position:"absolute",top:"6px",left:"6px",width:"20px",height:"20px",padding:"2px",borderRadius:"6px",fontWeight:"bold",border:"none",cursor:"pointer",background:"#a08f8f96",color:"#111010ff",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 2px 6px rgba(0,0,0,0.4)"},children:"X"}),(0,m.jsx)("div",{style:{position:"absolute",top:"4px",right:"4px",background:"rgba(0,0,0,0.7)",padding:"4px 8px",borderRadius:"4px",color:"white",fontSize:"12px"},children:0===a?"Primary":"#".concat(a+1)})]},a))})]}),(0,m.jsxs)("div",{className:"panel",children:[(0,m.jsx)("label",{className:"label",children:"University Name *"}),(0,m.jsxs)("div",{style:{position:"relative"},children:[(0,m.jsx)("input",{className:"input",placeholder:"e.g., University of Nairobi",value:P.name,onChange:he("name"),style:{paddingRight:"80px"}}),(0,m.jsx)("button",{onClick:()=>ye(),disabled:!P.name||R,style:{position:"absolute",right:"8px",top:"50%",transform:"translateY(-50%)",background:"#00a884",color:"white",border:"none",padding:"6px 12px",borderRadius:"4px",cursor:P.name&&!R?"pointer":"not-allowed",fontSize:"12px",opacity:P.name&&!R?1:.5,display:"flex",alignItems:"center",gap:"4px"},children:R?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(d.TwU,{className:"spin"})," Loading"]}):(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(d.CKj,{})," Auto-Fill"]})}),I&&F.length>0&&(0,m.jsx)("div",{style:{position:"absolute",top:"100%",left:0,right:0,background:"#202c33",border:"1px solid #374151",borderRadius:"8px",marginTop:"4px",maxHeight:"200px",overflowY:"auto",zIndex:1e3,boxShadow:"0 4px 6px rgba(0,0,0,0.3)"},children:F.map((e,a)=>(0,m.jsx)("div",{onClick:()=>ye(e.university_name),style:{padding:"10px",cursor:"pointer",borderBottom:a<F.length-1?"1px solid #374151":"none",transition:"background 0.2s"},onMouseEnter:e=>e.target.style.background="rgba(0, 168, 132, 0.1)",onMouseLeave:e=>e.target.style.background="transparent",children:e.university_name},a))})]}),(0,m.jsx)("label",{className:"label",style:{marginTop:10},children:"Description"}),(0,m.jsx)("textarea",{className:"input",rows:4,placeholder:"Brief description about the university",value:P.description,onChange:he("description")}),(0,m.jsxs)("div",{className:"grid-2",style:{marginTop:10},children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"label",children:"Location"}),(0,m.jsx)("input",{className:"input",placeholder:"e.g., Nairobi",value:P.location,onChange:he("location")})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"label",children:"Website URL"}),(0,m.jsx)("input",{className:"input",placeholder:"https://...",value:P.website_url,onChange:he("website_url")})]})]}),(0,m.jsxs)("div",{className:"grid-2",style:{marginTop:10},children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"label",children:"Established Year"}),(0,m.jsx)("input",{className:"input",type:"number",placeholder:"e.g., 1956",value:P.established,onChange:he("established")})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"label",children:"Student Count"}),(0,m.jsx)("input",{className:"input",type:"number",placeholder:"e.g., 84000",value:P.student_count,onChange:he("student_count")})]})]}),(0,m.jsx)("div",{className:"actions",style:{marginTop:12},children:(0,m.jsx)("button",{className:"btn primary",disabled:de,onClick:async()=>{if(P.name){ue(!0);try{const e={name:P.name,description:P.description||"",website_url:P.website_url||"",location:P.location||"",established:P.established?Number(P.established):null,student_count:P.student_count?Number(P.student_count):0},a=k[0]||null;(await(0,r.zj)({metadata:e,coverFile:a})).id;y({type:"success",message:"University submitted for approval with ".concat(k.length," image(s)!")}),T({name:"",description:"",website_url:"",location:"",established:"",student_count:""}),S([]),v("/user/upload")}catch(e){console.error("University upload failed:",e),y({type:"error",message:(null===e||void 0===e?void 0:e.message)||"Upload failed."})}finally{ue(!1)}}else y({type:"error",message:"Please enter university name."})},children:de?"Adding...":"Add University"})})]})]}),"pastpapers"===g&&(0,m.jsxs)("div",{className:"grid-2",children:[(0,m.jsxs)("div",{className:"panel",children:[(0,m.jsx)("label",{className:"label",children:"Past Paper PDF *"}),be(B,D,"application/pdf","paper-pdf",(0,m.jsx)(d.QuH,{size:24}))]}),(0,m.jsxs)("div",{className:"panel",children:[(0,m.jsx)("label",{className:"label",children:"University *"}),(0,m.jsxs)("select",{className:"select",value:Q.university_id,onChange:xe("university_id"),children:[(0,m.jsx)("option",{value:"",children:"Select University"}),O.map(e=>(0,m.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,m.jsx)("label",{className:"label",style:{marginTop:10},children:"Faculty *"}),Z?(0,m.jsx)("input",{className:"input",placeholder:"e.g., Engineering, Business, Arts",value:V,onChange:e=>X(e.target.value),style:{backgroundColor:"#1f2c33",color:"#ffffff",border:"1px solid #333",borderRadius:"8px",padding:"10px 12px",width:"100%",outline:"none",transition:"border-color 0.2s ease"},onFocus:e=>e.target.style.borderColor="#00a884",onBlur:e=>e.target.style.borderColor="#333"}):(0,m.jsxs)("select",{className:"select",value:Q.faculty,onChange:xe("faculty"),disabled:!Q.university_id||0===M.length,children:[(0,m.jsx)("option",{value:"",children:Q.university_id?0===M.length?"No faculties available":"Select Faculty":"Select a university first"}),M.map(e=>(0,m.jsx)("option",{value:e,children:e},e))]}),(0,m.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"6px",marginTop:"6px"},children:[(0,m.jsx)("input",{type:"checkbox",id:"custom-faculty-toggle",checked:Z,onChange:e=>K(e.target.checked),style:{cursor:"pointer",width:"16px",height:"16px",accentColor:"#00a884"}}),(0,m.jsx)("label",{htmlFor:"custom-faculty-toggle",style:{color:"#8696a0",fontSize:"12px",cursor:"pointer",userSelect:"none"},children:"Add"})]}),(0,m.jsxs)("div",{className:"grid-2",style:{marginTop:10},children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"label",children:"Unit Name *"}),ee?(0,m.jsx)("input",{className:"input",placeholder:"e.g., Introduction to Programming",value:te,onChange:e=>ne(e.target.value),style:{backgroundColor:"#1f2c33",color:"#ffffff",border:"1px solid #333",borderRadius:"8px",padding:"10px 12px",width:"100%",outline:"none",transition:"border-color 0.2s ease"},onFocus:e=>e.target.style.borderColor="#00a884",onBlur:e=>e.target.style.borderColor="#333"}):(0,m.jsxs)("select",{className:"select",value:Q.unit_name,onChange:xe("unit_name"),disabled:!Q.faculty&&!Z||0===Y.length,children:[(0,m.jsx)("option",{value:"",children:Q.faculty||Z?0===Y.length?"No units available":"Select Unit Name":"Select a faculty first"}),Y.map(e=>(0,m.jsx)("option",{value:e,children:e},e))]}),(0,m.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"6px",marginTop:"6px"},children:[(0,m.jsx)("input",{type:"checkbox",id:"custom-unit-toggle",checked:ee,onChange:e=>ae(e.target.checked),style:{cursor:"pointer",width:"16px",height:"16px",accentColor:"#00a884"}}),(0,m.jsx)("label",{htmlFor:"custom-unit-toggle",style:{color:"#8696a0",fontSize:"12px",cursor:"pointer",userSelect:"none"},children:"Add"})]})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"label",children:"Unit Code *"}),(0,m.jsx)("input",{className:"input",placeholder:"e.g., CS101",value:Q.unit_code,onChange:xe("unit_code"),style:{backgroundColor:"#1f2c33",color:"#ffffff",border:"1px solid #333",borderRadius:"8px",padding:"10px 12px",width:"100%",outline:"none",transition:"border-color 0.2s ease"},onFocus:e=>e.target.style.borderColor="#00a884",onBlur:e=>e.target.style.borderColor="#333"})]})]}),(0,m.jsxs)("div",{className:"grid-2",style:{marginTop:10},children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"label",children:"Year *"}),ie?(0,m.jsx)("input",{className:"input",type:"number",placeholder:"e.g., 2023",value:le,onChange:e=>re(e.target.value),style:{backgroundColor:"#1f2c33",color:"#ffffff",border:"1px solid #333",borderRadius:"8px",padding:"10px 12px",width:"100%",outline:"none",transition:"border-color 0.2s ease"},onFocus:e=>e.target.style.borderColor="#00a884",onBlur:e=>e.target.style.borderColor="#333"}):(0,m.jsxs)("select",{className:"select",value:Q.year,onChange:xe("year"),disabled:!Q.unit_name&&!ee||0===G.length,children:[(0,m.jsx)("option",{value:"",children:Q.unit_name||ee?0===G.length?"No years available":"Select Year":"Select a unit first"}),G.map(e=>(0,m.jsx)("option",{value:e,children:e},e))]}),(0,m.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"6px",marginTop:"6px"},children:[(0,m.jsx)("input",{type:"checkbox",id:"custom-year-toggle",checked:ie,onChange:e=>se(e.target.checked),style:{cursor:"pointer",width:"16px",height:"16px",accentColor:"#00a884"}}),(0,m.jsx)("label",{htmlFor:"custom-year-toggle",style:{color:"#8696a0",fontSize:"12px",cursor:"pointer",userSelect:"none"},children:"Add"})]})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"label",children:"Semester"}),(0,m.jsxs)("select",{className:"select",value:Q.semester,onChange:xe("semester"),children:[(0,m.jsx)("option",{value:"",children:"Select Semester"}),(0,m.jsx)("option",{value:"1",children:"Semester 1"}),(0,m.jsx)("option",{value:"2",children:"Semester 2"}),(0,m.jsx)("option",{value:"3",children:"Semester 3"})]})]})]}),(0,m.jsx)("label",{className:"label",style:{marginTop:10},children:"Exam Type"}),(0,m.jsxs)("select",{className:"select",value:Q.exam_type,onChange:xe("exam_type"),children:[(0,m.jsx)("option",{value:"Main",children:"Main Exam"}),(0,m.jsx)("option",{value:"Supplementary",children:"Supplementary"}),(0,m.jsx)("option",{value:"CAT",children:"CAT"}),(0,m.jsx)("option",{value:"Mock",children:"Mock Exam"})]}),(0,m.jsx)("div",{className:"actions",style:{marginTop:12},children:(0,m.jsx)("button",{className:"btn primary",disabled:de,onClick:async()=>{if(!B)return void y({type:"error",message:"Please choose a PDF file."});if(!Q.university_id)return void y({type:"error",message:"Please select a university."});const e=Z?V:Q.faculty;if(!e)return void y({type:"error",message:"Please enter faculty."});if(!Q.unit_code)return void y({type:"error",message:"Please enter unit code."});const t=ee?te:Q.unit_name;if(!t)return void y({type:"error",message:"Please enter unit name."});const n=ie?le:Q.year;if(n){ue(!0);try{if((await(0,o.QK)({universityId:Q.university_id,faculty:e,unitCode:Q.unit_code,unitName:t,year:n})).exists)return y({type:"warning",message:"This past paper (".concat(Q.unit_code," - ").concat(t," for ").concat(n,") already exists in the system.")}),void ue(!1);y({type:"success",message:"Past paper submitted! Processing..."});const i={title:"".concat(Q.unit_code," - ").concat(t),university_id:Q.university_id||null,faculty:e,unit_code:Q.unit_code,unit_name:t,year:n?Number(n):null,semester:Q.semester||"",exam_type:Q.exam_type||"Main",uploaded_by:(null===a||void 0===a?void 0:a.id)||null};console.log("\ud83d\udce4 Submitting past paper with metadata:",JSON.stringify(i,null,2)),console.log("\ud83d\udce4 Current form state:",JSON.stringify(Q,null,2)),$({university_id:"",faculty:"",unit_code:"",unit_name:"",year:"",semester:"",exam_type:""}),X(""),ne(""),re(""),K(!1),ae(!1),se(!1),D(null),q([]),W([]),J([]);const s="admin"===(null===a||void 0===a?void 0:a.role)||"editor"===(null===a||void 0===a?void 0:a.role);(s?o.DT:o.Jw)({metadata:i,pdfFile:B}).catch(e=>{console.error("Past paper upload failed:",e),y({type:"error",message:(null===e||void 0===e?void 0:e.message)||"Upload failed."})})}catch(i){console.error("Upload validation failed:",i),y({type:"error",message:(null===i||void 0===i?void 0:i.message)||"Upload validation failed."})}finally{ue(!1)}}else y({type:"error",message:"Please enter year."})},children:de?"Uploading...":"Upload Past Paper"})})]})]})]})}}}]);
//# sourceMappingURL=173.a3d372b2.chunk.js.map