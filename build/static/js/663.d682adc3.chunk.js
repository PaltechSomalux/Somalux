"use strict";(self.webpackChunkcampuslife=self.webpackChunkcampuslife||[]).push([[663],{3663:(e,t,s)=>{s.r(t),s.d(t,{default:()=>E});var i=s(9379),o=s(5043),n=s(3515),r=s(5200),a=s(3969),l=s(9409),d=s(5146),c=s(8800),x=s(6128),h=s(3986),p=s(8387),m=s(1807),u=s(9906),b=s(1612),g=s(9192),j=s(9857),f=s(6061);function v(e){return(0,f.Ay)("MuiDivider",e)}(0,j.A)("MuiDivider",["root","absolute","fullWidth","inset","middle","flexItem","light","vertical","withChildren","withChildrenVertical","textAlignRight","textAlignLeft","wrapper","wrapperVertical"]);var w=s(579);const A=["absolute","children","className","orientation","component","flexItem","light","role","textAlign","variant"],y=(0,u.Ay)("div",{name:"MuiDivider",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:s}=e;return[t.root,s.absolute&&t.absolute,t[s.variant],s.light&&t.light,"vertical"===s.orientation&&t.vertical,s.flexItem&&t.flexItem,s.children&&t.withChildren,s.children&&"vertical"===s.orientation&&t.withChildrenVertical,"right"===s.textAlign&&"vertical"!==s.orientation&&t.textAlignRight,"left"===s.textAlign&&"vertical"!==s.orientation&&t.textAlignLeft]}})((0,b.A)(e=>{let{theme:t}=e;return{margin:0,flexShrink:0,borderWidth:0,borderStyle:"solid",borderColor:(t.vars||t).palette.divider,borderBottomWidth:"thin",variants:[{props:{absolute:!0},style:{position:"absolute",bottom:0,left:0,width:"100%"}},{props:{light:!0},style:{borderColor:t.alpha((t.vars||t).palette.divider,.08)}},{props:{variant:"inset"},style:{marginLeft:72}},{props:{variant:"middle",orientation:"horizontal"},style:{marginLeft:t.spacing(2),marginRight:t.spacing(2)}},{props:{variant:"middle",orientation:"vertical"},style:{marginTop:t.spacing(1),marginBottom:t.spacing(1)}},{props:{orientation:"vertical"},style:{height:"100%",borderBottomWidth:0,borderRightWidth:"thin"}},{props:{flexItem:!0},style:{alignSelf:"stretch",height:"auto"}},{props:e=>{let{ownerState:t}=e;return!!t.children},style:{display:"flex",textAlign:"center",border:0,borderTopStyle:"solid",borderLeftStyle:"solid","&::before, &::after":{content:'""',alignSelf:"center"}}},{props:e=>{let{ownerState:t}=e;return t.children&&"vertical"!==t.orientation},style:{"&::before, &::after":{width:"100%",borderTop:"thin solid ".concat((t.vars||t).palette.divider),borderTopStyle:"inherit"}}},{props:e=>{let{ownerState:t}=e;return"vertical"===t.orientation&&t.children},style:{flexDirection:"column","&::before, &::after":{height:"100%",borderLeft:"thin solid ".concat((t.vars||t).palette.divider),borderLeftStyle:"inherit"}}},{props:e=>{let{ownerState:t}=e;return"right"===t.textAlign&&"vertical"!==t.orientation},style:{"&::before":{width:"90%"},"&::after":{width:"10%"}}},{props:e=>{let{ownerState:t}=e;return"left"===t.textAlign&&"vertical"!==t.orientation},style:{"&::before":{width:"10%"},"&::after":{width:"90%"}}}]}})),S=(0,u.Ay)("span",{name:"MuiDivider",slot:"Wrapper",overridesResolver:(e,t)=>{const{ownerState:s}=e;return[t.wrapper,"vertical"===s.orientation&&t.wrapperVertical]}})((0,b.A)(e=>{let{theme:t}=e;return{display:"inline-block",paddingLeft:"calc(".concat(t.spacing(1)," * 1.2)"),paddingRight:"calc(".concat(t.spacing(1)," * 1.2)"),whiteSpace:"nowrap",variants:[{props:{orientation:"vertical"},style:{paddingTop:"calc(".concat(t.spacing(1)," * 1.2)"),paddingBottom:"calc(".concat(t.spacing(1)," * 1.2)")}}]}})),k=o.forwardRef(function(e,t){const s=(0,g.b)({props:e,name:"MuiDivider"}),{absolute:o=!1,children:n,className:r,orientation:a="horizontal",component:l=(n||"vertical"===a?"div":"hr"),flexItem:d=!1,light:c=!1,role:x=("hr"!==l?"separator":void 0),textAlign:u="center",variant:b="fullWidth"}=s,j=(0,h.A)(s,A),f=(0,i.A)((0,i.A)({},s),{},{absolute:o,component:l,flexItem:d,light:c,orientation:a,role:x,textAlign:u,variant:b}),k=(e=>{const{absolute:t,children:s,classes:i,flexItem:o,light:n,orientation:r,textAlign:a,variant:l}=e,d={root:["root",t&&"absolute",l,n&&"light","vertical"===r&&"vertical",o&&"flexItem",s&&"withChildren",s&&"vertical"===r&&"withChildrenVertical","right"===a&&"vertical"!==r&&"textAlignRight","left"===a&&"vertical"!==r&&"textAlignLeft"],wrapper:["wrapper","vertical"===r&&"wrapperVertical"]};return(0,m.A)(d,v,i)})(f);return(0,w.jsx)(y,(0,i.A)((0,i.A)({as:l,className:(0,p.A)(k.root,r),role:x,ref:t,ownerState:f,"aria-orientation":"separator"!==x||"hr"===l&&"vertical"!==a?void 0:a},j),{},{children:n?(0,w.jsx)(S,{className:k.wrapper,ownerState:f,children:n}):null}))});k&&(k.muiSkipListHighlight=!0);const N=k;var z=s(1180),C=s(5748),M=s(7734),R=s(2185),D=s(6026),_=s(379),U=s(95),P=s(8676),I=s(2291),T=s(6125),L=s(6992),V=s(6102),B=s(7869);const F=["#00a884","#34B7F1","#FFCC00","#f15e6c","#8b5cf6","#22d3ee"],W=Math.PI/180,K=e=>{const{cx:t,cy:s,midAngle:i,outerRadius:o,percent:n,index:r,payload:a}=e,l=o+14,d=t+l*Math.cos(-i*W),c=s+l*Math.sin(-i*W),x=(null===a||void 0===a?void 0:a.name)||(null===a||void 0===a?void 0:a.label)||"Slice ".concat(r+1),h=d>t?"start":"end";return(0,w.jsxs)("g",{children:[(0,w.jsx)("polyline",{points:"".concat(t+(o-6)*Math.cos(-i*W),",").concat(s+(o-6)*Math.sin(-i*W)," ").concat(t+(o+6)*Math.cos(-i*W),",").concat(s+(o+6)*Math.sin(-i*W)," ").concat(d,",").concat(c),fill:"none",stroke:"#8899a0",strokeWidth:1}),(0,w.jsx)("text",{x:d,y:c,fill:"#cfd8dc",textAnchor:h,dominantBaseline:"central",fontSize:12,children:"".concat(x,": ").concat((100*n).toFixed(0),"%")})]})},E=()=>{var e;const[t,s]=(0,o.useState)({counts:{books:0,users:0,downloads:0,views:0,universities:0,pastPapers:0},monthly:[],categories:[],top:[],recent:[]}),[h,p]=(0,o.useState)(!0),[m,u]=(0,o.useState)(!1),[b,g]=(0,o.useState)([]),[j,f]=(0,o.useState)(!1),[v,A]=(0,o.useState)({}),[y,S]=(0,o.useState)({}),[k,W]=(0,o.useState)({}),[E,O]=(0,o.useState)(1),[q,H]=(0,o.useState)(1),[X,Y]=(0,o.useState)(1),[G,J]=(0,o.useState)(1),Q=15,Z=(t.monthly||[]).map(e=>({month:e.month||"Unknown",Uploads:Number(e.uploads||e.uploads||0)})).filter(e=>!isNaN(e.Uploads)),$=(t.categories||[]).map(e=>({name:e.name||"Unknown",count:Number(e.count||e.Count||0)})).filter(e=>!isNaN(e.count)),ee=(t.top||[]).map(e=>({title:e.title||"Untitled",downloads:Number(e.downloads_count||e.downloads||e.Downloads||0),views:Number(e.views_count||e.views||e.Views||0)})).filter(e=>!isNaN(e.downloads)),te=function(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),i=1;i<t;i++)s[i-1]=arguments[i];for(const o of s)if(e&&Object.prototype.hasOwnProperty.call(e,o)){const t=Number(e[o]);if(!Number.isNaN(t))return t}return 0},se=e=>te(e,"downloads","Downloads","download_count","downloadCount","total_downloads","totalDownloads","dls"),ie=e=>te(e,"uploads","Uploads","upload_count","uploadCount","total_uploads","totalUploads"),oe=e=>te(e,"views","Views","view_count","viewCount","total_views","totalViews"),ne=(t.monthly||[]).map(e=>({raw:e,month:e.month||e.label||"Unknown",uploads:ie(e),views:oe(e),downloads:se(e)})),re=ne.some(e=>e.downloads>0),ae=Number((null===(e=t.counts)||void 0===e?void 0:e.downloads)||0);let le=ne.map(e=>({month:e.month,uploads:e.uploads,views:e.views,downloads:e.downloads}));if(!re&&ae>0&&le.length>0){const e=le.reduce((e,t)=>e+(t.uploads||0),0);if(e>0){le=le.map(t=>(0,i.A)((0,i.A)({},t),{},{downloads:Math.round((t.uploads||0)/e*ae)}));const t=le.reduce((e,t)=>e+(t.downloads||0),0);let s=ae-t;for(let e=0;0!==s&&e<le.length;e+=1)le[e].downloads=(le[e].downloads||0)+(s>0?1:-1),s+=s>0?-1:1}else{const e=Math.floor(ae/le.length);let t=ae-e*le.length;le=le.map(s=>{const o=t>0?1:0;return t-=o,(0,i.A)((0,i.A)({},s),{},{downloads:e+o})})}}le=le.map(e=>({month:e.month||"Unknown",uploads:Number(e.uploads||0),views:Number(e.views||0),downloads:Number(e.downloads||0)})).filter(e=>!Number.isNaN((e.uploads||0)+(e.views||0)+(e.downloads||0)));const de=(e,t)=>{if(!e||e.length<2)return null;const s=e.map(e=>Number(e[t]||0)),i=s[s.length-1],o=s[s.length-2];return o?(i-o)/o*100:null},ce=e=>{if(null===e||Number.isNaN(e))return"\x10\x10\x10\x10\x10-";const t=e.toFixed(1);return"".concat(e>0?"+":"").concat(t,"%")},xe=de(le,"uploads"),he=de(le,"views"),pe=(de(le,"downloads"),Z.filter(e=>e.Uploads>0).sort((e,t)=>t.Uploads-e.Uploads)),me=$.filter(e=>e.count>0).sort((e,t)=>t.count-e.count),ue=ee.filter(e=>e.downloads>0).sort((e,t)=>t.downloads-e.downloads),be=(Math.max(1,Math.ceil((pe.length||0)/7)),Math.max(1,Math.ceil((me.length||0)/7))),ge=Math.max(1,Math.ceil((ue.length||0)/7)),je=7*(E-1),fe=je+7,ve=(pe.slice(je,fe),7*(q-1)),we=ve+7,Ae=me.slice(ve,we),ye=7*(X-1),Se=ye+7,ke=ue.slice(ye,Se),Ne=b.slice((G-1)*Q,G*Q);return(0,o.useEffect)(()=>{(async()=>{p(!0);try{const e=await(0,n.YK)();s(e)}catch(e){console.error("Error fetching stats:",e)}finally{p(!1)}})()},[]),h?(0,w.jsx)("div",{className:"admin-loading",children:"Loading..."}):(0,w.jsxs)(a.A,{sx:{padding:.5},children:[(0,w.jsxs)(l.A,{container:!0,spacing:.5,children:[(0,w.jsxs)(l.A,{size:{xs:12},children:[(0,w.jsx)(d.A,{variant:"h5",sx:{color:"#e9edef",mb:.25,fontSize:"1.1rem"},children:"Overview"}),(0,w.jsx)(d.A,{variant:"body2",sx:{color:"#8696a0",fontSize:"0.75rem"},children:"High-level summary of books, users, universities and reading activity."})]}),(0,w.jsx)(l.A,{size:{xs:12},children:(0,w.jsxs)(l.A,{container:!0,spacing:.5,children:[(0,w.jsx)(l.A,{size:{xs:12,sm:6,md:4,lg:1.7},children:(0,w.jsx)(c.A,{sx:{background:"#111b21",borderRadius:1,boxShadow:"0 1px 2px rgba(0,0,0,0.3)"},children:(0,w.jsxs)(x.A,{sx:{display:"flex",flexDirection:"column",gap:.2,padding:.75},children:[(0,w.jsx)(d.A,{variant:"caption",sx:{color:"#8696a0",fontSize:"0.65rem"},children:"Total Books"}),(0,w.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mt:.1},children:[(0,w.jsx)(d.A,{variant:"h5",sx:{color:"#e9edef",fontSize:"1.1rem"},children:t.counts.books}),(0,w.jsx)(a.A,{sx:{fontSize:10,px:.5,py:.15,borderRadius:999,bgcolor:"rgba(0,168,132,0.1)",color:"#00a884"},children:ce(xe)})]}),(0,w.jsx)(d.A,{variant:"caption",sx:{color:"#8696a0",mt:.1,fontSize:"0.6rem"},children:"Overall books in library"})]})})}),(0,w.jsx)(l.A,{size:{xs:12,sm:6,md:4,lg:1.7},children:(0,w.jsx)(c.A,{sx:{background:"#111b21",borderRadius:1,boxShadow:"0 1px 2px rgba(0,0,0,0.3)"},children:(0,w.jsxs)(x.A,{sx:{display:"flex",flexDirection:"column",gap:.2,padding:.75},children:[(0,w.jsx)(d.A,{variant:"caption",sx:{color:"#8696a0",fontSize:"0.65rem"},children:"Total Users"}),(0,w.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mt:.1},children:[(0,w.jsx)(d.A,{variant:"h5",sx:{color:"#e9edef",fontSize:"1.1rem"},children:t.counts.users}),(0,w.jsx)(a.A,{sx:{fontSize:10,px:.5,py:.15,borderRadius:999,bgcolor:"rgba(52,183,241,0.1)",color:"#34B7F1"},children:ce(xe)})]}),(0,w.jsx)(d.A,{variant:"caption",sx:{color:"#8696a0",mt:.1,fontSize:"0.6rem"},children:"Registered readers"})]})})}),(0,w.jsx)(l.A,{size:{xs:12,sm:6,md:4,lg:1.7},children:(0,w.jsx)(c.A,{sx:{background:"#111b21",borderRadius:1,boxShadow:"0 1px 2px rgba(0,0,0,0.3)"},children:(0,w.jsxs)(x.A,{sx:{display:"flex",flexDirection:"column",gap:.2,padding:.75},children:[(0,w.jsx)(d.A,{variant:"caption",sx:{color:"#8696a0",fontSize:"0.65rem"},children:"Universities"}),(0,w.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mt:.1},children:[(0,w.jsx)(d.A,{variant:"h5",sx:{color:"#e9edef",fontSize:"1.1rem"},children:t.counts.universities}),(0,w.jsx)(a.A,{sx:{fontSize:10,px:.5,py:.15,borderRadius:999,bgcolor:"rgba(255,204,0,0.1)",color:"#FFCC00"},children:ce(xe)})]}),(0,w.jsx)(d.A,{variant:"caption",sx:{color:"#8696a0",mt:.1,fontSize:"0.6rem"},children:"Partner institutions"})]})})}),(0,w.jsx)(l.A,{size:{xs:12,sm:6,md:4,lg:1.7},children:(0,w.jsx)(c.A,{sx:{background:"#111b21",borderRadius:1,boxShadow:"0 1px 2px rgba(0,0,0,0.3)"},children:(0,w.jsxs)(x.A,{sx:{display:"flex",flexDirection:"column",gap:.2,padding:.75},children:[(0,w.jsx)(d.A,{variant:"caption",sx:{color:"#8696a0",fontSize:"0.65rem"},children:"Past Papers"}),(0,w.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mt:.1},children:[(0,w.jsx)(d.A,{variant:"h5",sx:{color:"#e9edef",fontSize:"1.1rem"},children:t.counts.pastPapers}),(0,w.jsx)(a.A,{sx:{fontSize:10,px:.5,py:.15,borderRadius:999,bgcolor:"rgba(241,94,108,0.1)",color:"#f15e6c"},children:ce(xe)})]}),(0,w.jsx)(d.A,{variant:"caption",sx:{color:"#8696a0",mt:.1,fontSize:"0.6rem"},children:"Available exam papers"})]})})}),(0,w.jsx)(l.A,{size:{xs:12,sm:6,md:4,lg:1.7},children:(0,w.jsx)(c.A,{sx:{background:"#111b21",borderRadius:1,boxShadow:"0 1px 2px rgba(0,0,0,0.3)"},children:(0,w.jsxs)(x.A,{sx:{display:"flex",flexDirection:"column",gap:.2,padding:.75},children:[(0,w.jsx)(d.A,{variant:"caption",sx:{color:"#8696a0",fontSize:"0.65rem"},children:"Total Categories"}),(0,w.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mt:.1},children:[(0,w.jsx)(d.A,{variant:"h5",sx:{color:"#e9edef",fontSize:"1.1rem"},children:t.counts.categories}),(0,w.jsx)(a.A,{sx:{fontSize:10,px:.5,py:.15,borderRadius:999,bgcolor:"rgba(123,31,162,0.1)",color:"#bb86fc"},children:ce(xe)})]}),(0,w.jsx)(d.A,{variant:"caption",sx:{color:"#8696a0",mt:.1,fontSize:"0.6rem"},children:"Book organization"})]})})}),(0,w.jsx)(l.A,{size:{xs:12,sm:6,md:4,lg:1.7},children:(0,w.jsx)(c.A,{sx:{background:"#111b21",borderRadius:1,boxShadow:"0 1px 2px rgba(0,0,0,0.3)"},children:(0,w.jsxs)(x.A,{sx:{display:"flex",flexDirection:"column",gap:.2,padding:.75},children:[(0,w.jsx)(d.A,{variant:"caption",sx:{color:"#8696a0",fontSize:"0.65rem"},children:"Total Downloads"}),(0,w.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mt:.1},children:[(0,w.jsx)(d.A,{variant:"h5",sx:{color:"#e9edef",fontSize:"1.1rem"},children:t.counts.downloads}),(0,w.jsx)(a.A,{sx:{fontSize:10,px:.5,py:.15,borderRadius:999,bgcolor:"rgba(139,92,246,0.1)",color:"#8b5cf6"},children:ce(xe)})]}),(0,w.jsx)(d.A,{variant:"caption",sx:{color:"#8696a0",mt:.1,fontSize:"0.6rem"},children:"Total offline attempts"})]})})}),(0,w.jsx)(l.A,{size:{xs:12,sm:6,md:4,lg:1.7},children:(0,w.jsx)(c.A,{sx:{background:"#111b21",borderRadius:1,cursor:"pointer",boxShadow:"0 1px 2px rgba(0,0,0,0.3)"},onClick:async()=>{u(!0),f(!0);try{const e=await(0,n.wL)();g(e)}catch(e){console.error("Error fetching view details:",e)}finally{f(!1)}},children:(0,w.jsxs)(x.A,{sx:{display:"flex",flexDirection:"column",gap:.2,padding:.75},children:[(0,w.jsxs)(d.A,{variant:"caption",sx:{color:"#8696a0",display:"flex",alignItems:"center",gap:.2,fontSize:"0.65rem"},children:["Total Views ",(0,w.jsx)(r.Vap,{})]}),(0,w.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mt:.1},children:[(0,w.jsx)(d.A,{variant:"h5",sx:{color:"#e9edef",fontSize:"1.1rem"},children:t.counts.views}),(0,w.jsx)(a.A,{sx:{fontSize:10,px:.5,py:.15,borderRadius:999,bgcolor:"rgba(34,211,238,0.1)",color:"#22d3ee"},children:ce(he)})]}),(0,w.jsx)(d.A,{variant:"caption",sx:{color:"#8696a0",mt:.1,fontSize:"0.6rem"},children:"Click details"})]})})})]})}),le&&le.length>0&&(0,w.jsx)(l.A,{size:{xs:12,md:6},children:(0,w.jsx)(c.A,{sx:{background:"#111b21",borderRadius:1,mt:0},children:(0,w.jsxs)(x.A,{sx:{padding:1},children:[(0,w.jsx)(d.A,{variant:"subtitle1",sx:{color:"#e9edef",mb:.3,fontSize:"0.85rem"},children:"Activity Trend"}),(0,w.jsx)(N,{sx:{borderColor:"#202c33",mb:.5}}),(0,w.jsx)(a.A,{sx:{width:"100%",height:280},children:(0,w.jsx)(z.u,{width:"100%",height:"100%",children:(0,w.jsxs)(C.b,{data:le,margin:{top:4,right:8,left:-12,bottom:0},children:[(0,w.jsx)(M.d,{strokeDasharray:"3 3",stroke:"#202c33"}),(0,w.jsx)(R.W,{dataKey:"month",stroke:"#8696a0",tick:{fontSize:9},tickMargin:4}),(0,w.jsx)(D.h,{stroke:"#8696a0",tick:{fontSize:9}}),(0,w.jsx)(_.m,{contentStyle:{backgroundColor:"#1f2c33",border:"1px solid #2a3942",borderRadius:4,color:"#e9edef",fontSize:"11px"},labelStyle:{color:"#cfd8dc"}}),(0,w.jsx)(U.s,{}),(0,w.jsx)(P.N1,{type:"monotone",dataKey:"uploads",name:"Uploads",stroke:"#00a884",strokeWidth:2,dot:!1}),(0,w.jsx)(P.N1,{type:"monotone",dataKey:"views",name:"Views",stroke:"#34B7F1",strokeWidth:2,dot:!1}),(0,w.jsx)(P.N1,{type:"monotone",dataKey:"downloads",name:"Downloads",stroke:"#8b5cf6",strokeWidth:2,dot:!1})]})})})]})})}),(0,w.jsx)(l.A,{size:{xs:12,md:6},children:(0,w.jsx)(c.A,{sx:{background:"#111b21",borderRadius:1},children:(0,w.jsxs)(x.A,{sx:{padding:1},children:[(0,w.jsx)(d.A,{variant:"subtitle1",sx:{color:"#e9edef",mb:.3,fontSize:"0.85rem"},children:"Uploads per Month"}),(0,w.jsx)(N,{sx:{borderColor:"#202c33",mb:.5}}),(0,w.jsx)(a.A,{sx:{width:"100%",height:280,mb:1},children:0===Z.length?(0,w.jsx)(a.A,{sx:{color:"#8696a0",textAlign:"center",pt:4},children:"No uploads yet"}):(0,w.jsx)(z.u,{width:"100%",height:"100%",children:(0,w.jsxs)(I.E,{data:Z,margin:{top:10,right:16,left:-16,bottom:0},children:[(0,w.jsx)(M.d,{strokeDasharray:"3 3",stroke:"#202c33"}),(0,w.jsx)(R.W,{dataKey:"month",stroke:"#8696a0",tick:{fontSize:11},tickMargin:8}),(0,w.jsx)(D.h,{stroke:"#8696a0",tick:{fontSize:11}}),(0,w.jsx)(_.m,{cursor:{fill:"rgba(32,44,51,0.6)"},contentStyle:{backgroundColor:"#1f2c33",border:"1px solid #2a3942",borderRadius:8,color:"#e9edef"},labelStyle:{color:"#cfd8dc"}}),(0,w.jsx)(U.s,{}),(0,w.jsx)(T.yP,{dataKey:"Uploads",name:"Uploads",fill:"#00a884",radius:[4,4,0,0]})]})})})]})})}),(0,w.jsx)(l.A,{size:{xs:12,md:6},children:(0,w.jsx)(c.A,{sx:{background:"#111b21",borderRadius:1},children:(0,w.jsxs)(x.A,{sx:{padding:1},children:[(0,w.jsx)(d.A,{variant:"subtitle1",sx:{color:"#e9edef",mb:.3,fontSize:"0.85rem"},children:"Categories Distribution"}),(0,w.jsx)(N,{sx:{borderColor:"#202c33",mb:.5}}),(0,w.jsx)(a.A,{sx:{width:"100%",height:200,mb:1},children:0===$.length?(0,w.jsx)(a.A,{sx:{color:"#8696a0",textAlign:"center",pt:4},children:"No category data"}):(0,w.jsx)(z.u,{width:"100%",height:"100%",children:(0,w.jsxs)(L.r,{children:[(0,w.jsx)(V.Fq,{data:$,dataKey:"count",nameKey:"name",cx:"50%",cy:"50%",outerRadius:90,fill:"#00a884",labelLine:!0,label:K,paddingAngle:2,minAngle:3,children:$.map((e,t)=>(0,w.jsx)(B.f,{fill:F[t%F.length]},"cell-".concat(t)))}),(0,w.jsx)(_.m,{contentStyle:{backgroundColor:"#1f2c33",border:"1px solid #2a3942",borderRadius:8,color:"#e9edef"},labelStyle:{color:"#cfd8dc"}}),(0,w.jsx)(U.s,{})]})})}),(0,w.jsx)(a.A,{sx:{overflowX:"auto"},children:(0,w.jsxs)("table",{className:"table overview-table",children:[(0,w.jsx)("thead",{children:(0,w.jsxs)("tr",{children:[(0,w.jsx)("th",{children:"Category"}),(0,w.jsx)("th",{children:"Count"})]})}),(0,w.jsxs)("tbody",{children:[(Ae.length?Ae:[]).map((e,t)=>(0,w.jsxs)("tr",{children:[(0,w.jsx)("td",{children:e.name}),(0,w.jsx)("td",{children:e.count})]},t)),0===me.length&&(0,w.jsx)("tr",{children:(0,w.jsx)("td",{colSpan:2,style:{color:"#8696a0"},children:"No category data"})})]})]})}),me.length>7&&(0,w.jsxs)(a.A,{className:"actions",sx:{mt:1.5,display:"flex",justifyContent:"space-between"},children:[(0,w.jsx)("button",{className:"btn",disabled:q<=1,onClick:()=>H(e=>Math.max(1,e-1)),children:"Prev"}),(0,w.jsxs)("span",{style:{color:"#cfd8dc",fontSize:12},children:["Page ",q," of ",be]}),(0,w.jsx)("button",{className:"btn",disabled:q>=be,onClick:()=>H(e=>Math.min(be,e+1)),children:"Next"})]})]})})}),(0,w.jsx)(l.A,{size:{xs:12,md:6},children:(0,w.jsx)(c.A,{sx:{background:"#111b21",borderRadius:1},children:(0,w.jsxs)(x.A,{sx:{padding:1},children:[(0,w.jsx)(d.A,{variant:"subtitle1",sx:{color:"#e9edef",mb:.3,fontSize:"0.85rem"},children:"Top Books (Downloads)"}),(0,w.jsx)(N,{sx:{borderColor:"#202c33",mb:.5}}),(0,w.jsx)(a.A,{sx:{overflowX:"auto",maxHeight:350,overflowY:"auto"},children:(0,w.jsxs)("table",{className:"table overview-table",children:[(0,w.jsx)("thead",{children:(0,w.jsxs)("tr",{children:[(0,w.jsx)("th",{children:"Title"}),(0,w.jsx)("th",{children:"Downloads"})]})}),(0,w.jsxs)("tbody",{children:[(ke.length?ke:[]).map((e,s)=>{const i=t.counts.downloads||0,o=i>0?Math.min(1,(e.downloads||0)/i):0,n=Math.round(100*o);return(0,w.jsxs)("tr",{children:[(0,w.jsx)("td",{children:(0,w.jsxs)(a.A,{sx:{display:"flex",flexDirection:"column",gap:.5},children:[(0,w.jsx)("span",{children:e.title}),(0,w.jsx)(a.A,{sx:{background:"#202c33",borderRadius:999,overflow:"hidden",height:6},children:(0,w.jsx)(a.A,{sx:{width:"".concat(n,"%"),height:"100%",bgcolor:"#00a884"}})})]})}),(0,w.jsx)("td",{children:e.downloads})]},s)}),0===ue.length&&(0,w.jsx)("tr",{children:(0,w.jsx)("td",{colSpan:2,style:{color:"#8696a0"},children:"No top books data"})})]})]})}),ue.length>7&&(0,w.jsxs)(a.A,{className:"actions",sx:{mt:1.5,display:"flex",justifyContent:"space-between"},children:[(0,w.jsx)("button",{className:"btn",disabled:X<=1,onClick:()=>Y(e=>Math.max(1,e-1)),children:"Prev"}),(0,w.jsxs)("span",{style:{color:"#cfd8dc",fontSize:12},children:["Page ",X," of ",ge]}),(0,w.jsx)("button",{className:"btn",disabled:X>=ge,onClick:()=>Y(e=>Math.min(ge,e+1)),children:"Next"})]})]})})})]}),m&&(0,w.jsx)("div",{className:"modal-overlay",onClick:()=>u(!1),children:(0,w.jsxs)("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[(0,w.jsxs)("div",{className:"modal-header",children:[(0,w.jsx)("h2",{style:{margin:0,color:"#e9edef"},children:"Book View Details"}),(0,w.jsx)("button",{onClick:()=>u(!1),className:"icon-btn",children:(0,w.jsx)(r.yGN,{size:20})})]}),(0,w.jsx)("div",{className:"modal-body",children:j?(0,w.jsx)("div",{style:{textAlign:"center",padding:40,color:"#8696a0"},children:"Loading..."}):(0,w.jsxs)("div",{children:[(0,w.jsxs)("table",{className:"table",children:[(0,w.jsx)("thead",{children:(0,w.jsxs)("tr",{children:[(0,w.jsx)("th",{children:"Book Title"}),(0,w.jsx)("th",{children:"Total Views"}),(0,w.jsx)("th",{children:"Unique Users"}),(0,w.jsx)("th",{children:"Details"})]})}),(0,w.jsx)("tbody",{children:Ne.map((e,t)=>(0,w.jsxs)(o.Fragment,{children:[(0,w.jsxs)("tr",{children:[(0,w.jsx)("td",{children:(0,w.jsx)("strong",{children:e.book_title})}),(0,w.jsx)("td",{children:e.total_views}),(0,w.jsx)("td",{children:e.unique_users}),(0,w.jsx)("td",{children:(0,w.jsx)("button",{className:"btn",onClick:()=>{S(t=>t[e.book_id]?(0,i.A)((0,i.A)({},t),{},{[e.book_id]:!1}):(0,i.A)((0,i.A)({},t),{},{[e.book_id]:!0})),A(t=>(0,i.A)((0,i.A)({},t),{},{[e.book_id]:t[e.book_id]||1}))},style:{backgroundColor:y[e.book_id]?"#2c7a7f":void 0,color:y[e.book_id]?"#fff":void 0},children:y[e.book_id]?"Close":"View Users"})})]}),y[e.book_id]&&(0,w.jsx)("tr",{style:{backgroundColor:"#111b21"},children:(0,w.jsx)("td",{colSpan:4,children:(0,w.jsxs)("div",{className:"viewer-section",children:[(0,w.jsx)("div",{className:"viewer-section-title",children:"Users who viewed"}),(t=>{const s=v[e.book_id]||1,o=Math.max(1,Math.ceil(((null===(t=e.users)||void 0===t?void 0:t.length)||0)/8)),n=8*(s-1),r=n+8,a=(e.users||[]).slice(n,r);return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)("div",{className:"viewer-list",children:[a.map((t,s)=>{const o=(e=>{if(!e)return null;try{return JSON.parse(localStorage.getItem("avatarsByEmail")||"{}")[e]||null}catch(t){return null}})(t.email),n=t.views&&t.views.length>0?new Date(t.views[0]).toLocaleString():"No timestamps";return(0,w.jsxs)("div",{className:"viewer-item",children:[o?(0,w.jsx)("img",{src:o,alt:t.email||"avatar",style:{width:36,height:36,borderRadius:999,objectFit:"cover",flex:"0 0 36px"},className:"viewer-avatar-img"}):(0,w.jsx)("div",{className:"viewer-avatar",children:(t.email||"?").charAt(0).toUpperCase()}),(0,w.jsxs)("div",{className:"viewer-meta",children:[(0,w.jsx)("div",{className:"viewer-email",children:t.email}),(0,w.jsxs)("details",{className:"viewer-time-dropdown",children:[(0,w.jsxs)("summary",{children:["Latest: ",n]}),(()=>{const s="".concat(e.book_id,":").concat(t.email||"unknown"),o=k[s]||1,n=(t.views||[]).length,r=Math.max(1,Math.ceil(n/8)),a=8*(o-1),l=a+8,d=(t.views||[]).slice(a,l);return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)("ul",{className:"viewer-time-list",children:d.map((e,t)=>(0,w.jsx)("li",{children:new Date(e).toLocaleString()},t))}),n>8&&(0,w.jsxs)("div",{style:{marginTop:6,display:"flex",alignItems:"center",justifyContent:"space-between",gap:8,fontSize:11,color:"#cfd8dc"},children:[(0,w.jsx)("button",{className:"btn",style:{padding:"4px 8px",fontSize:11},disabled:o<=1,onClick:e=>{e.preventDefault(),e.stopPropagation(),W(e=>(0,i.A)((0,i.A)({},e),{},{[s]:Math.max(1,o-1)}))},children:"Prev"}),(0,w.jsxs)("span",{children:["Page ",o," of ",r]}),(0,w.jsx)("button",{className:"btn",style:{padding:"4px 8px",fontSize:11},disabled:o>=r,onClick:e=>{e.preventDefault(),e.stopPropagation(),W(e=>(0,i.A)((0,i.A)({},e),{},{[s]:Math.min(r,o+1)}))},children:"Next"})]})]})})()]})]})]},s)}),0===a.length&&(0,w.jsx)("div",{style:{color:"#8696a0"},children:"No viewers on this page."})]}),e.users&&e.users.length>8&&(0,w.jsxs)("div",{className:"actions",style:{marginTop:10,justifyContent:"space-between"},children:[(0,w.jsx)("button",{className:"btn",disabled:s<=1,onClick:()=>A(t=>(0,i.A)((0,i.A)({},t),{},{[e.book_id]:Math.max(1,(t[e.book_id]||1)-1)})),children:"Prev"}),(0,w.jsxs)("span",{style:{color:"#cfd8dc"},children:["Page ",s," of ",o," (",e.users.length," viewers)"]}),(0,w.jsx)("button",{className:"btn",disabled:s>=o,onClick:()=>A(t=>(0,i.A)((0,i.A)({},t),{},{[e.book_id]:Math.min(o,(t[e.book_id]||1)+1)})),children:"Next"})]})]})})()]})})})]},e.book_id))})]}),b.length>Q&&(0,w.jsxs)("div",{className:"actions",style:{marginTop:10,display:"flex",justifyContent:"space-between"},children:[(0,w.jsx)("button",{className:"btn",disabled:G<=1,onClick:()=>J(e=>Math.max(1,e-1)),children:"Prev"}),(0,w.jsxs)("span",{style:{color:"#cfd8dc"},children:["Page ",G," of ",Math.ceil(b.length/Q)]}),(0,w.jsx)("button",{className:"btn",disabled:G>=Math.ceil(b.length/Q),onClick:()=>J(e=>Math.min(Math.ceil(b.length/Q),e+1)),children:"Next"})]})]})})]})})]})}}}]);
//# sourceMappingURL=663.d682adc3.chunk.js.map