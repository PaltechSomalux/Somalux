"use strict";(self.webpackChunkcampuslife=self.webpackChunkcampuslife||[]).push([[899],{7899:(e,t,n)=>{n.r(t),n.d(t,{default:()=>S});var o=n(5043),i=n(4218),a=n(5200),r=n(3515),s=n(9738),l=n(7397);async function c(e){try{l.EA.workerSrc||(l.EA.workerSrc="//cdnjs.cloudflare.com/ajax/libs/pdf.js/".concat(l.rE,"/pdf.worker.min.js"));const t=await e.arrayBuffer(),n=await l.YE({data:t}).promise;let o="";const i=Math.min(2,n.numPages);for(let e=1;e<=i;e++){const t=await n.getPage(e),i=await t.getTextContent();o+=i.items.map(e=>e.str).join(" ")+"\n"}return function(e,t){const n={university:null,faculty:null,unitCode:null,unitName:null,year:null,semester:null,examType:null,source:"text"},o=(e.toUpperCase(),[/UNIVERSITY\s+OF\s+([A-Z\s]+?)(?:\n|EXAMINATION|EXAM|PAPER|FACULTY|SCHOOL|DEPARTMENT|$)/i,/([A-Z\s]+?)\s+UNIVERSITY(?:\n|\s|EXAMINATION|EXAM|FACULTY|SCHOOL|DEPARTMENT|$)/i]);for(const d of o){const t=e.match(d);if(t&&t[1]){const e=t[1].trim();if(e.length>3){n.university=e;break}}}const i=[/FACULTY\s+OF\s+([A-Z\s&,]+?)(?:\n|EXAMINATION|EXAM|PAPER|COURSE|UNIT|$)/i,/SCHOOL\s+OF\s+([A-Z\s&,]+?)(?:\n|EXAMINATION|EXAM|PAPER|COURSE|UNIT|$)/i,/DEPARTMENT\s+OF\s+([A-Z\s&,]+?)(?:\n|EXAMINATION|EXAM|PAPER|COURSE|UNIT|$)/i,/COLLEGE\s+OF\s+([A-Z\s&,]+?)(?:\n|EXAMINATION|EXAM|PAPER|COURSE|UNIT|$)/i,/(?:FACULTY|SCHOOL|DEPARTMENT|COLLEGE):\s*([A-Z\s&,]+?)(?:\n|EXAMINATION|EXAM)/i,/(?:UNIVERSITY.*?\n)((?:[A-Z][A-Z\s&,]+?))\s*(?:EXAMINATION|EXAM|$)/i];for(const d of i){const t=e.match(d);if(t&&t[1]){let e=t[1].trim().replace(/\d+/g,"").replace(/\s{2,}/g," ").trim();if(e.length>3&&e.length<100&&!e.match(/^(AND|OR|THE|A|EXAMINATION|EXAM)$/i)){n.faculty=e;break}}}const a=e.match(/([A-Z]{2,6}\s*\d{3,4})/);a&&(n.unitCode=a[1].replace(/\s+/g,""));const r=e.match(/(?:[A-Z]{2,6}\s*\d{3,4})[:\s]+([A-Z][A-Za-z\s&,\-]+?)(?:\n|EXAMINATION|EXAM|COURSE CODE)/i);r&&(n.unitName=r[1].trim());const s=e.match(/\b(19|20)\d{2}\b/);s&&(n.year=parseInt(s[0]));const l=e.match(/SEMESTER\s*:?\s*([1-3])/i)||e.match(/FIRST SEMESTER/i)||e.match(/SECOND SEMESTER/i)||e.match(/THIRD SEMESTER/i);l&&(l[0].includes("FIRST")?n.semester="1":l[0].includes("SECOND")?n.semester="2":l[0].includes("THIRD")?n.semester="3":n.semester=l[1]);const c=[/(?:MAIN|SUPPLEMENTARY|SUPPLEMENTAL|CAT|CONTINUOUS ASSESSMENT|MOCK|MIDTERM)/i];for(const d of c){const t=e.match(d);if(t){const e=t[0].toUpperCase();e.includes("MAIN")?n.examType="Main":e.includes("SUPPLEMENTARY")||e.includes("SUPPLEMENTAL")?n.examType="Supplementary":e.includes("CAT")||e.includes("CONTINUOUS")?n.examType="CAT":e.includes("MOCK")&&(n.examType="Mock");break}}if(!n.unitCode||!n.year){const e=d(t);n.unitCode=n.unitCode||e.unitCode,n.unitName=n.unitName||e.unitName,n.year=n.year||e.year,n.semester=n.semester||e.semester,n.examType=n.examType||e.examType}return n}(o,e.name)}catch(t){return console.warn("PDF extraction failed, falling back to filename parsing:",t),d(e.name)}}function d(e){const t={university:null,faculty:null,unitCode:null,unitName:null,year:null,semester:null,examType:null,source:"filename"},n=e.replace(".pdf","").replace(/\.[a-z]+$/i,"").split("_");return n.length>=5&&(t.unitCode=n[0]||null,t.unitName=n[1]||null,t.year=n[2]?parseInt(n[2]):null,t.semester=n[3]||null,t.examType=n[4]||"Main"),t}function u(e,t){if(!e||!t.length)return null;const n=e.toUpperCase().trim();for(const r of t){const e=r.name.toUpperCase();if(e.includes(n)||n.includes(e))return r.id}const o=n.split(/\s+/);let i=null,a=0;for(const r of t){const e=r.name.toUpperCase().split(/\s+/);let t=0;for(const i of o)e.some(e=>e.includes(i)||i.includes(e))&&t++;const n=t/Math.max(o.length,e.length);n>a&&n>.6&&(a=n,i=r.id)}return i}function p(e,t){if(!e||!t.length)return null;const n=e.toUpperCase().trim();for(const r of t){const e=r.toUpperCase();if(e.includes(n)||n.includes(e))return r}const o=n.split(/\s+/);let i=null,a=0;for(const r of t){const e=r.toUpperCase().split(/\s+/);let t=0;for(const i of o)e.some(e=>e.includes(i)||i.includes(e))&&t++;const n=t/Math.max(o.length,e.length);n>a&&n>.6&&(a=n,i=r)}return i}function g(e,t){if(!e)return null;const n=(e||"").toUpperCase(),o=(t||"").toUpperCase(),i={CHEM:"Chemistry",BIO:"Biology",PHYS:"Physics",MATH:"Mathematics",STAT:"Statistics",GEO:"Geology",BOT:"Botany",ZOO:"Zoology",ENG:"Engineering",MECH:"Mechanical Engineering",ELEC:"Electrical Engineering",CIVI:"Civil Engineering",COMP:"Computer Science/Engineering",ICT:"Information & Communication Technology",IT:"Information Technology",CS:"Computer Science",SE:"Software Engineering",ENG:"English",HIST:"History",GEOG:"Geography",SOC:"Sociology",ECON:"Economics",POLI:"Political Science",PSYCH:"Psychology",PHIL:"Philosophy",LAW:"Law",BUS:"Business",MGMT:"Management",ACC:"Accounting",FIN:"Finance",MARK:"Marketing",HR:"Human Resources",MED:"Medicine",NURS:"Nursing",PHARM:"Pharmacy",DENT:"Dentistry",AGR:"Agriculture",AGBM:"Agriculture Business Management",EDU:"Education",SOCI:"Education / Sociology"};for(const[a,r]of Object.entries(i))if(n.startsWith(a))return r;if(o)for(const[a,r]of Object.entries(i))if(o.includes(a.toUpperCase()))return r;return null}var f=n(9101),x=n(579);const m=e=>{let{userProfile:t,asSubmission:n,showToast:i}=e;const[s,c]=(0,o.useState)([]),[d,u]=(0,o.useState)(!1),[p,g]=(0,o.useState)({current:0,total:0}),[m,y]=(0,o.useState)(0),[S,E]=(0,o.useState)(0),[h,C]=(0,o.useState)(0),[A,v]=(0,o.useState)(0),[T,N]=(0,o.useState)(null),[b,F]=(0,o.useState)(!1),[M,P]=(0,o.useState)([]),I=(0,o.useRef)(null),{showToast:O}=(0,f.v)();(0,o.useEffect)(()=>{l.EA.workerSrc||(l.EA.workerSrc="//cdnjs.cloudflare.com/ajax/libs/pdf.js/".concat(l.rE,"/pdf.worker.min.js")),(0,r.jE)().then(e=>P(e||[]))},[]);const D=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";i(e,t),N({message:e,type:t}),setTimeout(()=>N(null),4e3)},R=async e=>{try{const t=await e.arrayBuffer(),n=await l.YE({data:t}).promise;if(n.numPages>0){const t=await n.getPage(1),o=t.getViewport({scale:2}),i=document.createElement("canvas");i.width=o.width,i.height=o.height;const a=i.getContext("2d");return await t.render({canvasContext:a,viewport:o}).promise,new Promise(t=>{i.toBlob(n=>{if(n){const o=new File([n],"".concat(e.name.replace(".pdf",""),"_cover.png"),{type:"image/png"});t(o)}else t(null)},"image/png",.95)})}}catch(t){console.error("Error extracting cover:",t)}return null},j=e=>{const t=e.replace(".pdf","").trim();return{title:t.length>3?t:"",author:"",description:"",category_id:null,year:null,language:"English",isbn:"",pages:0,publisher:""}},w=p.total>0?p.current/p.total*100:0,L=s.reduce((e,t)=>e+t.size,0)/1024/1024;return(0,x.jsxs)("div",{className:"panel",children:[(0,x.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,x.jsx)("h2",{style:{color:"#e9edef",fontSize:"20px",fontWeight:"600",margin:"0 0 8px 0"},children:"Bulk Upload from Folder"}),(0,x.jsx)("p",{style:{color:"#8696a0",fontSize:"13px",margin:"0"},children:"Select a folder to upload multiple PDF files at once"})]}),n&&(0,x.jsx)("div",{style:{marginBottom:"15px",padding:"10px 12px",background:"#1f2c33",border:"1px solid #00a884",borderRadius:"6px",color:"#00a884",fontSize:"12px"},children:"\ud83d\udccb Your uploads will be reviewed and appear after approval"}),0===s.length?(0,x.jsxs)("div",{onDragOver:e=>{e.preventDefault(),e.stopPropagation(),F(!0)},onDragLeave:e=>{e.preventDefault(),e.stopPropagation(),F(!1)},onDrop:e=>{e.preventDefault(),e.stopPropagation(),F(!1);const t=e.dataTransfer.items,n=[];if(t)for(let o=0;o<t.length;o++){const e=t[o];if("file"===e.kind){const t=e.getAsFile();t.name.toLowerCase().endsWith(".pdf")&&n.push(t)}}0!==n.length?(c(n),D("Found ".concat(n.length," PDF files"),"success")):D("No PDF files found","error")},onClick:()=>{var e;return null===(e=I.current)||void 0===e?void 0:e.click()},style:{border:"2px dashed ".concat(b?"#00a884":"#374151"),borderRadius:"8px",padding:"40px 20px",textAlign:"center",cursor:"pointer",background:b?"rgba(0, 168, 132, 0.08)":"#0b141a",transition:"all 0.2s"},children:[(0,x.jsx)(a.UDU,{size:40,style:{color:"#00a884",marginBottom:"12px"}}),(0,x.jsx)("h3",{style:{color:"#e9edef",fontSize:"16px",fontWeight:"500",margin:"0 0 4px 0"},children:"Select Folder or Drag & Drop"}),(0,x.jsx)("p",{style:{color:"#8696a0",fontSize:"13px",margin:"0"},children:"Choose a folder with PDF files"}),(0,x.jsx)("input",{ref:I,type:"file",webkitdirectory:"true",directory:"",multiple:!0,onChange:e=>{const t=Array.from(e.target.files||[]).filter(e=>e.name.toLowerCase().endsWith(".pdf"));0!==t.length?(c(t),D("Found ".concat(t.length," PDF files"),"success")):D("No PDF files found in selected folder","error")},style:{display:"none"},accept:".pdf"})]}):(0,x.jsxs)(x.Fragment,{children:[(0,x.jsxs)("div",{style:{background:"#0b141a",border:"1px solid #1f2c33",borderRadius:"8px",marginBottom:"20px",overflow:"hidden"},children:[(0,x.jsx)("div",{style:{padding:"12px 16px",borderBottom:"1px solid #1f2c33",background:"#0b141a"},children:(0,x.jsxs)("div",{style:{color:"#e9edef",fontSize:"13px",fontWeight:"500"},children:["Files (",s.length,") \u2022 ",L.toFixed(1)," MB"]})}),(0,x.jsx)("div",{style:{maxHeight:"250px",overflowY:"auto"},children:s.map((e,t)=>(0,x.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"10px",padding:"10px 16px",borderBottom:t<s.length-1?"1px solid #1f2c33":"none",color:"#8696a0",fontSize:"12px"},children:[(0,x.jsx)(a.QuH,{size:14,style:{color:"#00a884",flexShrink:0}}),(0,x.jsx)("span",{style:{flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.name}),(0,x.jsxs)("span",{style:{color:"#8696a0",fontSize:"11px",flexShrink:0},children:[(e.size/1024/1024).toFixed(1)," MB"]})]},t))})]}),d&&(0,x.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,x.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"8px",color:"#8696a0",fontSize:"12px"},children:[(0,x.jsxs)("span",{children:["Progress: ",p.current," / ",p.total]}),(0,x.jsxs)("span",{children:["\u2713 ",m," | \u23ed\ufe0f ",h," | \u2717 ",S]})]}),(0,x.jsx)("div",{style:{width:"100%",height:"6px",background:"#1f2c33",borderRadius:"3px",overflow:"hidden"},children:(0,x.jsx)("div",{style:{width:"".concat(w,"%"),height:"100%",background:"#00a884",transition:"width 0.3s"}})})]}),(0,x.jsxs)("div",{style:{display:"flex",gap:"10px"},children:[(0,x.jsx)("button",{onClick:async()=>{if(0===s.length)return void D("No files selected","error");u(!0),g({current:0,total:s.length}),y(0),E(0),C(0),v(0);let e=0,n=0;for(let a=0;a<s.length;a++){const o=s[a];g({current:a+1,total:s.length});try{const n=await R(o),i=j(o.name);"admin"===(null===t||void 0===t?void 0:t.role)||"editor"===(null===t||void 0===t?void 0:t.role)?await(0,r.iC)({metadata:i,pdfFile:o,coverFile:n}):await(0,r.WI)({metadata:i,pdfFile:o,coverFile:n}),e++,y(e)}catch(i){console.error("Failed to upload ".concat(o.name,":"),i),n++,E(n)}}u(!1);const o="Upload complete: ".concat(e," successful, ").concat(n," failed");D(o,0===n?"success":"info"),setTimeout(()=>{c([]),g({current:0,total:0})},2e3)},disabled:d,style:{flex:1,padding:"10px 16px",background:d?"#00a88466":"#00a884",color:"#fff",border:"none",borderRadius:"6px",fontSize:"13px",fontWeight:"500",cursor:d?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",opacity:d?.6:1},children:d?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(a.jTZ,{style:{animation:"spin 1s linear infinite"}}),"Uploading..."]}):(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(a.B88,{size:14}),"Upload ",s.length," File",1!==s.length?"s":""]})}),(0,x.jsxs)("button",{onClick:()=>{c([]),g({current:0,total:0}),y(0),E(0),C(0),v(0),I.current&&(I.current.value="")},disabled:d,style:{padding:"10px 16px",background:"#1f2c33",color:"#8696a0",border:"1px solid #374151",borderRadius:"6px",fontSize:"13px",fontWeight:"500",cursor:d?"not-allowed":"pointer",display:"flex",alignItems:"center",gap:"6px",opacity:d?.5:1},children:[(0,x.jsx)(a.yGN,{size:14}),"Clear"]})]})]}),(m>0||h>0||S>0)&&!d&&(0,x.jsxs)("div",{style:{marginTop:"20px",padding:"16px",background:"#0b141a",border:"1px solid ".concat(0===S?"#00a884":"#f1b233"),borderRadius:"8px"},children:[(0,x.jsx)("div",{style:{color:"#e9edef",fontSize:"13px",fontWeight:"500",marginBottom:"12px"},children:"Upload Complete"}),(0,x.jsxs)("div",{style:{display:"flex",gap:"16px"},children:[(0,x.jsxs)("div",{style:{textAlign:"center"},children:[(0,x.jsx)("div",{style:{color:"#00a884",fontSize:"20px",fontWeight:"600",marginBottom:"2px"},children:m}),(0,x.jsx)("div",{style:{color:"#8696a0",fontSize:"11px"},children:"Uploaded"})]}),h>0&&(0,x.jsxs)("div",{style:{textAlign:"center"},children:[(0,x.jsx)("div",{style:{color:"#f1b233",fontSize:"20px",fontWeight:"600",marginBottom:"2px"},children:h}),(0,x.jsx)("div",{style:{color:"#8696a0",fontSize:"11px"},children:"Skipped (Duplicates)"})]}),S>0&&(0,x.jsxs)("div",{style:{textAlign:"center"},children:[(0,x.jsx)("div",{style:{color:"#ea4335",fontSize:"20px",fontWeight:"600",marginBottom:"2px"},children:S}),(0,x.jsx)("div",{style:{color:"#8696a0",fontSize:"11px"},children:"Failed"})]})]})]}),T&&(0,x.jsxs)("div",{style:{position:"fixed",bottom:"20px",right:"20px",maxWidth:"300px",width:"calc(100% - 40px)",background:"error"===T.type?"#ea4335":"success"===T.type?"#00a884":"#374151",color:"#fff",padding:"12px 16px",borderRadius:"6px",zIndex:1e4,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",display:"flex",alignItems:"center",gap:"8px",fontSize:"13px",animation:"slideIn 0.3s ease"},children:["success"===T.type?"\u2713":"error"===T.type?"\u2717":"\u2139"," ",T.message]})]})},y=e=>{let{userProfile:t,asSubmission:n,showToast:i}=e;const[r,l]=(0,o.useState)([]),[d,f]=(0,o.useState)(!1),[m,y]=(0,o.useState)(!1),[S,E]=(0,o.useState)({current:0,total:0}),[h,C]=(0,o.useState)(0),[A,v]=(0,o.useState)(0),[T,N]=(0,o.useState)(0),[b,F]=(0,o.useState)(""),[M,P]=(0,o.useState)(""),[I,O]=(0,o.useState)([]),[D,R]=(0,o.useState)([]),[j,w]=(0,o.useState)(!1),[L,U]=(0,o.useState)(null),H=(0,o.useRef)(null),B=function(e){i(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info")};(0,o.useEffect)(()=>{(async()=>{try{console.log("\ud83d\udd04 Loading universities...");const e=await(0,s.Hk)();console.log("\u2705 Universities loaded:",e),O(e)}catch(e){console.error("\u274c Failed to load universities:",e)}})()},[]),(0,o.useEffect)(()=>{(async()=>{if(!b)return R([]),void P("");try{const e=await(0,s.cv)(b);if(R(e),null!==L&&void 0!==L&&L.faculty&&e.length>0){const t=p(L.faculty,e);t&&(P(t),B("\u2713 Auto-filled: University & Faculty detected from PDF","success"))}}catch(e){console.error("Failed to load faculties:",e),R([])}})()},[b,null===L||void 0===L?void 0:L.faculty]);const k=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{console.log("\ud83d\udd04 Extracting metadata from PDF:",e.name);const o=await c(e);U(o),console.log("\ud83d\udcc4 Extracted from PDF:",o);const i=t||I;let a=null;if(o.university&&i.length>0&&(console.log("\ud83d\udd0d Attempting to match university:",o.university),a=u(o.university,i),console.log("\u2705 Matched university ID:",a),a&&F(a)),a&&o.faculty){console.log("\ud83d\udd0d Attempting to match faculty:",o.faculty);try{const e=await(0,s.cv)(a);if(e.length>0){const t=p(o.faculty,e);t&&(P(t),console.log("\u2705 Matched faculty:",t))}}catch(n){console.warn("\u26a0\ufe0f Could not fetch faculties:",n)}}B("\u2705 Metadata extracted - ready to upload","success")}catch(n){console.error("\u26a0\ufe0f Extraction error:",n),B("\u2705 Ready to upload (using filename extraction)","success")}},G=S.total>0?S.current/S.total*100:0,_=r.reduce((e,t)=>e+t.size,0)/1024/1024;return(0,x.jsxs)("div",{className:"panel",children:[(0,x.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,x.jsx)("h2",{style:{color:"#e9edef",fontSize:"20px",fontWeight:"600",margin:"0 0 8px 0"},children:"Bulk Upload Past Papers from Folder"}),(0,x.jsx)("p",{style:{color:"#8696a0",fontSize:"13px",margin:"0"},children:"Select a folder to upload multiple past papers with automatic metadata extraction"})]}),n&&(0,x.jsx)("div",{style:{marginBottom:"15px",padding:"10px 12px",background:"#1f2c33",border:"1px solid #00a884",borderRadius:"6px",color:"#00a884",fontSize:"12px"},children:"\ud83d\udccb Your uploads will be reviewed and appear after approval"}),0===r.length?(0,x.jsxs)("div",{onDragOver:e=>{e.preventDefault(),e.stopPropagation(),f(!0)},onDragLeave:e=>{e.preventDefault(),e.stopPropagation(),f(!1)},onDrop:e=>{e.preventDefault(),e.stopPropagation(),f(!1);const t=e.dataTransfer.items,n=[];if(t)for(let o=0;o<t.length;o++){const e=t[o];if("file"===e.kind){const t=e.getAsFile();t.name.toLowerCase().endsWith(".pdf")&&n.push(t)}}if(0===n.length)return void B("No PDF files found","error");l(n),B("Found ".concat(n.length," PDF files"),"success"),w(!1);(async()=>{let e=I;if(!e||0===e.length){console.log("\u23f3 Universities not loaded yet, loading now...");try{e=await(0,s.Hk)({forceRefresh:!0}),console.log("\u2705 Universities loaded during extraction:",e),O(e)}catch(t){return console.error("\u274c Failed to load universities during extraction:",t),void B("Failed to load universities - please try again","error")}}k(n[0],e)})()},onClick:()=>{var e;return null===(e=H.current)||void 0===e?void 0:e.click()},style:{border:"2px dashed ".concat(d?"#00a884":"#374151"),borderRadius:"8px",padding:"40px 20px",textAlign:"center",cursor:"pointer",background:d?"rgba(0, 168, 132, 0.08)":"#0b141a",transition:"all 0.2s"},children:[(0,x.jsx)(a.UDU,{size:40,style:{color:"#00a884",marginBottom:"12px"}}),(0,x.jsx)("h3",{style:{color:"#e9edef",fontSize:"16px",fontWeight:"500",margin:"0 0 4px 0"},children:"Select Folder or Drag & Drop"}),(0,x.jsx)("p",{style:{color:"#8696a0",fontSize:"13px",margin:"0"},children:"Choose a folder with past paper PDF files"}),(0,x.jsx)("input",{ref:H,type:"file",webkitdirectory:"true",directory:"",multiple:!0,onChange:e=>{const t=Array.from(e.target.files||[]).filter(e=>e.name.toLowerCase().endsWith(".pdf"));if(0===t.length)return void B("No PDF files found in selected folder","error");l(t),B("Found ".concat(t.length," PDF files"),"success"),w(!1);(async()=>{let e=I;if(!e||0===e.length){console.log("\u23f3 Universities not loaded yet, loading now...");try{e=await(0,s.Hk)({forceRefresh:!0}),console.log("\u2705 Universities loaded during extraction:",e),O(e)}catch(n){return console.error("\u274c Failed to load universities during extraction:",n),void B("Failed to load universities - please try again","error")}}k(t[0],e)})()},style:{display:"none"},accept:".pdf"})]}):(0,x.jsxs)(x.Fragment,{children:[(0,x.jsxs)("div",{style:{background:"#0b141a",border:"1px solid #1f2c33",borderRadius:"8px",marginBottom:"20px",overflow:"hidden"},children:[(0,x.jsx)("div",{style:{padding:"12px 16px",borderBottom:"1px solid #1f2c33",background:"#0b141a"},children:(0,x.jsxs)("div",{style:{color:"#e9edef",fontSize:"13px",fontWeight:"500"},children:["Files (",r.length,") \u2022 ",_.toFixed(1)," MB"]})}),(0,x.jsx)("div",{style:{maxHeight:"250px",overflowY:"auto"},children:r.map((e,t)=>(0,x.jsxs)("div",{style:{display:"flex",alignItems:"center",padding:"10px 16px",borderBottom:"1px solid #1f2c33",color:"#8696a0",fontSize:"12px"},children:[(0,x.jsx)(a.QuH,{size:14,style:{marginRight:"8px",color:"#00a884"}}),(0,x.jsx)("span",{style:{flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.name}),(0,x.jsxs)("span",{style:{marginLeft:"8px",color:"#374151"},children:[(e.size/1024/1024).toFixed(1)," MB"]})]},t))})]}),m&&(0,x.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,x.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"8px",color:"#8696a0",fontSize:"12px"},children:[(0,x.jsx)("span",{children:"Uploading..."}),(0,x.jsxs)("span",{children:[S.current," of ",S.total]})]}),(0,x.jsx)("div",{style:{width:"100%",height:"6px",background:"#1f2c33",borderRadius:"3px",overflow:"hidden"},children:(0,x.jsx)("div",{style:{height:"100%",width:"".concat(G,"%"),background:"#00a884",transition:"width 0.3s"}})}),h>0&&(0,x.jsxs)("div",{style:{marginTop:"8px",color:"#00a884",fontSize:"12px"},children:["\u2713 ",h," uploaded"]}),A>0&&(0,x.jsxs)("div",{style:{marginTop:"4px",color:"#ea4335",fontSize:"12px"},children:["\u2717 ",A," failed"]})]}),(0,x.jsx)("div",{style:{display:"flex",gap:"12px"},children:!m&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsxs)("button",{onClick:async()=>{if(0===r.length)return void B("No files selected","error");y(!0),E({current:0,total:r.length}),C(0),v(0),N(0);let e=0,o=0,i=0;for(let l=0;l<r.length;l++){const d=r[l];E({current:l+1,total:r.length});let x=null;try{const o=d.name.replace(".pdf","").trim();let r=o.split("_"),l="",m="",y="",S="",E="";if(console.log("\ud83d\udccb Parsing filename:",o,"Parts:",r,"Parts length:",r.length),r.length>=2)l=r[0]||"",m=r[1]||"",y=r[2]||"",S=r[3]||"",E=r[4]||"",console.log("\u2705 Using underscore format - code:",l,"name:",m,"year:",y);else{console.log("\ud83d\udd04 Trying space-separated parsing...");try{const e=o.match(/\b(19|20)\d{2}\b/);y=e?e[0]:"",console.log("\ud83d\udcc5 Extracted year:",y);let t=o.match(/\b([A-Z]{2,4})\s+(\d{3,4})\b/i);if(t){const e=t[1],n=t[2];m=e,l=n,console.log("\ud83d\udd24 Extracted - Name:",m,"Code:",l,"from:",t[0])}else if(t=o.match(/\b([A-Z]{3})\s+([A-Z]{2,4})\s+(\d{3,4})\b/i),t){const e=t[2],n=t[3];m=e,l=n,console.log("\ud83d\udd24 Extracted with prefix - Prefix:",t[1],"Name:",m,"Code:",l,"from:",t[0])}else m=o,console.log("\u26a0\ufe0f Could not extract code, using filename as name:",m)}catch(p){console.warn("\u26a0\ufe0f Error parsing filename:",p),m=o}}console.log("\ud83d\udcca Final parsed metadata:",{unit_code:l,unit_name:m,year:y,semester:S,exam_type:E});let h=b||null;if(!h){const e=new Set(["AGEC","AGBM","ANSC","APHY","CROP","HORT","SOIL","LPBP","DAIR","FOST","AENG","ENTM","AGRI","ECON","BECO","STAT","LITL","ENGL","KISW","LINS","FREN","GERM","CRSS","SOCI","PSCS","PHIL","HIST","RELI","ANTH","LIBS","COMM","BACT","BFIN","BOPM","BBIS","BMGT","BBAM","BCOM","PROC","ENTR","HRM","MARK","AGED","ACDS","ADSN","CDEV","CIEM","BUST","EPSC","EDFO","EDUC","MENT","PSYC","GUID","COUN","ECD","SPEC","AGEN","CEEN","ECEN","IEEN","MEEN","WREN","BENG","CENG","SENG","EENG","PENG","TENG","MENG","COMP","ICT","CSCI","DATA","SOFT","NETS","ENVS","GEOG","NRES","FRST","DRLM","WILD","ECOT","WEM","LAND","ENVI","ENMS","CLEE","WRES","FRES","SWCO","CONS","NARE","ANAT","PHYS","PATH","NURS","NUTR","COMH","REPH","PEDI","IMED","SURG","CLIN","EPID","MICB","MED","MEDS","PHAR","PHARM","CHEM","DENT","DRES","PUHE","LAW","LLB","CLAW","PLAW","ILWA","LAWI","LAWS","BIOL","ZOO","BOT","BCMB","ORGA","INOR","PHCH","MECH","ELEC","OPTI","BIO","ZOOL","ECOL","GENT","ALGE","CALC","GEOL","MING","GEOM","VAPH","VMTP","VPMP","VETA","PARA","ANAV","VMED","VETS","VSUR","DVSO","VPAT","VPHE","DVET","VANA","VPHY"]),t=m.replace(/\d+/g,"").toUpperCase().trim();if(e.has(t)){console.log("\u2705 Detected Egerton University from unit code:",t);const e=I.find(e=>{var t;return null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes("egerton")});e&&(h=e.id,console.log("\u2705 Auto-set Egerton University ID:",h))}}!h&&null!==L&&void 0!==L&&L.university&&(h=u(L.university,I),h&&console.log("\u2705 Using extracted university:",h));const A={AGEC:"Agriculture",AGBM:"Agriculture",ANSC:"Agriculture",APHY:"Agriculture",CROP:"Agriculture",HORT:"Agriculture",SOIL:"Agriculture",LPBP:"Agriculture",DAIR:"Agriculture",FOST:"Agriculture",AENG:"Agriculture",ENTM:"Agriculture",AGRI:"Agriculture",ECON:"FASS",BECO:"FASS",STAT:"FASS",LITL:"FASS",ENGL:"FASS",KISW:"FASS",LINS:"FASS",FREN:"FASS",GERM:"FASS",CRSS:"FASS",SOCI:"FASS",PSCS:"FASS",PHIL:"FASS",HIST:"FASS",RELI:"FASS",ANTH:"FASS",LIBS:"FASS",COMM:"FASS",BACT:"Commerce",BFIN:"Commerce",BOPM:"Commerce",BBIS:"Commerce",BMGT:"Commerce",BBAM:"Commerce",BCOM:"Commerce",PROC:"Commerce",ENTR:"Commerce",HRM:"Commerce",MARK:"Commerce",AGED:"FEDCOS",ACDS:"FEDCOS",ADSN:"FEDCOS",CDEV:"FEDCOS",CIEM:"FEDCOS",BUST:"FEDCOS",EPSC:"FEDCOS",EDFO:"FEDCOS",EDUC:"FEDCOS",MENT:"FEDCOS",PSYC:"FEDCOS",GUID:"FEDCOS",COUN:"FEDCOS",ECD:"FEDCOS",SPEC:"FEDCOS",AGEN:"FET",CEEN:"FET",ECEN:"FET",IEEN:"FET",MEEN:"FET",WREN:"FET",BENG:"FET",CENG:"FET",SENG:"FET",EENG:"FET",PENG:"FET",TENG:"FET",MENG:"FET",COMP:"FET",ICT:"FET",CSCI:"FET",DATA:"FET",SOFT:"FET",NETS:"FET",ENVS:"FERD",GEOG:"FERD",NRES:"FERD",FRST:"FERD",DRLM:"FERD",WILD:"FERD",ECOT:"FERD",WEM:"FERD",LAND:"FERD",ENVI:"FERD",ENMS:"FERD",CLEE:"FERD",WRES:"FERD",FRES:"FERD",SWCO:"FERD",CONS:"FERD",NARE:"FERD",ANAT:"Health Sciences",PHYS:"Health Sciences",PATH:"Health Sciences",NURS:"Health Sciences",NUTR:"Health Sciences",COMH:"Health Sciences",REPH:"Health Sciences",PEDI:"Health Sciences",IMED:"Health Sciences",SURG:"Health Sciences",CLIN:"Health Sciences",EPID:"Health Sciences",MICB:"Health Sciences",MED:"Health Sciences",MEDS:"Health Sciences",PHAR:"Health Sciences",PHARM:"Health Sciences",CHEM:"Health Sciences",DENT:"Health Sciences",DRES:"Health Sciences",PUHE:"Health Sciences",LAW:"Law",LLB:"Law",CLAW:"Law",PLAW:"Law",ILWA:"Law",LAWI:"Law",LAWS:"Law",BIOL:"Science",ZOO:"Science",BOT:"Science",BCMB:"Science",CHEM:"Science",COMP:"Science",MATH:"Science",STAT:"Science",PHYS:"Science",MET:"Science",ORGA:"Science",INOR:"Science",PHCH:"Science",MECH:"Science",ELEC:"Science",OPTI:"Science",BIO:"Science",ZOOL:"Science",ECOL:"Science",GENT:"Science",ALGE:"Science",CALC:"Science",GEOL:"Science",MING:"Science",GEOM:"Science",VAPH:"Veterinary Medicine and Surgery",VMTP:"Veterinary Medicine and Surgery",VPMP:"Veterinary Medicine and Surgery",VETA:"Veterinary Medicine and Surgery",PARA:"Veterinary Medicine and Surgery",ANAV:"Veterinary Medicine and Surgery",VMED:"Veterinary Medicine and Surgery",VETS:"Veterinary Medicine and Surgery",VSUR:"Veterinary Medicine and Surgery",DVSO:"Veterinary Medicine and Surgery",VPAT:"Veterinary Medicine and Surgery",VPHE:"Veterinary Medicine and Surgery",DVET:"Veterinary Medicine and Surgery",VANA:"Veterinary Medicine and Surgery",VPHY:"Veterinary Medicine and Surgery"},v=e=>{if(!e)return null;const t=A[e];return t?(console.log('\u2705 Egerton verified: "'+e+'" \u2192 '+t),t):(console.log('\u274c Unknown Egerton unit code: "'+e+'"'),null)};let T=M||(null===L||void 0===L?void 0:L.faculty);if(!T&&h&&l)try{const e=I.find(e=>e.id===h);if(null!==e&&void 0!==e&&e.name){console.log("\ud83d\udd0d Searching Google for faculty of",l,"at",e.name);const t=await(0,s.fv)(e.name,l,m);null!==t&&void 0!==t&&t.faculty?(T=t.faculty,console.log("\ud83c\udf10 Found faculty via Google Search:",T)):console.log("\u2139\ufe0f Google Search did not find faculty, trying smart Egerton detection")}}catch(f){console.warn("\u26a0\ufe0f Google Search failed, trying smart Egerton detection:",f)}if(!T&&m){const e=m.replace(/\d+/g,"").toUpperCase().trim();T=v(e),T||console.log('\u26a0\ufe0f Egerton strict mode: Unknown unit code "'+e+'", marking for manual review')}!T&&m&&(T=g(l,m),T&&console.log("\ud83c\udfaf Guessed faculty from unit code:",T)),T=T||"Unknown";let F=h;if(!F&&I.length>0){const e=I.find(e=>{var t;return null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes("egerton")});var a,c;if(e)F=e.id,console.log("\u26a0\ufe0f No university detected, defaulting to Egerton:",e.id);else F=null===(a=I[0])||void 0===a?void 0:a.id,console.log("\u26a0\ufe0f No university detected, using first available:",null===(c=I[0])||void 0===c?void 0:c.name,F)}x={university_id:F||null,faculty:T,unit_code:l||(null===L||void 0===L?void 0:L.unitCode)||"",unit_name:m||(null===L||void 0===L?void 0:L.unitName)||"",year:y&&!isNaN(y)?Number(y):(null===L||void 0===L?void 0:L.year)||(new Date).getFullYear(),semester:S||(null===L||void 0===L?void 0:L.semester)||"",exam_type:E||(null===L||void 0===L?void 0:L.examType)||"Main",uploaded_by:(null===t||void 0===t?void 0:t.id)||(null===t||void 0===t?void 0:t.uid)||null},console.log("\ud83d\udce4 Uploading with metadata:",{fileName:d.name,universityId:x.university_id,faculty:x.faculty,unitCode:x.unit_code,unitName:x.unit_name,year:x.year,semester:x.semester,examType:x.exam_type}),console.log("\ud83d\udce4 Using createPastPaper API to upload:",{fileName:d.name,metadata:{title:"".concat(x.unit_code," - ").concat(x.unit_name),university_id:x.university_id,faculty:x.faculty,unit_code:x.unit_code,unit_name:x.unit_name,year:x.year,semester:x.semester,exam_type:x.exam_type}}),console.log("\ud83d\udd0d Checking for duplicate papers...");const P=await(0,s.QK)({universityId:x.university_id,faculty:x.faculty,unitCode:x.unit_code,unitName:x.unit_name,year:x.year});if(P.exists){console.log("\u26a0\ufe0f DUPLICATE DETECTED - Paper already exists!",P.paper),await(0,s.u6)({fileName:d.name,status:"duplicate",paperTitle:"".concat(x.unit_code," - ").concat(x.unit_name),universityId:x.university_id,faculty:x.faculty,unitCode:x.unit_code,unitName:x.unit_name,year:x.year,uploadedBy:null===t||void 0===t?void 0:t.id,isDuplicate:!0}),i++,N(i),B('\u23ed\ufe0f Skipped "'.concat(d.name,'" - Paper already uploaded (').concat(P.paper.unit_code," ").concat(P.paper.unit_name," ").concat(P.paper.year,")"),"warning");continue}console.log("\u2705 No duplicate found, proceeding with upload...");const O=n?s.Jw:s.DT,D=await O({metadata:{title:"".concat(x.unit_code," - ").concat(x.unit_name),university_id:x.university_id,faculty:x.faculty,unit_code:x.unit_code,unit_name:x.unit_name,year:x.year,semester:x.semester,exam_type:x.exam_type},pdfFile:d});console.log("\u2705 Uploaded successfully:",{fileName:d.name,pastPaperId:null===D||void 0===D?void 0:D.id}),await(0,s.u6)({fileName:d.name,status:"success",paperTitle:"".concat(x.unit_code," - ").concat(x.unit_name),universityId:x.university_id,faculty:x.faculty,unitCode:x.unit_code,unitName:x.unit_name,year:x.year,uploadedBy:null===t||void 0===t?void 0:t.id}),e++,C(e),console.log("\u2705 Uploaded: ".concat(d.name));try{(0,s.T7)()}catch(p){}}catch(f){console.error("\u274c Failed to upload ".concat(d.name,":"),f),console.error("Error details:",{message:null===f||void 0===f?void 0:f.message,code:null===f||void 0===f?void 0:f.code,stack:null===f||void 0===f?void 0:f.stack}),await(0,s.u6)({fileName:d.name,status:"failed",paperTitle:"".concat(x.unit_code," - ").concat(x.unit_name),universityId:x.university_id,faculty:x.faculty,unitCode:x.unit_code,unitName:x.unit_name,year:x.year,uploadedBy:null===t||void 0===t?void 0:t.id,errorMessage:(null===f||void 0===f?void 0:f.message)||"Unknown error"}).catch(e=>console.error("Failed to log error history:",e)),o++,v(o)}}y(!1);try{(0,s.T7)()}catch(p){}let d="Upload complete: ".concat(e," successful, ").concat(i," duplicates skipped, ").concat(o," failed");o>0&&(d+=" \u274c Check browser console for error details");B(d,0===o?"success":i>0?"warning":"error"),setTimeout(()=>{l([]),E({current:0,total:0}),F(""),P(""),U(null),w(!1)},2e3)},disabled:0===r.length,style:{flex:1,padding:"10px 16px",background:0===r.length?"#374151":"#00a884",color:"#fff",border:"none",borderRadius:"6px",cursor:0===r.length?"not-allowed":"pointer",fontSize:"14px",fontWeight:"500",transition:"background 0.2s"},children:["\ud83d\ude80 Upload ",r.length," Files"]}),(0,x.jsx)("button",{onClick:()=>{l([]),E({current:0,total:0}),C(0),v(0),F(""),P(""),U(null),w(!1),H.current&&(H.current.value="")},style:{padding:"10px 16px",background:"#374151",color:"#e9edef",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"14px"},children:"Cancel"})]})})]}),(0,x.jsxs)("div",{style:{marginTop:"20px",padding:"12px 16px",background:"#1f2c33",border:"1px solid #374151",borderRadius:"6px",color:"#8696a0",fontSize:"12px",lineHeight:"1.6"},children:[(0,x.jsx)("strong",{style:{color:"#e9edef"},children:"\ud83e\udd16 Fully Automatic Extraction:"}),(0,x.jsx)("br",{}),"\u2705 ",(0,x.jsx)("strong",{children:"No manual selection needed!"})," Just select folder and upload",(0,x.jsx)("br",{}),"\u2713 University & Faculty automatically extracted from PDF text",(0,x.jsx)("br",{}),"\u2713 Unit Code, Year, Semester automatically extracted from filename: ",(0,x.jsx)("code",{style:{background:"#0b141a",padding:"2px 4px",borderRadius:"3px"},children:"UNITCODE_Name_2023_1_Main.pdf"}),(0,x.jsx)("br",{}),"\u2713 If PDF extraction fails, filename extraction is used as fallback",(0,x.jsx)("br",{}),(0,x.jsx)("br",{}),(0,x.jsx)("strong",{children:"Best Results:"}),' Include "University Name" and "Faculty Name" on the first page of your PDF']})]})},S=e=>{let{userProfile:t,asSubmission:n=!1}=e;const r=(0,i.Zp)(),[s,l]=(0,o.useState)("books"),[c,d]=(0,o.useState)(null),u=function(e){d({message:e,type:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info"}),setTimeout(()=>d(null),4e3)};return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("style",{children:"\n    .autoupload-tabs-container {\n      display: flex;\n      gap: 8px;\n      margin-bottom: 20px;\n      border-bottom: 2px solid #374151;\n    }\n    .autoupload-tab-button {\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      padding: 12px 24px;\n      background: transparent;\n      border: none;\n      color: #8696a0;\n      cursor: pointer;\n      font-size: 15px;\n      font-weight: 500;\n      transition: all 0.3s ease;\n      border-bottom: 3px solid transparent;\n      margin-bottom: -2px;\n    }\n    .autoupload-tab-button:hover {\n      color: #e9edef;\n      background: rgba(0, 168, 132, 0.05);\n    }\n    .autoupload-tab-button.active {\n      color: #00a884;\n      border-bottom-color: #00a884;\n    }\n  "}),(0,x.jsxs)("div",{className:"panel",children:[(0,x.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[(0,x.jsxs)("div",{className:"autoupload-tabs-container",children:[(0,x.jsxs)("button",{className:"autoupload-tab-button ".concat("books"===s?"active":""),onClick:()=>l("books"),children:[(0,x.jsx)(a.H9b,{size:18}),"Books Auto Upload"]}),(0,x.jsxs)("button",{className:"autoupload-tab-button ".concat("pastpapers"===s?"active":""),onClick:()=>l("pastpapers"),children:[(0,x.jsx)(a.jH2,{size:18}),"Past Papers Auto Upload"]})]}),(0,x.jsxs)("button",{onClick:()=>r("/books/admin/upload-history"),style:{display:"flex",alignItems:"center",gap:"8px",padding:"8px 16px",background:"#0a1419",color:"#e9edef",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"14px",fontWeight:"500",transition:"all 0.2s",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.4)"},onMouseEnter:e=>{e.target.style.background="#121f28",e.target.style.boxShadow="0 4px 8px rgba(0, 0, 0, 0.6)"},onMouseLeave:e=>{e.target.style.background="#0a1419",e.target.style.boxShadow="0 2px 4px rgba(0, 0, 0, 0.4)"},children:[(0,x.jsx)(a.Ohp,{size:16}),"History"]})]}),(0,x.jsxs)("div",{style:{marginTop:"20px"},children:["books"===s&&(0,x.jsx)(m,{userProfile:t,asSubmission:n,showToast:u}),"pastpapers"===s&&(0,x.jsx)(y,{userProfile:t,asSubmission:n,showToast:u})]})]}),c&&(0,x.jsxs)("div",{style:{position:"fixed",bottom:"20px",right:"20px",maxWidth:"300px",width:"calc(100% - 40px)",background:"error"===c.type?"#ea4335":"success"===c.type?"#00a884":"#374151",color:"#fff",padding:"12px 16px",borderRadius:"6px",zIndex:10001,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",display:"flex",alignItems:"center",gap:"8px",fontSize:"13px",animation:"slideIn 0.3s ease"},children:["success"===c.type?"\u2713":"error"===c.type?"\u2717":"\u2139"," ",c.message]}),(0,x.jsx)("style",{children:"\n        @keyframes slideIn {\n          from {\n            transform: translateY(20px);\n            opacity: 0;\n          }\n          to {\n            transform: translateY(0);\n            opacity: 1;\n          }\n        }\n      "})]})}}}]);
//# sourceMappingURL=899.569cf1bb.chunk.js.map