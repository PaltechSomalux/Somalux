"use strict";(self.webpackChunkcampuslife=self.webpackChunkcampuslife||[]).push([[767],{1767:(e,t,s)=>{s.r(t),s.d(t,{default:()=>y});var a=s(5043),l=s(4218),n=s(5200),i=s(9379),o=s(3515),r=s(9101),c=s(579);const d=e=>{let{userProfile:t}=e;const[s,l]=(0,a.useState)(!0),[n,d]=(0,a.useState)([]),[u,h]=(0,a.useState)(0),[m,p]=(0,a.useState)(1),[x]=(0,a.useState)(10),[v,g]=(0,a.useState)(""),[j,b]=(0,a.useState)([]),[y,f]=(0,a.useState)(null),[w,N]=(0,a.useState)({col:"created_at",dir:"desc"}),[k,_]=(0,a.useState)(null),[C,S]=(0,a.useState)({}),[A,F]=(0,a.useState)(null),[L,P]=(0,a.useState)(null),{confirm:B,showToast:E}=(0,r.v)(),T=["campuslives254@gmail.com","paltechsomalux@gmail.com"],D="admin"===(null===t||void 0===t?void 0:t.role)||T.includes(null===t||void 0===t?void 0:t.email),R="editor"===(null===t||void 0===t?void 0:t.role)||T.includes(null===t||void 0===t?void 0:t.email),z=(0,a.useMemo)(()=>Math.max(1,Math.ceil(u/x)),[u,x]),M=async()=>{l(!0);try{const{data:e,count:t}=await(0,o.x1)({page:m,pageSize:x,search:v,categoryId:y,sort:w});d(e),h(t)}finally{l(!1)}};(0,a.useEffect)(()=>{(async()=>{try{b(await(0,o.jE)())}catch(e){}t&&await M()})()},[m,v,y,w.col,w.dir,t]);const I=e=>!!D||!!R,W=()=>{_(null),S({}),F(null),P(null)},U=e=>{N(t=>t.col===e?{col:e,dir:"asc"===t.dir?"desc":"asc"}:{col:e,dir:"asc"})};return(0,c.jsx)("div",{children:(0,c.jsxs)("div",{className:"panel",children:[(0,c.jsx)("div",{className:"panel-title",children:"Books Management"}),!s&&n.length>0&&(0,c.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:"8px",marginBottom:"12px"},children:[(0,c.jsxs)("div",{style:{background:"#1a2332",border:"1px solid #2a3f56",borderRadius:"6px",padding:"8px 12px",color:"#8696a0",fontSize:"0.85rem"},children:[(0,c.jsx)("div",{style:{color:"#00a884",fontSize:"1.2rem",fontWeight:"600"},children:n.reduce((e,t)=>e+(t.downloads||0),0)}),(0,c.jsx)("div",{children:"Total Downloads"})]}),(0,c.jsxs)("div",{style:{background:"#1a2332",border:"1px solid #2a3f56",borderRadius:"6px",padding:"8px 12px",color:"#8696a0",fontSize:"0.85rem"},children:[(0,c.jsx)("div",{style:{color:"#34B7F1",fontSize:"1.2rem",fontWeight:"600"},children:n.reduce((e,t)=>e+(t.views||0),0)}),(0,c.jsx)("div",{children:"Total Views"})]}),(0,c.jsxs)("div",{style:{background:"#1a2332",border:"1px solid #2a3f56",borderRadius:"6px",padding:"8px 12px",color:"#8696a0",fontSize:"0.85rem"},children:[(0,c.jsx)("div",{style:{color:"#FF6B9D",fontSize:"1.2rem",fontWeight:"600"},children:n.reduce((e,t)=>e+(t.comments_count||0),0)}),(0,c.jsx)("div",{children:"Total Comments"})]}),(0,c.jsxs)("div",{style:{background:"#1a2332",border:"1px solid #2a3f56",borderRadius:"6px",padding:"8px 12px",color:"#8696a0",fontSize:"0.85rem"},children:[(0,c.jsx)("div",{style:{color:"#F44336",fontSize:"1.2rem",fontWeight:"600"},children:n.reduce((e,t)=>e+(t.likes_count||0),0)}),(0,c.jsx)("div",{children:"Total Likes"})]}),(0,c.jsxs)("div",{style:{background:"#1a2332",border:"1px solid #2a3f56",borderRadius:"6px",padding:"8px 12px",color:"#8696a0",fontSize:"0.85rem"},children:[(0,c.jsxs)("div",{style:{color:"#FFCC00",fontSize:"1.2rem",fontWeight:"600"},children:[n.length,"/",u]}),(0,c.jsx)("div",{children:"Page Books"})]})]}),(0,c.jsxs)("div",{className:"grid-2",style:{marginBottom:6},children:[(0,c.jsxs)("div",{className:"panel",style:{padding:"6px 8px"},children:[(0,c.jsx)("label",{className:"label",style:{marginBottom:"0.2rem"},children:"Search"}),(0,c.jsx)("input",{className:"input",value:v,onChange:e=>{p(1),g(e.target.value)},placeholder:"Search by title...",style:{fontSize:"0.9rem"}})]}),(0,c.jsxs)("div",{className:"panel",style:{padding:"6px 8px"},children:[(0,c.jsx)("label",{className:"label",style:{marginBottom:"0.2rem"},children:"Category"}),(0,c.jsxs)("select",{className:"select",value:y||"",onChange:e=>{p(1),f(e.target.value||null)},style:{fontSize:"0.9rem"},children:[(0,c.jsx)("option",{value:"",children:"All"}),j.map(e=>(0,c.jsx)("option",{value:e.id,children:e.name},e.id))]})]})]}),(0,c.jsx)("div",{className:"actions",style:{marginBottom:10},children:(0,c.jsx)("button",{className:"btn primary",onClick:()=>window.location.href="/books/admin/upload",children:"Add / Upload New Book"})}),(0,c.jsx)("div",{className:"panel",style:{padding:0,overflowX:"auto",WebkitOverflowScrolling:"touch"},children:(0,c.jsxs)("table",{className:"table",style:{minWidth:"1620px",borderCollapse:"separate",borderSpacing:0},children:[(0,c.jsx)("thead",{children:(0,c.jsxs)("tr",{children:[(0,c.jsx)("th",{style:{width:"60px"},children:"Cover"}),(0,c.jsxs)("th",{style:{width:"300px",cursor:"pointer"},onClick:()=>U("title"),children:["Title ","title"===w.col?"asc"===w.dir?"\u25b2":"\u25bc":""]}),(0,c.jsxs)("th",{style:{width:"200px",cursor:"pointer"},onClick:()=>U("author"),children:["Author ","author"===w.col?"asc"===w.dir?"\u25b2":"\u25bc":""]}),(0,c.jsx)("th",{style:{width:"120px"},children:"Category"}),(0,c.jsxs)("th",{style:{width:"100px",cursor:"pointer"},onClick:()=>U("year"),children:["Year ","year"===w.col?"asc"===w.dir?"\u25b2":"\u25bc":""]}),(0,c.jsx)("th",{style:{width:"100px"},children:"Pages"}),(0,c.jsx)("th",{style:{width:"180px"},children:"Publisher"}),(0,c.jsxs)("th",{style:{width:"100px",cursor:"pointer"},onClick:()=>U("downloads"),children:["Downloads ","downloads"===w.col?"asc"===w.dir?"\u25b2":"\u25bc":""]}),(0,c.jsxs)("th",{style:{width:"80px",cursor:"pointer",background:"rgba(52, 183, 241, 0.1)",borderBottom:"2px solid #34B7F1"},onClick:()=>U("views"),children:["Views ","views"===w.col?"asc"===w.dir?"\u25b2":"\u25bc":""]}),(0,c.jsxs)("th",{style:{width:"80px",cursor:"pointer",background:"rgba(255, 107, 157, 0.1)",borderBottom:"2px solid #FF6B9D"},onClick:()=>U("comments_count"),children:["Comments ","comments_count"===w.col?"asc"===w.dir?"\u25b2":"\u25bc":""]}),(0,c.jsxs)("th",{style:{width:"80px",cursor:"pointer",background:"rgba(244, 67, 54, 0.1)",borderBottom:"2px solid #F44336"},onClick:()=>U("likes_count"),children:["Likes ","likes_count"===w.col?"asc"===w.dir?"\u25b2":"\u25bc":""]}),(0,c.jsx)("th",{style:{width:"100px"},children:"Date Added"}),(0,c.jsx)("th",{style:{width:"200px"},children:"Actions"})]})}),(0,c.jsx)("tbody",{children:s?(0,c.jsx)("tr",{children:(0,c.jsx)("td",{colSpan:13,style:{color:"#8696a0",textAlign:"center"},children:"Loading..."})}):0===n.length?(0,c.jsx)("tr",{children:(0,c.jsx)("td",{colSpan:13,style:{color:"#8696a0",textAlign:"center"},children:"No data"})}):n.map(e=>{var t;return(0,c.jsxs)("tr",{children:[(0,c.jsx)("td",{children:e.cover_url?(0,c.jsx)("img",{src:e.cover_url,alt:"cover",style:{width:36,height:48,objectFit:"cover",borderRadius:4}}):(0,c.jsx)("span",{className:"badge",children:"No cover"})}),(0,c.jsx)("td",{children:k===e.id?(0,c.jsx)("input",{className:"input",value:C.title,onChange:e=>S((0,i.A)((0,i.A)({},C),{},{title:e.target.value}))}):e.title}),(0,c.jsx)("td",{children:k===e.id?(0,c.jsx)("input",{className:"input",value:C.author,onChange:e=>S((0,i.A)((0,i.A)({},C),{},{author:e.target.value}))}):e.author}),(0,c.jsx)("td",{children:k===e.id?(0,c.jsxs)("select",{className:"select",value:C.category_id||"",onChange:e=>S((0,i.A)((0,i.A)({},C),{},{category_id:e.target.value||null})),children:[(0,c.jsx)("option",{value:"",children:"Uncategorized"}),j.map(e=>(0,c.jsx)("option",{value:e.id,children:e.name},e.id))]}):(null===(t=j.find(t=>t.id===e.category_id))||void 0===t?void 0:t.name)||"\u2014"}),(0,c.jsx)("td",{children:k===e.id?(0,c.jsx)("input",{className:"input",value:C.year,onChange:e=>S((0,i.A)((0,i.A)({},C),{},{year:e.target.value}))}):e.year||"\u2014"}),(0,c.jsx)("td",{children:k===e.id?(0,c.jsx)("input",{className:"input",type:"number",placeholder:"Pages",value:C.pages,onChange:e=>S((0,i.A)((0,i.A)({},C),{},{pages:e.target.value}))}):e.pages||"\u2014"}),(0,c.jsx)("td",{children:k===e.id?(0,c.jsx)("input",{className:"input",placeholder:"Publisher",value:C.publisher,onChange:e=>S((0,i.A)((0,i.A)({},C),{},{publisher:e.target.value}))}):e.publisher||"\u2014"}),(0,c.jsx)("td",{children:e.downloads||0}),(0,c.jsx)("td",{style:{fontWeight:"500",color:"#00a884"},children:e.views||0}),(0,c.jsx)("td",{style:{fontWeight:"500",color:"#FF6B9D"},children:e.comments_count||0}),(0,c.jsx)("td",{style:{fontWeight:"500",color:"#F44336"},children:e.likes_count||0}),(0,c.jsx)("td",{children:new Date(e.created_at).toLocaleDateString()}),(0,c.jsx)("td",{children:k===e.id?(0,c.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"10px",minWidth:"180px"},children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"label",children:"Replace PDF"}),(0,c.jsxs)("div",{className:"file-upload-btn",onClick:()=>document.getElementById("pdf-input-".concat(e.id)).click(),style:{border:"1px solid #374151",borderRadius:"6px",padding:"6px 12px",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",background:A?"rgba(0, 168, 132, 0.1)":"transparent",color:A?"#00a884":"#e9edef",transition:"all 0.2s"},children:[(0,c.jsx)("input",{id:"pdf-input-".concat(e.id),type:"file",accept:"application/pdf",onChange:e=>{var t;return F((null===(t=e.target.files)||void 0===t?void 0:t[0])||null)},style:{display:"none"}}),A?(0,c.jsxs)(c.Fragment,{children:["\ud83d\udcc4 ",A.name.slice(0,20),A.name.length>20?"...":""]}):(0,c.jsx)(c.Fragment,{children:"\ud83d\udcc4 Choose PDF"})]})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"label",children:"Replace Cover"}),(0,c.jsxs)("div",{className:"file-upload-btn",onClick:()=>document.getElementById("cover-input-".concat(e.id)).click(),style:{border:"1px solid #374151",borderRadius:"6px",padding:"6px 12px",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",background:L?"rgba(0, 168, 132, 0.1)":"transparent",color:L?"#00a884":"#e9edef",transition:"all 0.2s"},children:[(0,c.jsx)("input",{id:"cover-input-".concat(e.id),type:"file",accept:"image/*",onChange:e=>{var t;return P((null===(t=e.target.files)||void 0===t?void 0:t[0])||null)},style:{display:"none"}}),L?(0,c.jsxs)(c.Fragment,{children:["\ud83d\uddbc\ufe0f ",L.name.slice(0,20),L.name.length>20?"...":""]}):(0,c.jsx)(c.Fragment,{children:"\ud83d\uddbc\ufe0f Choose Image"})]})]}),(0,c.jsxs)("div",{style:{display:"flex",gap:"8px",marginTop:"4px"},children:[(0,c.jsx)("button",{className:"btn primary",onClick:()=>(async e=>{if(!I())return void E({type:"error",message:"You can only edit books you uploaded."});const t=(0,i.A)({},C);try{await(0,o.r3)(e.id,{updates:t,newPdfFile:A,newCoverFile:L,oldFilePath:e.file_path}),W(),await M(),E({type:"success",message:"Book details updated."})}catch(s){console.error("Failed to update book:",s),E({type:"error",message:(null===s||void 0===s?void 0:s.message)||"Failed to update book."})}})(e),children:"Save"}),(0,c.jsx)("button",{className:"btn",onClick:W,children:"Cancel"})]})]}):(0,c.jsxs)("div",{className:"actions",children:[(0,c.jsx)("button",{className:"btn",onClick:()=>(e=>{I()?(_(e.id),S({title:e.title||"",author:e.author||"",year:e.year||"",category_id:e.category_id||null,language:e.language||"",isbn:e.isbn||"",pages:e.pages||"",publisher:e.publisher||""}),F(null),P(null)):E({type:"error",message:"You do not have permission to edit this book."})})(e),disabled:!I(),children:"Edit"}),(0,c.jsx)("button",{className:"btn",onClick:()=>(async e=>{if(!I())return void E({type:"error",message:"You can only delete books you uploaded."});if(await B({title:"Delete book?",message:'Delete "'.concat(e.title,'" and its files? This action cannot be undone.'),confirmLabel:"Delete",cancelLabel:"Cancel",variant:"danger"}))try{await(0,o.HA)({id:e.id,file_path:e.file_path}),await M(),E({type:"success",message:"Book deleted."})}catch(t){console.error("Failed to delete book:",t),E({type:"error",message:(null===t||void 0===t?void 0:t.message)||"Failed to delete book."})}})(e),disabled:!I(),children:"Delete"})]})})]},e.id)})})]})}),(0,c.jsxs)("div",{className:"actions",style:{marginTop:10},children:[(0,c.jsx)("button",{className:"btn",disabled:m<=1,onClick:()=>p(e=>Math.max(1,e-1)),children:"Prev"}),(0,c.jsxs)("span",{style:{color:"#cfd8dc"},children:["Page ",m," of ",z]}),(0,c.jsx)("button",{className:"btn",disabled:m>=z,onClick:()=>p(e=>Math.min(z,e+1)),children:"Next"})]})]})})};var u=s(4972),h=(s(1903),s(9738));const m=e=>{let{userProfile:t}=e;const[s,l]=(0,a.useState)(!0),[n,o]=(0,a.useState)([]),[d,m]=(0,a.useState)(0),[p,x]=(0,a.useState)(1),[v]=(0,a.useState)(10),[g,j]=(0,a.useState)(""),[b,y]=(0,a.useState)({col:"created_at",dir:"desc"}),[f,w]=(0,a.useState)(null),[N,k]=(0,a.useState)({}),[_,C]=(0,a.useState)(null),[S,A]=(0,a.useState)({}),{confirm:F,showToast:L}=(0,r.v)(),P=["campuslives254@gmail.com","paltechsomalux@gmail.com"],B="admin"===(null===t||void 0===t?void 0:t.role)||P.includes(null===t||void 0===t?void 0:t.email),E="editor"===(null===t||void 0===t?void 0:t.role)||P.includes(null===t||void 0===t?void 0:t.email),T=(0,a.useMemo)(()=>Math.max(1,Math.ceil(d/v)),[d,v]),D=async()=>{l(!0);try{const{data:e,count:t}=await(0,u.Tm)({page:p,pageSize:v,search:g,sort:b});o(e),m(t);const s={};for(const a of e)s[a.id]=await(0,h.lb)(a.id);A(s)}finally{l(!1)}};(0,a.useEffect)(()=>{t&&D()},[p,g,b.col,b.dir,t]);const R=e=>!!B||!!E,z=()=>{w(null),k({}),C(null)},M=e=>{y(t=>t.col===e?{col:e,dir:"asc"===t.dir?"desc":"asc"}:{col:e,dir:"asc"})};return(0,c.jsx)("div",{children:(0,c.jsxs)("div",{className:"panel",children:[(0,c.jsx)("div",{className:"panel-title",children:"Universities Management"}),!s&&n.length>0&&(0,c.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:"8px",marginBottom:"12px"},children:[(0,c.jsxs)("div",{style:{background:"#1a2332",border:"1px solid #2a3f56",borderRadius:"6px",padding:"8px 12px",color:"#8696a0",fontSize:"0.85rem"},children:[(0,c.jsx)("div",{style:{color:"#34B7F1",fontSize:"1.2rem",fontWeight:"600"},children:n.reduce((e,t)=>e+(t.views||0),0)}),(0,c.jsx)("div",{children:"Total Views"})]}),(0,c.jsxs)("div",{style:{background:"#1a2332",border:"1px solid #2a3f56",borderRadius:"6px",padding:"8px 12px",color:"#8696a0",fontSize:"0.85rem"},children:[(0,c.jsx)("div",{style:{color:"#E74C3C",fontSize:"1.2rem",fontWeight:"600"},children:n.reduce((e,t)=>e+(t.likes_count||0),0)}),(0,c.jsx)("div",{children:"Total Likes"})]}),(0,c.jsxs)("div",{style:{background:"#1a2332",border:"1px solid #2a3f56",borderRadius:"6px",padding:"8px 12px",color:"#8696a0",fontSize:"0.85rem"},children:[(0,c.jsxs)("div",{style:{color:"#FFCC00",fontSize:"1.2rem",fontWeight:"600"},children:[n.length,"/",d]}),(0,c.jsx)("div",{children:"Page Universities"})]})]}),(0,c.jsxs)("div",{className:"panel",style:{marginBottom:6},children:[(0,c.jsx)("label",{className:"label",children:"Search"}),(0,c.jsx)("input",{className:"input",value:g,onChange:e=>{x(1),j(e.target.value)},placeholder:"Search by name or location..."})]}),(0,c.jsx)("div",{className:"actions",style:{marginBottom:6},children:(0,c.jsx)("button",{className:"btn primary",onClick:()=>window.location.href="/books/admin/upload",children:"Add New University"})}),(0,c.jsx)("div",{className:"panel",style:{padding:0,overflowX:"auto"},children:(0,c.jsxs)("table",{className:"table",style:{minWidth:"1200px"},children:[(0,c.jsx)("thead",{children:(0,c.jsxs)("tr",{children:[(0,c.jsx)("th",{style:{width:"60px"},children:"Cover"}),(0,c.jsxs)("th",{style:{width:"250px",cursor:"pointer"},onClick:()=>M("name"),children:["Name ","name"===b.col?"asc"===b.dir?"\u25b2":"\u25bc":""]}),(0,c.jsx)("th",{style:{width:"300px"},children:"Description"}),(0,c.jsx)("th",{style:{width:"150px"},children:"Location"}),(0,c.jsxs)("th",{style:{width:"100px",cursor:"pointer"},onClick:()=>M("established"),children:["Est. ","established"===b.col?"asc"===b.dir?"\u25b2":"\u25bc":""]}),(0,c.jsx)("th",{style:{width:"100px"},children:"Students"}),(0,c.jsxs)("th",{style:{width:"80px",cursor:"pointer",background:"rgba(52, 183, 241, 0.1)",borderBottom:"2px solid #34B7F1"},onClick:()=>M("views_count"),children:["Views ","views_count"===b.col?"asc"===b.dir?"\u25b2":"\u25bc":""]}),(0,c.jsxs)("th",{style:{width:"80px",cursor:"pointer",background:"rgba(231, 76, 60, 0.1)",borderBottom:"2px solid #E74C3C"},onClick:()=>M("likes_count"),children:["Likes ","likes_count"===b.col?"asc"===b.dir?"\u25b2":"\u25bc":""]}),(0,c.jsx)("th",{style:{width:"80px",background:"rgba(102, 187, 106, 0.1)",borderBottom:"2px solid #66BB6A"},children:"Papers"}),(0,c.jsx)("th",{style:{width:"180px"},children:"Actions"})]})}),(0,c.jsx)("tbody",{children:s?(0,c.jsx)("tr",{children:(0,c.jsx)("td",{colSpan:10,style:{textAlign:"center",color:"#8696a0"},children:"Loading..."})}):0===n.length?(0,c.jsx)("tr",{children:(0,c.jsx)("td",{colSpan:10,style:{textAlign:"center",color:"#8696a0"},children:"No data"})}):n.map(e=>{var t,s;return(0,c.jsxs)("tr",{children:[(0,c.jsx)("td",{children:e.cover_image_url?(0,c.jsx)("img",{src:e.cover_image_url,alt:"cover",style:{width:36,height:36,objectFit:"cover",borderRadius:4}}):(0,c.jsx)("span",{className:"badge",children:"No cover"})}),(0,c.jsx)("td",{children:f===e.id?(0,c.jsx)("input",{className:"input",value:N.name,onChange:e=>k((0,i.A)((0,i.A)({},N),{},{name:e.target.value}))}):e.name}),(0,c.jsx)("td",{children:f===e.id?(0,c.jsx)("textarea",{className:"input",rows:2,value:N.description,onChange:e=>k((0,i.A)((0,i.A)({},N),{},{description:e.target.value}))}):(null===(t=e.description)||void 0===t?void 0:t.slice(0,100))||"\u2014"}),(0,c.jsx)("td",{children:f===e.id?(0,c.jsx)("input",{className:"input",value:N.location,onChange:e=>k((0,i.A)((0,i.A)({},N),{},{location:e.target.value}))}):e.location||"\u2014"}),(0,c.jsx)("td",{children:f===e.id?(0,c.jsx)("input",{className:"input",type:"number",value:N.established,onChange:e=>k((0,i.A)((0,i.A)({},N),{},{established:e.target.value}))}):e.established||"\u2014"}),(0,c.jsx)("td",{children:(null===(s=e.student_count)||void 0===s?void 0:s.toLocaleString())||"\u2014"}),(0,c.jsx)("td",{style:{fontWeight:"500",color:"#00a884"},children:e.views||0}),(0,c.jsx)("td",{style:{fontWeight:"500",color:"#E74C3C"},children:e.likes_count||0}),(0,c.jsx)("td",{style:{fontWeight:"500",color:"#66BB6A"},children:S[e.id]||0}),(0,c.jsx)("td",{children:f===e.id?(0,c.jsxs)("div",{style:{display:"flex",gap:"4px",flexDirection:"column"},children:[(0,c.jsx)("button",{className:"btn primary",onClick:()=>(async e=>{if(!R())return void L({type:"error",message:"You do not have permission to edit this university."});const t=(0,i.A)({},N);""===t.established||void 0===t.established?t.established=null:t.established=Number(t.established),""===t.student_count||void 0===t.student_count?t.student_count=null:t.student_count=Number(t.student_count);try{await(0,u.qw)(e.id,{updates:t,newCoverFile:_}),z(),await D(),L({type:"success",message:"University updated successfully."})}catch(s){console.error("Failed to update university:",s),L({type:"error",message:(null===s||void 0===s?void 0:s.message)||"Failed to update university."})}})(e),children:"Save"}),(0,c.jsx)("button",{className:"btn",onClick:z,children:"Cancel"})]}):(0,c.jsxs)("div",{className:"actions",children:[(0,c.jsx)("button",{className:"btn",onClick:()=>(e=>{R()?(w(e.id),k({name:e.name||"",description:e.description||"",website_url:e.website_url||"",location:e.location||"",established:e.established||"",student_count:e.student_count||""}),C(null)):L({type:"error",message:"You do not have permission to edit this university."})})(e),disabled:!R(),children:"Edit"}),(0,c.jsx)("button",{className:"btn",onClick:()=>(async e=>{if(!R())return void L({type:"error",message:"You can only delete universities you uploaded."});if(await F({title:"Delete university?",message:'Delete "'.concat(e.name,'" and its related data? This action cannot be undone.'),confirmLabel:"Delete",cancelLabel:"Cancel",variant:"danger"}))try{await(0,u.wy)({id:e.id,cover_image_url:e.cover_image_url}),await D(),L({type:"success",message:"University deleted."})}catch(t){console.error("Failed to delete university:",t),L({type:"error",message:(null===t||void 0===t?void 0:t.message)||"Failed to delete university."})}})(e),disabled:!R(),children:"Delete"})]})})]},e.id)})})]})}),(0,c.jsxs)("div",{className:"actions",style:{marginTop:6},children:[(0,c.jsx)("button",{className:"btn",disabled:p<=1,onClick:()=>x(e=>Math.max(1,e-1)),children:"Prev"}),(0,c.jsxs)("span",{style:{color:"#cfd8dc"},children:["Page ",p," of ",T]}),(0,c.jsx)("button",{className:"btn",disabled:p>=T,onClick:()=>x(e=>Math.min(T,e+1)),children:"Next"})]})]})})},p=e=>{if(!e)return"\u2014";try{return new Date(e).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0,timeZoneName:"short"})}catch(t){return e}},x=e=>{let{userProfile:t}=e;const[s,l]=(0,a.useState)(!0),[n,o]=(0,a.useState)([]),[d,u]=(0,a.useState)(0),[m,x]=(0,a.useState)(1),[v]=(0,a.useState)(10),[g,j]=(0,a.useState)(""),[b,y]=(0,a.useState)([]),[f,w]=(0,a.useState)(null),[N,k]=(0,a.useState)({col:"created_at",dir:"desc"}),[_,C]=(0,a.useState)(null),[S,A]=(0,a.useState)({}),[F,L]=(0,a.useState)(null),{confirm:P,showToast:B}=(0,r.v)(),E="admin"===(null===t||void 0===t?void 0:t.role),T="editor"===(null===t||void 0===t?void 0:t.role),D=(0,a.useMemo)(()=>Math.max(1,Math.ceil(d/v)),[d,v]),R=async()=>{l(!0);try{const{data:e,count:t}=await(0,h.Up)({page:m,pageSize:v,search:g,faculty:f,sort:N});o(e),u(t)}finally{l(!1)}};(0,a.useEffect)(()=>{(async()=>{try{y(await(0,h.Re)())}catch(e){}})()},[]),(0,a.useEffect)(()=>{t&&R()},[m,g,f,N.col,N.dir,t]);const z=e=>!!E||!!T,M=()=>{C(null),A({}),L(null)},I=e=>k(t=>t.col===e?{col:e,dir:"asc"===t.dir?"desc":"asc"}:{col:e,dir:"asc"});return(0,c.jsx)("div",{children:(0,c.jsxs)("div",{className:"panel",children:[(0,c.jsx)("div",{className:"panel-title",children:"Past Papers Management"}),!s&&n.length>0&&(0,c.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:"8px",marginBottom:"12px"},children:[(0,c.jsxs)("div",{style:{background:"#1a2332",border:"1px solid #2a3f56",borderRadius:"6px",padding:"8px 12px",color:"#8696a0",fontSize:"0.85rem"},children:[(0,c.jsx)("div",{style:{color:"#00a884",fontSize:"1.2rem",fontWeight:"600"},children:n.reduce((e,t)=>e+(t.downloads_count||0),0)}),(0,c.jsx)("div",{children:"Total Downloads"})]}),(0,c.jsxs)("div",{style:{background:"#1a2332",border:"1px solid #2a3f56",borderRadius:"6px",padding:"8px 12px",color:"#8696a0",fontSize:"0.85rem"},children:[(0,c.jsx)("div",{style:{color:"#34B7F1",fontSize:"1.2rem",fontWeight:"600"},children:n.reduce((e,t)=>e+(t.views_count||0),0)}),(0,c.jsx)("div",{children:"Total Views"})]}),(0,c.jsxs)("div",{style:{background:"#1a2332",border:"1px solid #2a3f56",borderRadius:"6px",padding:"8px 12px",color:"#8696a0",fontSize:"0.85rem"},children:[(0,c.jsxs)("div",{style:{color:"#FFCC00",fontSize:"1.2rem",fontWeight:"600"},children:[n.length,"/",d]}),(0,c.jsx)("div",{children:"Page Papers"})]})]}),(0,c.jsxs)("div",{className:"grid-2",style:{marginBottom:6},children:[(0,c.jsxs)("div",{className:"panel",children:[(0,c.jsx)("label",{className:"label",children:"Search"}),(0,c.jsx)("input",{className:"input",value:g,onChange:e=>{x(1),j(e.target.value.trim())},placeholder:"e.g., MENT 130 or Introduction to..."})]}),(0,c.jsxs)("div",{className:"panel",children:[(0,c.jsx)("label",{className:"label",children:"Faculty"}),(0,c.jsxs)("select",{className:"select",value:f||"",onChange:e=>{x(1),w(e.target.value||null)},children:[(0,c.jsx)("option",{value:"",children:"All Faculties"}),b.map(e=>(0,c.jsx)("option",{value:e,children:e},e))]})]})]}),(0,c.jsx)("div",{className:"actions",style:{marginBottom:6},children:(0,c.jsx)("button",{className:"btn primary",onClick:()=>window.location.href="/books/admin/upload",children:"Add New Past Paper"})}),(0,c.jsx)("div",{className:"panel",style:{padding:0,overflowX:"auto"},children:(0,c.jsxs)("table",{className:"table",style:{minWidth:"1200px"},children:[(0,c.jsx)("thead",{children:(0,c.jsxs)("tr",{children:[(0,c.jsx)("th",{style:{width:"250px"},children:"Unit Name"}),(0,c.jsxs)("th",{style:{width:"150px",cursor:"pointer"},onClick:()=>I("unit_code"),children:["Unit Code ","unit_code"===N.col?"asc"===N.dir?"\u25b2":"\u25bc":""]}),(0,c.jsx)("th",{style:{width:"150px"},children:"Faculty"}),(0,c.jsxs)("th",{style:{width:"100px",cursor:"pointer"},onClick:()=>I("year"),children:["Year ","year"===N.col?"asc"===N.dir?"\u25b2":"\u25bc":""]}),(0,c.jsx)("th",{style:{width:"100px"},children:"Semester"}),(0,c.jsx)("th",{style:{width:"120px"},children:"Exam Type"}),(0,c.jsxs)("th",{style:{width:"80px",cursor:"pointer",background:"rgba(52, 183, 241, 0.1)",borderBottom:"2px solid #34B7F1"},onClick:()=>I("views_count"),children:["Views ","views_count"===N.col?"asc"===N.dir?"\u25b2":"\u25bc":""]}),(0,c.jsxs)("th",{style:{width:"100px",cursor:"pointer"},onClick:()=>I("downloads_count"),children:["Downloads ","downloads_count"===N.col?"asc"===N.dir?"\u25b2":"\u25bc":""]}),(0,c.jsxs)("th",{style:{width:"180px",cursor:"pointer"},onClick:()=>I("created_at"),children:["Uploaded ","created_at"===N.col?"asc"===N.dir?"\u25b2":"\u25bc":""]}),(0,c.jsx)("th",{style:{width:"150px"},children:"Uploaded By"}),(0,c.jsx)("th",{style:{width:"200px"},children:"Actions"})]})}),(0,c.jsx)("tbody",{children:s?(0,c.jsx)("tr",{children:(0,c.jsx)("td",{colSpan:12,style:{textAlign:"center",color:"#8696a0"},children:"Loading..."})}):0===n.length?(0,c.jsx)("tr",{children:(0,c.jsx)("td",{colSpan:12,style:{textAlign:"center",color:"#8696a0"},children:"No data"})}):n.map(e=>{var t,s,a;return(0,c.jsxs)("tr",{children:[(0,c.jsx)("td",{style:{color:e.unit_name?"#e9edef":"#8696a0"},children:_===e.id?(0,c.jsx)("input",{className:"input",value:S.unit_name,onChange:e=>A((0,i.A)((0,i.A)({},S),{},{unit_name:e.target.value}))}):e.unit_name||"\u2014"}),(0,c.jsx)("td",{style:{color:e.unit_code?"#e9edef":"#8696a0"},children:_===e.id?(0,c.jsx)("input",{className:"input",value:S.unit_code,onChange:e=>A((0,i.A)((0,i.A)({},S),{},{unit_code:e.target.value}))}):e.unit_code||"\u2014"}),(0,c.jsx)("td",{style:{color:e.faculty?"#e9edef":"#8696a0"},children:_===e.id?(0,c.jsx)("input",{className:"input",value:S.faculty,onChange:e=>A((0,i.A)((0,i.A)({},S),{},{faculty:e.target.value}))}):e.faculty||"\u2014"}),(0,c.jsx)("td",{style:{color:e.year?"#e9edef":"#8696a0"},children:_===e.id?(0,c.jsx)("input",{className:"input",type:"number",value:S.year,onChange:e=>A((0,i.A)((0,i.A)({},S),{},{year:e.target.value}))}):e.year||"\u2014"}),(0,c.jsx)("td",{children:_===e.id?(0,c.jsxs)("select",{className:"select",value:S.semester,onChange:e=>A((0,i.A)((0,i.A)({},S),{},{semester:e.target.value})),children:[(0,c.jsx)("option",{value:"",children:"\u2014"}),(0,c.jsx)("option",{value:"1",children:"1"}),(0,c.jsx)("option",{value:"2",children:"2"}),(0,c.jsx)("option",{value:"3",children:"3"})]}):e.semester||"\u2014"}),(0,c.jsx)("td",{children:_===e.id?(0,c.jsxs)("select",{className:"select",value:S.exam_type,onChange:e=>A((0,i.A)((0,i.A)({},S),{},{exam_type:e.target.value})),children:[(0,c.jsx)("option",{value:"Main",children:"Main"}),(0,c.jsx)("option",{value:"Supplementary",children:"Supplementary"}),(0,c.jsx)("option",{value:"CAT",children:"CAT"}),(0,c.jsx)("option",{value:"Mock",children:"Mock"})]}):e.exam_type||"Main"}),(0,c.jsx)("td",{style:{fontWeight:"500",color:"#34B7F1"},children:e.views_count||0}),(0,c.jsx)("td",{children:e.downloads_count||0}),(0,c.jsx)("td",{style:{color:"#8696a0",fontSize:"12px"},children:p(e.created_at)}),(0,c.jsx)("td",{style:{color:null!==(t=e.profiles)&&void 0!==t&&t.full_name?"#e9edef":"#8696a0",fontSize:"13px"},children:(null===(s=e.profiles)||void 0===s?void 0:s.full_name)||(null===(a=e.profiles)||void 0===a?void 0:a.email)||"\u2014"}),(0,c.jsx)("td",{children:_===e.id?(0,c.jsxs)("div",{style:{display:"flex",gap:"4px",flexDirection:"column"},children:[(0,c.jsx)("button",{className:"btn primary",onClick:()=>(async e=>{if(!z())return void B({type:"error",message:"You do not have permission to edit this past paper."});const t=(0,i.A)({},S);try{await(0,h.MK)(e.id,{updates:t,newPdfFile:F,oldFilePath:e.file_path}),M(),await R(),B({type:"success",message:"Past paper updated."})}catch(s){console.error("Failed to update past paper:",(null===s||void 0===s?void 0:s.message)||s),B({type:"error",message:(null===s||void 0===s?void 0:s.message)||"Failed to update past paper."})}})(e),children:"Save"}),(0,c.jsx)("button",{className:"btn",onClick:M,children:"Cancel"})]}):(0,c.jsxs)("div",{className:"actions",children:[(0,c.jsx)("button",{className:"btn",onClick:()=>(e=>{z()?(C(e.id),A({faculty:e.faculty||"",unit_code:e.unit_code||"",unit_name:e.unit_name||"",year:e.year||"",semester:e.semester||"",exam_type:e.exam_type||""}),L(null)):B({type:"error",message:"You do not have permission to edit this past paper."})})(e),disabled:!z(),children:"Edit"}),(0,c.jsx)("button",{className:"btn",onClick:()=>(async e=>{if(!z())return void B({type:"error",message:"You can only delete past papers you uploaded."});if(await P({title:"Delete past paper?",message:'Delete "'.concat(e.unit_code," - ").concat(e.unit_name,'"? This action cannot be undone.'),confirmLabel:"Delete",cancelLabel:"Cancel",variant:"danger"}))try{await(0,h.aw)({id:e.id,file_path:e.file_path}),await R(),B({type:"success",message:"Past paper deleted."})}catch(t){console.error("Failed to delete past paper:",t),B({type:"error",message:(null===t||void 0===t?void 0:t.message)||"Failed to delete past paper."})}})(e),disabled:!z(),children:"Delete"})]})})]},e.id)})})]})}),(0,c.jsxs)("div",{className:"actions",style:{marginTop:6},children:[(0,c.jsx)("button",{className:"btn",disabled:m<=1,onClick:()=>x(e=>Math.max(1,e-1)),children:"Prev"}),(0,c.jsxs)("span",{style:{color:"#cfd8dc"},children:["Page ",m," of ",D]}),(0,c.jsx)("button",{className:"btn",disabled:m>=D,onClick:()=>x(e=>Math.min(D,e+1)),children:"Next"})]})]})})};var v=s(6720),g=s(7488);async function j(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;try{const{data:t,error:s}=await g.N.from("author_engagement_stats").select("*").order("engagement_score",{ascending:!1}).limit(e);if(s)throw s;return t||[]}catch(t){return console.error("Error fetching all authors engagement stats:",t),[]}}const b=()=>{const[e,t]=(0,a.useState)(null),[s,l]=(0,a.useState)({}),[i,r]=(0,a.useState)(!0),[d,u]=(0,a.useState)(""),[h,m]=(0,a.useState)("engagement"),[p,x]=(0,a.useState)("monthly");(0,a.useEffect)(()=>{const e=async()=>{try{r(!0);const[e,s]=await Promise.all([(0,o.YK)(),j(100)]);t(e);const a={};s.forEach(e=>{a[e.author_name]=e}),l(a)}catch(e){console.error("Failed to load authors stats:",e)}finally{r(!1)}};e();const s=setInterval(e,3e4);return()=>clearInterval(s)},[]);const g=(0,a.useMemo)(()=>{if(!e||!e.authors)return[];let t=e.authors.filter(e=>e.name.toLowerCase().includes(d.toLowerCase()));return t.sort((e,t)=>{const a=s[e.name]||{},l=s[t.name]||{};switch(h){case"engagement":default:return(l.engagement_score||0)-(a.engagement_score||0);case"books":return t.bookCount-e.bookCount;case"downloads":return t.totalDownloads-e.totalDownloads;case"followers":return(l.followers_count||0)-(a.followers_count||0);case"likes":return(l.likes_count||0)-(a.likes_count||0);case"rating":return parseFloat(t.avgRating||0)-parseFloat(e.avgRating||0);case"name":return e.name.localeCompare(t.name)}}),t},[e,d,h,s]),b=(0,a.useMemo)(()=>{if(!e||!e.authors)return{totalAuthors:0,totalBooks:0,totalDL:0,avgRating:0,totalFollowers:0,totalLikes:0,totalLoves:0,totalComments:0};const t=e.authors.reduce((e,t)=>e+(t.bookCount||0),0),a=e.authors.reduce((e,t)=>e+(t.totalDownloads||0),0),l=e.authors.length>0?(e.authors.reduce((e,t)=>e+(parseFloat(t.avgRating)||0),0)/e.authors.length).toFixed(1):0,n=Object.values(s).reduce((e,t)=>e+(t.followers_count||0),0),i=Object.values(s).reduce((e,t)=>e+(t.likes_count||0),0),o=Object.values(s).reduce((e,t)=>e+(t.loves_count||0),0),r=Object.values(s).reduce((e,t)=>e+(t.comments_count||0),0);return{totalAuthors:e.authors.length,totalBooks:t,totalDL:a,avgRating:l,totalFollowers:n,totalLikes:i,totalLoves:o,totalComments:r}},[e,s]);return i?(0,c.jsx)("div",{className:"authors-page",children:(0,c.jsxs)("div",{className:"authors-loading",children:[(0,c.jsx)("div",{className:"authors-spinner"}),(0,c.jsx)("p",{children:"Loading authors data..."})]})}):(0,c.jsxs)("div",{className:"authors-page",children:[(0,c.jsx)("div",{className:"authors-header",children:(0,c.jsxs)("div",{className:"authors-title-section",children:[(0,c.jsxs)("h1",{className:"authors-title",children:[(0,c.jsx)(n.ARf,{})," Authors Analytics"]}),(0,c.jsx)("p",{className:"authors-subtitle",children:"Comprehensive author performance and engagement metrics"})]})}),(0,c.jsxs)("div",{className:"authors-stats-grid",children:[(0,c.jsxs)("div",{className:"authors-stat-card",children:[(0,c.jsx)("div",{className:"authors-stat-icon authors-stat-icon-1",children:(0,c.jsx)(n.H9b,{})}),(0,c.jsxs)("div",{className:"authors-stat-content",children:[(0,c.jsx)("div",{className:"authors-stat-label",children:"Total Authors"}),(0,c.jsx)("div",{className:"authors-stat-value",children:b.totalAuthors})]})]}),(0,c.jsxs)("div",{className:"authors-stat-card",children:[(0,c.jsx)("div",{className:"authors-stat-icon authors-stat-icon-2",children:(0,c.jsx)(n.H9b,{})}),(0,c.jsxs)("div",{className:"authors-stat-content",children:[(0,c.jsx)("div",{className:"authors-stat-label",children:"Total Books"}),(0,c.jsx)("div",{className:"authors-stat-value",children:b.totalBooks})]})]}),(0,c.jsxs)("div",{className:"authors-stat-card",children:[(0,c.jsx)("div",{className:"authors-stat-icon authors-stat-icon-3",children:(0,c.jsx)(n.a4x,{})}),(0,c.jsxs)("div",{className:"authors-stat-content",children:[(0,c.jsx)("div",{className:"authors-stat-label",children:"Total Downloads"}),(0,c.jsx)("div",{className:"authors-stat-value",children:b.totalDL.toLocaleString()})]})]}),(0,c.jsxs)("div",{className:"authors-stat-card",children:[(0,c.jsx)("div",{className:"authors-stat-icon authors-stat-icon-4",children:(0,c.jsx)(n.usP,{})}),(0,c.jsxs)("div",{className:"authors-stat-content",children:[(0,c.jsx)("div",{className:"authors-stat-label",children:"Avg Rating"}),(0,c.jsxs)("div",{className:"authors-stat-value",children:[b.avgRating,"\u2b50"]})]})]}),(0,c.jsxs)("div",{className:"authors-stat-card",children:[(0,c.jsx)("div",{className:"authors-stat-icon authors-stat-icon-5",children:(0,c.jsx)(n.cfS,{})}),(0,c.jsxs)("div",{className:"authors-stat-content",children:[(0,c.jsx)("div",{className:"authors-stat-label",children:"Total Followers"}),(0,c.jsx)("div",{className:"authors-stat-value",children:b.totalFollowers})]})]}),(0,c.jsxs)("div",{className:"authors-stat-card",children:[(0,c.jsx)("div",{className:"authors-stat-icon authors-stat-icon-6",children:(0,c.jsx)(v.Q81,{})}),(0,c.jsxs)("div",{className:"authors-stat-content",children:[(0,c.jsx)("div",{className:"authors-stat-label",children:"Total Likes"}),(0,c.jsx)("div",{className:"authors-stat-value",children:b.totalLikes})]})]}),(0,c.jsxs)("div",{className:"authors-stat-card",children:[(0,c.jsx)("div",{className:"authors-stat-icon authors-stat-icon-7",children:(0,c.jsx)(n.icx,{})}),(0,c.jsxs)("div",{className:"authors-stat-content",children:[(0,c.jsx)("div",{className:"authors-stat-label",children:"Total Loves"}),(0,c.jsx)("div",{className:"authors-stat-value",children:b.totalLoves})]})]}),(0,c.jsxs)("div",{className:"authors-stat-card",children:[(0,c.jsx)("div",{className:"authors-stat-icon authors-stat-icon-8",children:(0,c.jsx)(n.mEP,{})}),(0,c.jsxs)("div",{className:"authors-stat-content",children:[(0,c.jsx)("div",{className:"authors-stat-label",children:"Total Comments"}),(0,c.jsx)("div",{className:"authors-stat-value",children:b.totalComments})]})]})]}),(0,c.jsxs)("div",{className:"authors-controls",children:[(0,c.jsxs)("div",{className:"authors-control-group",children:[(0,c.jsx)("label",{className:"authors-label",children:"Search Author"}),(0,c.jsxs)("div",{className:"authors-search-wrapper",children:[(0,c.jsx)(n.CKj,{className:"authors-search-icon"}),(0,c.jsx)("input",{type:"text",placeholder:"Search by author name...",value:d,onChange:e=>u(e.target.value),className:"authors-search-input"})]})]}),(0,c.jsxs)("div",{className:"authors-control-group",children:[(0,c.jsx)("label",{className:"authors-label",children:"Sort By"}),(0,c.jsxs)("select",{value:h,onChange:e=>m(e.target.value),className:"authors-select",children:[(0,c.jsx)("option",{value:"engagement",children:"Engagement Score"}),(0,c.jsx)("option",{value:"followers",children:"Followers"}),(0,c.jsx)("option",{value:"likes",children:"Likes"}),(0,c.jsx)("option",{value:"books",children:"Books Count"}),(0,c.jsx)("option",{value:"downloads",children:"Downloads"}),(0,c.jsx)("option",{value:"rating",children:"Rating"}),(0,c.jsx)("option",{value:"name",children:"Name (A-Z)"})]})]})]}),(0,c.jsx)("div",{className:"authors-table-wrapper",children:(0,c.jsxs)("table",{className:"authors-table",children:[(0,c.jsx)("thead",{className:"authors-table-head",children:(0,c.jsxs)("tr",{children:[(0,c.jsx)("th",{className:"authors-table-header authors-rank-col",children:"Rank"}),(0,c.jsx)("th",{className:"authors-table-header authors-name-col",children:"Author Name"}),(0,c.jsx)("th",{className:"authors-table-header authors-num-col",children:"Books"}),(0,c.jsx)("th",{className:"authors-table-header authors-num-col",children:"Downloads"}),(0,c.jsx)("th",{className:"authors-table-header authors-num-col",children:"Followers"}),(0,c.jsx)("th",{className:"authors-table-header authors-num-col",children:"Likes"}),(0,c.jsx)("th",{className:"authors-table-header authors-num-col",children:"Loves"}),(0,c.jsx)("th",{className:"authors-table-header authors-num-col",children:"Rating"}),(0,c.jsx)("th",{className:"authors-table-header authors-num-col",children:"Score"})]})}),(0,c.jsx)("tbody",{className:"authors-table-body",children:g.length>0?g.map((e,t)=>{const a=s[e.name]||{},l=a.engagement_score||0,i=0===t?"\ud83e\udd47":1===t?"\ud83e\udd48":2===t?"\ud83e\udd49":"#".concat(t+1);return(0,c.jsxs)("tr",{className:"authors-table-row",children:[(0,c.jsx)("td",{className:"authors-table-cell authors-rank-col",children:(0,c.jsx)("span",{className:"authors-rank-badge",children:i})}),(0,c.jsx)("td",{className:"authors-table-cell authors-name-col",children:(0,c.jsx)("div",{className:"authors-author-name",children:"Unknown"===e.name?"\ud83d\udc64 Unknown Author":e.name})}),(0,c.jsx)("td",{className:"authors-table-cell authors-num-col",children:(0,c.jsx)("span",{className:"authors-metric-plain authors-books-count",children:e.bookCount})}),(0,c.jsx)("td",{className:"authors-table-cell authors-num-col",children:(0,c.jsx)("span",{className:"authors-metric-plain authors-downloads-count",children:e.totalDownloads})}),(0,c.jsx)("td",{className:"authors-table-cell authors-num-col",children:(0,c.jsx)("span",{className:"authors-metric-plain authors-followers-count",children:a.followers_count||0})}),(0,c.jsx)("td",{className:"authors-table-cell authors-num-col",children:(0,c.jsxs)("span",{className:"authors-metric-plain authors-likes-count",children:[(0,c.jsx)(n.Ydy,{className:"authors-metric-icon"}),a.likes_count||0]})}),(0,c.jsx)("td",{className:"authors-table-cell authors-num-col",children:(0,c.jsxs)("span",{className:"authors-metric-plain authors-loves-count",children:[(0,c.jsx)(n.icx,{className:"authors-metric-icon"}),a.loves_count||0]})}),(0,c.jsx)("td",{className:"authors-table-cell authors-num-col",children:(0,c.jsxs)("span",{className:"authors-rating-plain",children:[a.average_rating>0?a.average_rating.toFixed(1):"\u2014"," \u2b50"]})}),(0,c.jsx)("td",{className:"authors-table-cell authors-num-col",children:(0,c.jsx)("span",{className:"authors-score-plain",children:l.toFixed(2)})})]},e.id)}):(0,c.jsx)("tr",{className:"authors-table-row authors-empty-row",children:(0,c.jsxs)("td",{colSpan:"9",className:"authors-table-cell authors-empty-message",children:['No authors found matching "',d,'"']})})})]})}),(0,c.jsx)("div",{className:"authors-summary",children:(0,c.jsxs)("div",{className:"authors-summary-item",children:[(0,c.jsx)("span",{className:"authors-summary-label",children:"Showing"}),(0,c.jsxs)("span",{className:"authors-summary-value",children:[g.length," of ",b.totalAuthors]}),(0,c.jsx)("span",{className:"authors-summary-label",children:"authors"})]})})]})},y=e=>{let{userProfile:t}=e;const[s]=(0,l.ok)(),[i,o]=(0,a.useState)("books");return(0,a.useEffect)(()=>{const e=s.get("tab");o("pastpapers"===e?"pastpapers":"universities"===e?"universities":"authors"===e?"authors":"books")},[s]),a.useEffect(()=>{const e=document.createElement("style");return e.innerHTML="\n  .content-tabs {\n    display: flex;\n    gap: 4px;\n    margin-bottom: 8px;\n    border-bottom: 1px solid #374151;\n  }\n  .content-tab {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    padding: 6px 12px;\n    background: transparent;\n    border: none;\n    color: #8696a0;\n    cursor: pointer;\n    font-size: 14px;\n    font-weight: 500;\n    transition: all 0.3s ease;\n    border-bottom: 2px solid transparent;\n    margin-bottom: -1px;\n  }\n  .content-tab:hover {\n    color: #e9edef;\n    background: rgba(0, 168, 132, 0.05);\n  }\n  .content-tab.active {\n    color: #00a884;\n    border-bottom-color: #00a884;\n  }\n",document.head.appendChild(e),()=>e.remove()},[]),(0,c.jsxs)("div",{children:[(0,c.jsxs)("div",{className:"content-tabs",children:[(0,c.jsxs)("button",{className:"content-tab ".concat("books"===i?"active":""),onClick:()=>o("books"),children:[(0,c.jsx)(n.H9b,{size:20}),"Books"]}),(0,c.jsxs)("button",{className:"content-tab ".concat("universities"===i?"active":""),onClick:()=>o("universities"),children:[(0,c.jsx)(n.HzC,{size:20}),"Universities"]}),(0,c.jsxs)("button",{className:"content-tab ".concat("pastpapers"===i?"active":""),onClick:()=>o("pastpapers"),children:[(0,c.jsx)(n.jH2,{size:20}),"Past Papers"]}),(0,c.jsxs)("button",{className:"content-tab ".concat("authors"===i?"active":""),onClick:()=>o("authors"),children:[(0,c.jsx)(n.D1A,{size:20}),"Authors"]})]}),"books"===i&&(0,c.jsx)(d,{userProfile:t}),"universities"===i&&(0,c.jsx)(m,{userProfile:t}),"pastpapers"===i&&(0,c.jsx)(x,{userProfile:t}),"authors"===i&&(0,c.jsx)(b,{})]})}},1903:(e,t,s)=>{s.d(t,{Fn:()=>o,M9:()=>c,d$:()=>u,xH:()=>i,zd:()=>r});var a=s(7488),l=s(3488);const n=!0;async function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;try{let{data:i,error:o}=await a.N.rpc("search_university_names",{p_query:e,p_limit:t});if(o)throw o;if(null!==i&&void 0!==i&&i.length)return i;const r=await async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;try{const s="https://en.wikipedia.org/w/api.php?action=opensearch&search=".concat(encodeURIComponent(e+" university"),"&limit=").concat(t,"&namespace=0&format=json&origin=*"),a=await fetch(s);if(!a.ok)return[];const l=await a.json(),n=l[1]||[],i=l[2]||[],o=l[3]||[];return n.filter(e=>e.toLowerCase().includes("university")||e.toLowerCase().includes("college")).map((e,t)=>({name:e,description:i[t]||"",website_url:o[t]||""}))}catch(o){return console.error("Error searching Wikipedia:",o),[]}}(e,t);if(r.length>0)return await Promise.all(r.map(e=>d(e.name,e,"wikipedia"))),r;if(n)try{const s=await fetch("".concat(l.H,"/api/university/search?query=").concat(encodeURIComponent(e),"&limit=").concat(t));if(s.ok){const e=(await s.json()).universities||[];return e.length>0&&await Promise.all(e.map(e=>d(e.name,e,"google_proxy"))),e}}catch(s){console.warn("Backend proxy unavailable:",s.message)}return[]}catch(i){return console.error("Error searching university names:",i),[]}}async function o(e){try{var t,s,a;const l=(e||"").trim().replace(/\s+/g,"_");if(!l)return[];const n="https://commons.wikimedia.org/w/api.php?action=query&format=json&origin=*&prop=images&titles=".concat(encodeURIComponent(l)),i=await fetch(n);if(!i.ok)return[];const o=await i.json(),r=(null===(s=(null!==o&&void 0!==o&&null!==(t=o.query)&&void 0!==t&&t.pages?Object.values(o.query.pages):[])[0])||void 0===s?void 0:s.images)||[];if(!r.length)return[];const c=r.map(e=>null===e||void 0===e?void 0:e.title).filter(Boolean).slice(0,50).join("|");if(!c)return[];const d="https://commons.wikimedia.org/w/api.php?action=query&format=json&origin=*&prop=imageinfo&iiprop=url&titles=".concat(encodeURIComponent(c)),u=await fetch(d);if(!u.ok)return[];const h=await u.json(),m=(null!==h&&void 0!==h&&null!==(a=h.query)&&void 0!==a&&a.pages?Object.values(h.query.pages):[]).map(e=>{var t,s;return null===e||void 0===e||null===(t=e.imageinfo)||void 0===t||null===(s=t[0])||void 0===s?void 0:s.url}).filter(e=>"string"===typeof e&&/\.(jpg|jpeg|png|webp)$/i.test(e));return m.sort((e,t)=>{const s=e=>/logo|seal|coat_of_arms|emblem/i.test(e)?1:0;return s(e)-s(t)}).slice(0,5)}catch(l){return console.error("Error fetching Wikimedia images:",l),[]}}async function r(e){if(n)try{const s=await fetch("".concat(l.H,"/api/university/images?query=").concat(encodeURIComponent(e)));if(s.ok){var t;return(null===(t=(await s.json()).images)||void 0===t?void 0:t.map(e=>e.url))||[]}}catch(s){console.error("Error fetching Unsplash images via proxy:",s)}return[]}async function c(e,t){try{const s=await fetch(e);if(!s.ok)throw new Error("Failed to download image");const a=await s.blob();return new File([a],t,{type:a.type})}catch(s){return console.error("Error downloading image:",s),null}}async function d(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"manual";try{const{error:l}=await a.N.from("university_prefill_cache").upsert({university_name:e,data:t,source:s,updated_at:(new Date).toISOString()});if(l)throw l;return!0}catch(l){return console.error("Error caching prefill data:",l),!1}}async function u(e){try{let c=await async function(e){try{const{data:t,error:s}=await a.N.rpc("get_university_prefill_data",{p_university_name:e});if(s)throw s;return t}catch(t){return console.error("Error fetching prefill data:",t),null}}(e);if(c)return c;const u=await async function(e){try{var t;const s="https://en.wikipedia.org/api/rest_v1/page/summary/".concat(encodeURIComponent(e)),a=await fetch(s);if(!a.ok)return null;const l=await a.json();return{name:l.title||e,description:l.extract||"",website_url:"",location:"",established:null,student_count:null,cover_images:null!==(t=l.thumbnail)&&void 0!==t&&t.source?[l.thumbnail.source]:[]}}catch(s){return console.error("Error fetching from Wikipedia REST:",s),null}}(e),h=await async function(e){try{var t,s,a,l;const n='\n      SELECT ?item ?itemLabel ?locationLabel ?established ?studentCount ?website\n      WHERE {\n        ?item wdt:P31/wdt:P279* wd:Q3918;\n              rdfs:label ?itemLabel.\n        OPTIONAL { ?item wdt:P131 ?location. }\n        OPTIONAL { ?item wdt:P571 ?established. }\n        OPTIONAL { ?item wdt:P2196 ?studentCount. }\n        OPTIONAL { ?item wdt:P856 ?website. }\n        FILTER(CONTAINS(LCASE(?itemLabel), LCASE("'.concat(e,'")))\n        FILTER(LANG(?itemLabel) = "en")\n        SERVICE wikibase:label { bd:serviceParam wikibase:language "en". }\n      }\n      LIMIT 1\n    '),i="https://query.wikidata.org/sparql?query=".concat(encodeURIComponent(n),"&format=json"),o=await fetch(i);if(!o.ok)return null;const r=(await o.json()).results.bindings[0];return r?{name:r.itemLabel.value,description:"",website_url:(null===(t=r.website)||void 0===t?void 0:t.value)||"",location:(null===(s=r.locationLabel)||void 0===s?void 0:s.value)||"",established:null!==(a=r.established)&&void 0!==a&&a.value?new Date(r.established.value).getFullYear():null,student_count:(null===(l=r.studentCount)||void 0===l?void 0:l.value)||null,cover_images:[]}:null}catch(n){return console.error("Error fetching from Wikidata:",n),null}}(e);if(u||h){var t,s,i;c={name:null!==(t=(null===u||void 0===u?void 0:u.name)||(null===h||void 0===h?void 0:h.name)||e)&&void 0!==t?t:e,description:(null===u||void 0===u?void 0:u.description)||"",website_url:(null===h||void 0===h?void 0:h.website_url)||"",location:(null===h||void 0===h?void 0:h.location)||"",established:null!==(s=null===h||void 0===h?void 0:h.established)&&void 0!==s?s:null,student_count:null!==(i=null===h||void 0===h?void 0:h.student_count)&&void 0!==i?i:null,cover_images:(null===u||void 0===u?void 0:u.cover_images)||[]}}if(c||(c=await async function(e){if(n)try{const t=await fetch("".concat(l.H,"/api/university/details?name=").concat(encodeURIComponent(e)));if(t.ok){const s=await t.json();return{name:s.university.name||e,description:s.university.description||"",website_url:s.university.website_url||"",location:s.university.location||"",established:null,student_count:null,cover_images:s.university.image?[s.university.image]:[]}}}catch(t){console.error("Error fetching from Google via proxy:",t)}return null}(e)),c&&(!c.cover_images||0===c.cover_images.length)){const t=await o(c.name||e);if(t.length)c.cover_images=t;else{const t=await r(c.name||e);c.cover_images=t}}return c&&await d(e,c,"wikipedia_wikidata"),c||{name:e,description:"",website_url:"",location:"",established:null,student_count:null,cover_images:[]}}catch(c){return console.error("Error auto-filling university data:",c),{name:e,description:"",website_url:"",location:"",established:null,student_count:null,cover_images:[]}}}}}]);
//# sourceMappingURL=767.e9e90118.chunk.js.map