"use strict";(self.webpackChunkcampuslife=self.webpackChunkcampuslife||[]).push([[824],{8824:(e,t,s)=>{s.r(t),s.d(t,{default:()=>d});var i=s(9379),a=s(5043),n=s(3515),r=s(9101),l=s(7488),o=s(5200);var c=s(579);const d=()=>{const[e,t]=(0,a.useState)([]),[s,d]=(0,a.useState)(!0),[p,m]=(0,a.useState)({name:"",description:""}),[g,h]=(0,a.useState)(null),[x,y]=(0,a.useState)({name:"",description:""}),[u,f]=(0,a.useState)(1),[j]=(0,a.useState)(15),[b,v]=(0,a.useState)({}),[w,C]=(0,a.useState)(""),[N,S]=(0,a.useState)(!1),[k,z]=(0,a.useState)(!1),{confirm:A,showToast:F}=(0,r.v)(),D=async()=>{d(!0);try{const e=await(0,n.jE)();t(e);const s={};await Promise.all(e.map(async e=>{const{count:t,error:i}=await l.N.from("books").select("*",{count:"exact",head:!0}).eq("category_id",e.id);i||(s[e.id]=t||0)})),v(s)}catch(e){console.error("Failed to load categories:",e),F({type:"error",message:"Failed to load categories."})}finally{d(!1)}};(0,a.useEffect)(()=>{D()},[]);const I=async()=>{if(p.name.trim())try{await(0,n.zZ)({name:p.name.trim(),description:p.description||""}),m({name:"",description:""}),await D(),F({type:"success",message:"Category added successfully!"})}catch(e){console.error("Failed to add category:",e),F({type:"error",message:(null===e||void 0===e?void 0:e.message)||"Failed to add category."})}else F({type:"error",message:"Please enter a category name."})},B=()=>{h(null),y({name:"",description:""})},R=async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t?z(!0):S(!0);try{const s=await async function(e){try{const t="https://en.wikipedia.org/w/api.php?action=query&titles=".concat(encodeURIComponent(e),"&prop=extracts&exintro=true&explaintext=true&format=json&origin=*"),s=await fetch(t);if(!s.ok)return null;const i=(await s.json()).query.pages,a=i[Object.keys(i)[0]];if(a.extract){let e=a.extract;const t=e.match(/^[^.!?]*[.!?]/);return t?e=t[0]:e.length>200&&(e=e.substring(0,200)+"..."),{description:e.trim(),source:"wikipedia"}}return null}catch(t){return console.error("Error fetching category description:",t),null}}(e);s&&s.description?(t?y((0,i.A)((0,i.A)({},x),{},{description:s.description})):m((0,i.A)((0,i.A)({},p),{},{description:s.description})),F({type:"success",message:"Description auto-filled for ".concat(e,"!")})):F({type:"info",message:'No description found for "'.concat(e,'". Please enter manually.')})}catch(s){console.error("Error auto-filling description:",s),F({type:"error",message:"Failed to auto-fill description. Please try again."})}finally{t?z(!1):S(!1)}},U=(0,a.useMemo)(()=>{if(!w.trim())return e;const t=w.toLowerCase();return e.filter(e=>e.name.toLowerCase().includes(t)||(e.description||"").toLowerCase().includes(t))},[e,w]),E=(0,a.useMemo)(()=>{const e=(u-1)*j,t=e+j;return U.slice(e,t)},[U,u,j]),M=(0,a.useMemo)(()=>Math.max(1,Math.ceil(U.length/j)),[U.length,j]);(0,a.useEffect)(()=>{f(1)},[w]);const P=(0,a.useMemo)(()=>Object.values(b).reduce((e,t)=>e+t,0),[b]);return(0,c.jsx)("div",{children:(0,c.jsxs)("div",{className:"panel",children:[(0,c.jsx)("div",{className:"panel-header",style:{marginBottom:"1.5rem"},children:(0,c.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[(0,c.jsx)("div",{style:{width:"40px",height:"40px",borderRadius:"10px",background:"linear-gradient(135deg, #00a884 0%, #008069 100%)",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,c.jsx)(o.UDU,{size:20,color:"#fff"})}),(0,c.jsxs)("div",{children:[(0,c.jsx)("div",{className:"panel-title",style:{marginBottom:"0.25rem"},children:"Categories"}),(0,c.jsxs)("div",{style:{fontSize:"0.875rem",color:"#8696a0"},children:[e.length," ",1===e.length?"category":"categories"," \u2022 ",P," total books"]})]})]})}),(0,c.jsx)("div",{style:{marginBottom:"1rem"},children:(0,c.jsxs)("div",{style:{position:"relative"},children:[(0,c.jsx)(o.CKj,{size:18,style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:"#8696a0"}}),(0,c.jsx)("input",{className:"input",value:w,onChange:e=>C(e.target.value),placeholder:"Search categories...",style:{paddingLeft:"40px"}})]})}),(0,c.jsxs)("div",{style:{background:"rgba(0, 168, 132, 0.05)",border:"1px solid rgba(0, 168, 132, 0.2)",borderRadius:"12px",padding:"1rem",marginBottom:"1.5rem"},children:[(0,c.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.75rem"},children:[(0,c.jsx)(o.GGD,{size:18,color:"#00a884"}),(0,c.jsx)("span",{style:{color:"#e9edef",fontWeight:"500"},children:"Add New Category"})]}),(0,c.jsxs)("div",{className:"grid-2",style:{marginBottom:"0.4rem"},children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"label",style:{marginBottom:"0.3rem",fontSize:"0.85rem"},children:"Name *"}),(0,c.jsx)("input",{className:"input",value:p.name,onChange:e=>m((0,i.A)((0,i.A)({},p),{},{name:e.target.value})),placeholder:"e.g., Science Fiction",style:{fontSize:"0.9rem",padding:"0.4rem 0.6rem"},onKeyPress:e=>"Enter"===e.key&&I()})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"label",style:{marginBottom:"0.3rem",fontSize:"0.85rem"},children:"Description"}),(0,c.jsxs)("div",{style:{position:"relative"},children:[(0,c.jsx)("input",{className:"input",value:p.description,onChange:e=>m((0,i.A)((0,i.A)({},p),{},{description:e.target.value})),placeholder:"Optional description",style:{fontSize:"0.9rem",padding:"0.4rem 0.6rem",paddingRight:"75px"},onKeyPress:e=>"Enter"===e.key&&I()}),(0,c.jsx)("button",{onClick:()=>R(p.name,!1),disabled:!p.name||N,style:{position:"absolute",right:"8px",top:"50%",transform:"translateY(-50%)",background:"#00a884",color:"white",border:"none",padding:"4px 8px",borderRadius:"4px",cursor:p.name&&!N?"pointer":"not-allowed",fontSize:"11px",opacity:p.name&&!N?1:.5,display:"flex",alignItems:"center",gap:"3px",whiteSpace:"nowrap"},title:"Auto-fill description",children:N?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(o.TwU,{className:"spin",style:{fontSize:"12px"}})," Fill"]}):(0,c.jsx)(c.Fragment,{children:"Fill"})})]})]})]}),(0,c.jsx)("div",{className:"actions",children:(0,c.jsxs)("button",{className:"btn primary",onClick:I,children:[(0,c.jsx)(o.GGD,{size:16})," Add Category"]})})]}),(0,c.jsx)("div",{style:{overflowX:"auto"},children:(0,c.jsxs)("table",{className:"table",children:[(0,c.jsx)("thead",{children:(0,c.jsxs)("tr",{children:[(0,c.jsx)("th",{style:{width:"35%"},children:"Category"}),(0,c.jsx)("th",{style:{width:"40%"},children:"Description"}),(0,c.jsx)("th",{style:{width:"15%",textAlign:"center"},children:"Books"}),(0,c.jsx)("th",{style:{width:"10%",textAlign:"right"},children:"Actions"})]})}),(0,c.jsx)("tbody",{children:s?(0,c.jsx)("tr",{children:(0,c.jsx)("td",{colSpan:4,style:{color:"#8696a0",textAlign:"center",padding:"2rem"},children:(0,c.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.5rem"},children:[(0,c.jsx)("div",{className:"spinner",style:{width:"24px",height:"24px",borderWidth:"3px"}}),(0,c.jsx)("span",{children:"Loading categories..."})]})})}):0===E.length?(0,c.jsx)("tr",{children:(0,c.jsx)("td",{colSpan:4,style:{color:"#8696a0",textAlign:"center",padding:"2rem"},children:(0,c.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.5rem"},children:[(0,c.jsx)(o.UDU,{size:32,color:"#8696a0"}),(0,c.jsx)("span",{children:w?"No categories found matching your search":"No categories yet"}),w&&(0,c.jsx)("button",{className:"btn",onClick:()=>C(""),style:{marginTop:"0.5rem"},children:"Clear search"})]})})}):E.map(e=>(0,c.jsxs)("tr",{children:[(0,c.jsx)("td",{children:g===e.id?(0,c.jsx)("input",{className:"input",value:x.name,onChange:e=>y((0,i.A)((0,i.A)({},x),{},{name:e.target.value})),autoFocus:!0}):(0,c.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,c.jsx)("div",{style:{width:"32px",height:"32px",borderRadius:"8px",background:"rgba(0, 168, 132, 0.1)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:(0,c.jsx)(o.UDU,{size:16,color:"#00a884"})}),(0,c.jsx)("span",{style:{fontWeight:"500",color:"#e9edef"},children:e.name})]})}),(0,c.jsx)("td",{children:g===e.id?(0,c.jsxs)("div",{style:{position:"relative"},children:[(0,c.jsx)("input",{className:"input",value:x.description,onChange:e=>y((0,i.A)((0,i.A)({},x),{},{description:e.target.value})),style:{paddingRight:"75px"}}),(0,c.jsx)("button",{onClick:()=>R(x.name,!0),disabled:!x.name||k,style:{position:"absolute",right:"8px",top:"50%",transform:"translateY(-50%)",background:"#00a884",color:"white",border:"none",padding:"4px 8px",borderRadius:"4px",cursor:x.name&&!k?"pointer":"not-allowed",fontSize:"11px",opacity:x.name&&!k?1:.5,display:"flex",alignItems:"center",gap:"3px",whiteSpace:"nowrap"},title:"Auto-fill description",children:k?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(o.TwU,{className:"spin",style:{fontSize:"12px"}})," Fill"]}):(0,c.jsx)(c.Fragment,{children:"Fill"})})]}):(0,c.jsx)("span",{style:{color:e.description?"#cfd8dc":"#8696a0",fontStyle:e.description?"normal":"italic"},children:e.description||"No description"})}),(0,c.jsx)("td",{style:{textAlign:"center"},children:(0,c.jsxs)("div",{style:{display:"inline-flex",alignItems:"center",gap:"0.375rem",background:b[e.id]>0?"rgba(0, 168, 132, 0.1)":"rgba(134, 150, 160, 0.1)",color:b[e.id]>0?"#00a884":"#8696a0",padding:"0.25rem 0.75rem",borderRadius:"20px",fontSize:"0.875rem",fontWeight:"500"},children:[(0,c.jsx)(o.D1A,{size:14}),b[e.id]||0]})}),(0,c.jsx)("td",{children:g===e.id?(0,c.jsxs)("div",{className:"actions",style:{justifyContent:"flex-end"},children:[(0,c.jsx)("button",{className:"btn primary",onClick:()=>(async e=>{if(x.name.trim())try{await(0,n.st)(e,{name:x.name.trim(),description:x.description}),B(),await D(),F({type:"success",message:"Category updated successfully!"})}catch(t){console.error("Failed to update category:",t),F({type:"error",message:(null===t||void 0===t?void 0:t.message)||"Failed to update category."})}else F({type:"error",message:"Category name cannot be empty."})})(e.id),style:{fontSize:"0.875rem"},children:"Save"}),(0,c.jsx)("button",{className:"btn",onClick:B,style:{fontSize:"0.875rem"},children:"Cancel"})]}):(0,c.jsxs)("div",{className:"actions",style:{justifyContent:"flex-end"},children:[(0,c.jsx)("button",{className:"btn",onClick:()=>(e=>{h(e.id),y({name:e.name,description:e.description||""})})(e),style:{padding:"0.5rem",minWidth:"auto"},title:"Edit category",children:(0,c.jsx)(o.WXf,{size:16})}),(0,c.jsx)("button",{className:"btn",onClick:()=>(async e=>{const t=b[e.id]||0;if(await A({title:"Delete category?",message:t>0?"This category contains ".concat(t," book").concat(t>1?"s":"",". Deleting it will remove the category association from these books."):"This will permanently remove this category.",confirmLabel:"Delete",cancelLabel:"Cancel",variant:"danger"}))try{await(0,n.K7)(e.id),await D(),F({type:"success",message:"Category deleted successfully!"})}catch(s){console.error("Failed to delete category:",s),F({type:"error",message:(null===s||void 0===s?void 0:s.message)||"Failed to delete category."})}})(e),style:{padding:"0.5rem",minWidth:"auto",color:"#ff4444"},title:"Delete category",children:(0,c.jsx)(o.IXo,{size:16})})]})})]},e.id))})]})}),U.length>0&&(0,c.jsxs)("div",{className:"actions",style:{marginTop:"1rem",justifyContent:"space-between",alignItems:"center"},children:[(0,c.jsx)("button",{className:"btn",disabled:u<=1,onClick:()=>f(e=>Math.max(1,e-1)),style:{opacity:u<=1?.5:1},children:"Previous"}),(0,c.jsxs)("span",{style:{color:"#cfd8dc",fontSize:"0.875rem"},children:["Page ",u," of ",M," (",U.length," ",1===U.length?"category":"categories",")"]}),(0,c.jsx)("button",{className:"btn",disabled:u>=M,onClick:()=>f(e=>Math.min(M,e+1)),style:{opacity:u>=M?.5:1},children:"Next"})]})]})})}}}]);
//# sourceMappingURL=824.3fb3f28d.chunk.js.map