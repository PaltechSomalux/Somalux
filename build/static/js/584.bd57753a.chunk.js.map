{"version":3,"file":"static/js/584.bd57753a.chunk.js","mappings":"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","sources":["SomaLux/Books/Admin/pages/SearchAnalytics.jsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { fetchSearchAnalyticsTop } from '../api';\r\n\r\nconst SCOPES = [\r\n  { id: 'books', label: 'Book Searches' },\r\n  { id: 'categories', label: 'Category Searches' },\r\n  { id: 'authors', label: 'Author Searches' },\r\n  { id: 'past_papers', label: 'Past Paper Searches' },\r\n];\r\n\r\nconst TIME_WINDOWS = [\r\n  { id: '7', label: 'Last 7 days' },\r\n  { id: '30', label: 'Last 30 days' },\r\n  { id: '90', label: 'Last 90 days' },\r\n];\r\n\r\nconst SearchAnalytics = () => {\r\n  const [days, setDays] = useState('30');\r\n  const [loading, setLoading] = useState(false);\r\n  const [dataByScope, setDataByScope] = useState({\r\n    books: [],\r\n    categories: [],\r\n    authors: [],\r\n    past_papers: [],\r\n  });\r\n\r\n  useEffect(() => {\r\n    let cancelled = false;\r\n    const load = async () => {\r\n      setLoading(true);\r\n      try {\r\n        const entries = await Promise.all(\r\n          SCOPES.map(async (s) => {\r\n            const rows = await fetchSearchAnalyticsTop(s.id, { days: Number(days) || 30, limit: 20 });\r\n            return [s.id, rows || []];\r\n          })\r\n        );\r\n        if (!cancelled) {\r\n          const mapped = {};\r\n          entries.forEach(([scope, rows]) => {\r\n            mapped[scope] = rows;\r\n          });\r\n          setDataByScope((prev) => ({ ...prev, ...mapped }));\r\n        }\r\n      } finally {\r\n        if (!cancelled) setLoading(false);\r\n      }\r\n    };\r\n    load();\r\n    return () => {\r\n      cancelled = true;\r\n    };\r\n  }, [days]);\r\n\r\n  return (\r\n    <div className=\"panel\">\r\n      <div className=\"panel-title\" style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>\r\n        <span>Search Overview</span>\r\n        <div style={{ display: 'flex', gap: 4 }}>\r\n          {TIME_WINDOWS.map((tw) => (\r\n            <button\r\n              key={tw.id}\r\n              className={days === tw.id ? 'btn' : 'btn btn-secondary'}\r\n              onClick={() => setDays(tw.id)}\r\n            >\r\n              {tw.label}\r\n            </button>\r\n          ))}\r\n        </div>\r\n      </div>\r\n\r\n      {loading && (\r\n        <div style={{ color: '#8696a0', padding: 8, fontSize: 12 }}>Loading search analytics...</div>\r\n      )}\r\n\r\n      <div className=\"grid-2\" style={{ marginTop: 8 }}>\r\n        {SCOPES.map((scope) => {\r\n          const rows = dataByScope[scope.id] || [];\r\n          return (\r\n            <div key={scope.id} className=\"panel\" style={{ background: '#111b21' }}>\r\n              <div className=\"panel-title\">{scope.label}</div>\r\n              {rows.length === 0 ? (\r\n                <div style={{ color: '#8696a0', padding: 6, fontSize: 11 }}>No search data yet for this period.</div>\r\n              ) : (\r\n                <table className=\"table overview-table\">\r\n                  <thead>\r\n                    <tr>\r\n                      <th>Query</th>\r\n                      <th>Searches</th>\r\n                      <th>Avg Results</th>\r\n                      <th>Last Searched</th>\r\n                    </tr>\r\n                  </thead>\r\n                  <tbody>\r\n                    {rows.map((row, idx) => (\r\n                      <tr key={idx}>\r\n                        <td>{row.query_text}</td>\r\n                        <td>{row.search_count}</td>\r\n                        <td>{row.avg_results != null ? Math.round(row.avg_results) : '—'}</td>\r\n                        <td>{row.last_searched ? new Date(row.last_searched).toLocaleString() : '—'}</td>\r\n                      </tr>\r\n                    ))}\r\n                  </tbody>\r\n                </table>\r\n              )}\r\n            </div>\r\n          );\r\n        })}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default SearchAnalytics;\r\n"],"names":["SCOPES","id","label","TIME_WINDOWS","SearchAnalytics","days","setDays","useState","loading","setLoading","dataByScope","setDataByScope","books","categories","authors","past_papers","useEffect","cancelled","async","entries","Promise","all","map","rows","fetchSearchAnalyticsTop","s","Number","limit","mapped","forEach","_ref","scope","prev","_objectSpread","load","_jsxs","className","children","style","display","alignItems","justifyContent","_jsx","gap","tw","onClick","color","padding","fontSize","marginTop","background","length","row","idx","query_text","search_count","avg_results","Math","round","last_searched","Date","toLocaleString"],"ignoreList":[],"sourceRoot":""}