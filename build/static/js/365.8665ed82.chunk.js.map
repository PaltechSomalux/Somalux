{"version":3,"file":"static/js/365.8665ed82.chunk.js","mappings":"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","sources":["SomaLux/Books/Admin/pages/Verify.jsx"],"sourcesContent":["import React, { useEffect, useMemo, useState } from 'react';\r\nimport { fetchAuthenticatedUsers, updateUserTier, fetchUploadCountsByUser } from '../api';\r\nimport { useAdminUI } from '../AdminUIContext';\r\nimport { FiCheck, FiAward, FiStar, FiSearch } from 'react-icons/fi';\r\nimport VerificationBadge from '../components/VerificationBadge';\r\n\r\nconst Verify = ({ userProfile }) => {\r\n  const [loading, setLoading] = useState(true);\r\n  const [rows, setRows] = useState([]);\r\n  const [count, setCount] = useState(0);\r\n  const [page, setPage] = useState(1);\r\n  const [pageSize] = useState(15);\r\n  const [search, setSearch] = useState('');\r\n  const [tierFilter, setTierFilter] = useState('');\r\n  const [updating, setUpdating] = useState({});\r\n  const [sort, setSort] = useState({ col: 'created_at', dir: 'desc' });\r\n\r\n  const { confirm, showToast } = useAdminUI();\r\n  const ADMIN_EMAILS = ['campuslives254@gmail.com', 'paltechsomalux@gmail.com'];\r\n  const isAdmin = userProfile?.role === 'admin' || ADMIN_EMAILS.includes(userProfile?.email);\r\n\r\n  const totalPages = useMemo(() => Math.max(1, Math.ceil(count / pageSize)), [count, pageSize]);\r\n\r\n  const load = async () => {\r\n    setLoading(true);\r\n    try {\r\n      const [allProfiles, uploadCounts] = await Promise.all([\r\n        fetchAuthenticatedUsers(),\r\n        fetchUploadCountsByUser()\r\n      ]);\r\n      \r\n      const uploadsMap = new Map(\r\n        (uploadCounts || []).map((u) => [String(u.uploaded_by), {\r\n          total: typeof u.total === 'number' ? u.total : (u.books || 0) + (u.past_papers || 0) + (u.universities || 0),\r\n        }])\r\n      );\r\n      \r\n      const profiles = (allProfiles || [])\r\n        .filter(p => p && p.id) // Ensure valid profiles\r\n        .map(p => {\r\n          const contrib = uploadsMap.get(String(p.id)) || { total: 0 };\r\n          return {\r\n            ...p,\r\n            display_name: p.full_name || p.email,\r\n            subscription_tier: p.subscription_tier || 'basic',\r\n            subscription_started_at: p.subscription_started_at,\r\n            subscription_expires_at: p.subscription_expires_at,\r\n            avatar_url: p.avatar_url,\r\n            uploadCount: contrib.total || 0\r\n          };\r\n        });\r\n      \r\n      console.log('[Verify.load] Loaded profiles:', profiles.length);\r\n      setRows(profiles);\r\n      setCount(profiles.length);\r\n    } catch (error) {\r\n      console.error('Failed to load profiles:', error);\r\n      showToast({ type: 'error', message: 'Failed to load users.' });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (userProfile) load();\r\n  }, [userProfile]);\r\n\r\n  const filteredRows = useMemo(() => {\r\n    return rows.filter(u => {\r\n      const matchSearch = !search || \r\n        (u.email && u.email.toLowerCase().includes(search.toLowerCase())) ||\r\n        (u.display_name && u.display_name.toLowerCase().includes(search.toLowerCase()));\r\n      const matchTier = !tierFilter || u.subscription_tier === tierFilter;\r\n      return matchSearch && matchTier;\r\n    });\r\n  }, [rows, search, tierFilter]);\r\n\r\n  const paginatedRows = useMemo(() => {\r\n    const start = (page - 1) * pageSize;\r\n    return filteredRows.slice(start, start + pageSize);\r\n  }, [filteredRows, page, pageSize]);\r\n\r\n  const updateTier = async (userId, newTier) => {\r\n    setUpdating(s => ({ ...s, [userId]: true }));\r\n    try {\r\n      const result = await updateUserTier(userId, newTier);\r\n      \r\n      // Update local state with response data\r\n      setRows(prevRows => \r\n        prevRows.map(r => r.id === userId ? { \r\n          ...r, \r\n          subscription_tier: result.data?.subscription_tier || newTier,\r\n          subscription_started_at: result.data?.subscription_started_at || new Date().toISOString()\r\n        } : r)\r\n      );\r\n      \r\n      showToast({ type: 'success', message: `User tier updated to ${newTier}` });\r\n    } catch (error) {\r\n      console.error('Failed to update tier:', error);\r\n      showToast({ type: 'error', message: 'Failed to update user tier.' });\r\n    } finally {\r\n      setUpdating(s => ({ ...s, [userId]: false }));\r\n    }\r\n  };\r\n\r\n  const getTierBadge = (tier) => {\r\n    switch (tier) {\r\n      case 'premium':\r\n        return { icon: <FiCheck />, color: '#2196F3', label: 'Premium', bgColor: 'rgba(33, 150, 243, 0.1)' };\r\n      case 'premium_pro':\r\n        return { icon: <FiAward />, color: '#FFD700', label: 'Premium Pro', bgColor: 'rgba(255, 215, 0, 0.1)' };\r\n      default:\r\n        return { icon: <FiStar />, color: '#8696a0', label: 'Basic', bgColor: 'rgba(134, 150, 160, 0.05)' };\r\n    }\r\n  };\r\n\r\n  if (!isAdmin) {\r\n    return (\r\n      <div style={{ padding: 20, color: '#e9edef' }}>\r\n        You don't have permission to access this page.\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (loading) {\r\n    return <div style={{ padding: 20, color: '#8696a0' }}>Loading...</div>;\r\n  }\r\n\r\n  return (\r\n    <div style={{ padding: 12 }}>\r\n      <div className=\"section-header\" style={{ marginBottom: 16 }}>\r\n        <h2 style={{ color: '#e9edef', fontSize: 18, margin: 0 }}>Verify Users</h2>\r\n        <p style={{ color: '#8696a0', fontSize: 12, margin: '4px 0 0 0' }}>\r\n          Manage user subscription tiers and verification status\r\n        </p>\r\n      </div>\r\n\r\n      {/* Filters */}\r\n      <div style={{ display: 'flex', gap: 8, marginBottom: 12, flexWrap: 'wrap' }}>\r\n        <div style={{ flex: 1, minWidth: 200, position: 'relative' }}>\r\n          <FiSearch style={{ position: 'absolute', left: 8, top: 8, color: '#8696a0' }} />\r\n          <input\r\n            type=\"text\"\r\n            placeholder=\"Search by name or email...\"\r\n            value={search}\r\n            onChange={(e) => setSearch(e.target.value)}\r\n            className=\"input\"\r\n            style={{ paddingLeft: 32, width: '100%', backgroundColor: 'black', color: 'white', fontSize: '13px' }}\r\n          />\r\n        </div>\r\n        <select\r\n          className=\"select\"\r\n          value={tierFilter}\r\n          onChange={(e) => setTierFilter(e.target.value)}\r\n          style={{ minWidth: 150, width: 'auto' }}\r\n        >\r\n          <option value=\"\">All Tiers</option>\r\n          <option value=\"basic\">Basic</option>\r\n          <option value=\"premium\">Premium</option>\r\n          <option value=\"premium_pro\">Premium Pro</option>\r\n        </select>\r\n      </div>\r\n\r\n      {/* Table */}\r\n      <div style={{ overflowX: 'auto' }}>\r\n        <table className=\"table\">\r\n          <thead>\r\n            <tr>\r\n              <th>#</th>\r\n              <th>Name</th>\r\n              <th>Email</th>\r\n              <th>Uploads</th>\r\n              <th>Current Tier</th>\r\n              <th>Subscription Date</th>\r\n              <th>Change Tier To</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {paginatedRows.length === 0 ? (\r\n              <tr>\r\n                <td colSpan={6} style={{ textAlign: 'center', color: '#8696a0', padding: 20 }}>\r\n                  No users found\r\n                </td>\r\n              </tr>\r\n            ) : (\r\n              paginatedRows.map((u, idx) => {\r\n                const rowNum = (page - 1) * pageSize + idx + 1;\r\n                const tier = getTierBadge(u.subscription_tier);\r\n                return (\r\n                  <tr key={u.id}>\r\n                    <td style={{ fontSize: '13px', fontWeight: '600', color: '#00a884' }}>\r\n                      #{rowNum}\r\n                    </td>\r\n                    <td>\r\n                      <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n                        <div style={{ position: 'relative' }} className=\"viewer-avatar\">\r\n                          {u.avatar_url ? (\r\n                            <img\r\n                              src={u.avatar_url}\r\n                              alt={u.display_name || u.email || 'User avatar'}\r\n                              style={{ width: '100%', height: '100%', borderRadius: '50%', objectFit: 'cover' }}\r\n                              onError={(e) => {\r\n                                // Fallback if image fails to load\r\n                                e.target.style.display = 'none';\r\n                              }}\r\n                            />\r\n                          ) : (\r\n                            (u.display_name || u.email || '?').charAt(0).toUpperCase()\r\n                          )}\r\n                          {u.uploadCount > 0 && (\r\n                            <div style={{\r\n                              position: 'absolute',\r\n                              bottom: -4,\r\n                              right: -4,\r\n                              backgroundColor: '#00a884',\r\n                              color: 'white',\r\n                              borderRadius: '50%',\r\n                              width: 20,\r\n                              height: 20,\r\n                              display: 'flex',\r\n                              alignItems: 'center',\r\n                              justifyContent: 'center',\r\n                              fontSize: 10,\r\n                              fontWeight: 'bold',\r\n                              border: '2px solid #0a1419'\r\n                            }}>\r\n                              {u.uploadCount > 99 ? '99+' : u.uploadCount}\r\n                            </div>\r\n                          )}\r\n                          {(u.subscription_tier === 'premium' || u.subscription_tier === 'premium_pro') && (\r\n                            <div style={{\r\n                              position: 'absolute',\r\n                              top: -6,\r\n                              right: -6,\r\n                              zIndex: 2\r\n                            }}>\r\n                              <VerificationBadge tier={u.subscription_tier} size=\"sm\" showLabel={false} showTooltip={true} />\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n                        <span>{u.display_name || '—'}</span>\r\n                      </div>\r\n                    </td>\r\n                    <td style={{ fontSize: 12, color: '#8696a0' }}>{u.email}</td>\r\n                    <td style={{ fontSize: 12, fontWeight: '600', color: '#00a884' }}>{u.uploadCount}</td>\r\n                    <td>\r\n                      <div style={{\r\n                        display: 'flex',\r\n                        alignItems: 'center',\r\n                        gap: 6,\r\n                        padding: '4px 8px',\r\n                        borderRadius: 4,\r\n                        backgroundColor: tier.bgColor,\r\n                        width: 'fit-content'\r\n                      }}>\r\n                        <span style={{ color: tier.color, fontSize: 14 }}>{tier.icon}</span>\r\n                        <span style={{ color: tier.color, fontSize: 12, fontWeight: 500 }}>{tier.label}</span>\r\n                      </div>\r\n                    </td>\r\n                    <td style={{ fontSize: 12, color: '#8696a0' }}>\r\n                      {u.subscription_started_at \r\n                        ? new Date(u.subscription_started_at).toLocaleDateString()\r\n                        : '—'}\r\n                    </td>\r\n                    <td>\r\n                      <select\r\n                        value={u.subscription_tier}\r\n                        onChange={(e) => updateTier(u.id, e.target.value)}\r\n                        disabled={updating[u.id]}\r\n                        className=\"select\"\r\n                        style={{ fontSize: 12 }}\r\n                      >\r\n                        <option value=\"basic\">Basic</option>\r\n                        <option value=\"premium\">Premium</option>\r\n                        <option value=\"premium_pro\">Premium Pro</option>\r\n                      </select>\r\n                    </td>\r\n                  </tr>\r\n                );\r\n              })\r\n            )}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n\r\n      {/* Pagination */}\r\n      <div className=\"actions\" style={{ marginTop: 10, justifyContent: 'space-between' }}>\r\n        <button className=\"btn\" disabled={page <= 1} onClick={() => setPage(p => Math.max(1, p - 1))}>Prev</button>\r\n        <span style={{ color: '#cfd8dc' }}>Page {page} of {totalPages} ({filteredRows.length} users)</span>\r\n        <button className=\"btn\" disabled={page >= totalPages} onClick={() => setPage(p => Math.min(totalPages, p + 1))}>Next</button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Verify;\r\n"],"names":["_ref","userProfile","loading","setLoading","useState","rows","setRows","count","setCount","page","setPage","pageSize","search","setSearch","tierFilter","setTierFilter","updating","setUpdating","sort","setSort","col","dir","confirm","showToast","useAdminUI","isAdmin","role","includes","email","totalPages","useMemo","Math","max","ceil","useEffect","async","allProfiles","uploadCounts","Promise","all","fetchAuthenticatedUsers","fetchUploadCountsByUser","uploadsMap","Map","map","u","String","uploaded_by","total","books","past_papers","universities","profiles","filter","p","id","contrib","get","_objectSpread","display_name","full_name","subscription_tier","subscription_started_at","subscription_expires_at","avatar_url","uploadCount","console","log","length","error","type","message","load","filteredRows","matchSearch","toLowerCase","matchTier","paginatedRows","start","slice","_jsx","style","padding","color","children","_jsxs","className","marginBottom","fontSize","margin","display","gap","flexWrap","flex","minWidth","position","FiSearch","left","top","placeholder","value","onChange","e","target","paddingLeft","width","backgroundColor","overflowX","colSpan","textAlign","idx","rowNum","tier","icon","FiCheck","label","bgColor","FiAward","FiStar","getTierBadge","fontWeight","alignItems","src","alt","height","borderRadius","objectFit","onError","charAt","toUpperCase","bottom","right","justifyContent","border","zIndex","VerificationBadge","size","showLabel","showTooltip","Date","toLocaleDateString","userId","newTier","s","result","updateUserTier","prevRows","r","_result$data","_result$data2","data","toISOString","concat","updateTier","disabled","marginTop","onClick","min"],"ignoreList":[],"sourceRoot":""}